import{l as n}from"./_@antv_x6@2.18.1@@antv-4eec9d0e.js";import{M as p}from"./_mousetrap@1.6.5@mousetrap-ba9bcf28.js";var h=globalThis&&globalThis.__decorate||function(i,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(i,t,e,r);else for(var l=i.length-1;l>=0;l--)(a=i[l])&&(s=(o<3?a(s):o>3?a(t,e,s):a(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};class u extends n.Disposable{get graph(){return this.options.graph}constructor(t){super(),this.options=t;const e=this.graph.getPlugin("scroller");this.container=e?e.container:this.graph.container,t.global?this.target=document:(this.target=this.container,this.disabled||this.target.setAttribute("tabindex","-1"),this.graph.on("cell:mouseup",this.focus,this),this.graph.on("blank:mouseup",this.focus,this)),this.mousetrap=u.createMousetrap(this)}get disabled(){return this.options.enabled!==!0}enable(){this.disabled&&(this.options.enabled=!0,this.target instanceof HTMLElement&&this.target.setAttribute("tabindex","-1"))}disable(){this.disabled||(this.options.enabled=!1,this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))}on(t,e,r){this.mousetrap.bind(this.getKeys(t),e,r)}off(t,e){this.mousetrap.unbind(this.getKeys(t),e)}clear(){this.mousetrap.reset()}trigger(t,e){this.mousetrap.trigger(t,e)}focus(t){if(this.isInputEvent(t.e))return;this.target.focus({preventScroll:!0})}getKeys(t){return(Array.isArray(t)?t:[t]).map(e=>this.formatkey(e))}formatkey(t){const e=t.toLocaleLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command").replace("arrowup","up").replace("arrowright","right").replace("arrowdown","down").replace("arrowleft","left"),r=this.options.format;return r?n.FunctionExt.call(r,this.graph,e):e}isGraphEvent(t){const e=t.target,r=t.currentTarget;return e?e===this.target||r===this.target||e===document.body?!0:n.Dom.contains(this.container,e):!1}isInputEvent(t){var e;const r=t.target,o=(e=r==null?void 0:r.tagName)===null||e===void 0?void 0:e.toLowerCase();let s=["input","textarea"].includes(o);return n.Dom.attr(r,"contenteditable")==="true"&&(s=!0),s}isEnabledForEvent(t){const e=!this.disabled&&this.isGraphEvent(t),r=this.isInputEvent(t);if(e){if(r&&(t.key==="Backspace"||t.key==="Delete"))return!1;if(this.options.guard)return n.FunctionExt.call(this.options.guard,this.graph,t)}return e}dispose(){this.mousetrap.reset()}}h([n.Disposable.dispose()],u.prototype,"dispose",null);(function(i){function t(e){const r=new p(e.target),o=r.stopCallback;return r.stopCallback=(s,a,l)=>e.isEnabledForEvent(s)?o?o.call(r,s,a,l):!1:!0,r}i.createMousetrap=t})(u||(u={}));n.Graph.prototype.isKeyboardEnabled=function(){const i=this.getPlugin("keyboard");return i?i.isEnabled():!1};n.Graph.prototype.enableKeyboard=function(){const i=this.getPlugin("keyboard");return i&&i.enable(),this};n.Graph.prototype.disableKeyboard=function(){const i=this.getPlugin("keyboard");return i&&i.disable(),this};n.Graph.prototype.toggleKeyboard=function(i){const t=this.getPlugin("keyboard");return t&&t.toggleEnabled(i),this};n.Graph.prototype.bindKey=function(i,t,e){const r=this.getPlugin("keyboard");return r&&r.bindKey(i,t,e),this};n.Graph.prototype.unbindKey=function(i,t){const e=this.getPlugin("keyboard");return e&&e.unbindKey(i,t),this};n.Graph.prototype.clearKeys=function(){const i=this.getPlugin("keyboard");return i&&i.clear(),this};n.Graph.prototype.triggerKey=function(i,t){const e=this.getPlugin("keyboard");return e&&e.trigger(i,t),this};var c=globalThis&&globalThis.__decorate||function(i,t,e,r){var o=arguments.length,s=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(i,t,e,r);else for(var l=i.length-1;l>=0;l--)(a=i[l])&&(s=(o<3?a(s):o>3?a(t,e,s):a(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};class d extends n.Disposable{constructor(t={}){super(),this.name="keyboard",this.options=Object.assign({enabled:!0},t)}init(t){this.keyboardImpl=new u(Object.assign(Object.assign({},this.options),{graph:t}))}isEnabled(){return!this.keyboardImpl.disabled}enable(){this.keyboardImpl.enable()}disable(){this.keyboardImpl.disable()}toggleEnabled(t){return t!=null?t!==this.isEnabled()&&(t?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}bindKey(t,e,r){return this.keyboardImpl.on(t,e,r),this}trigger(t,e){return this.keyboardImpl.trigger(t,e),this}clear(){return this.keyboardImpl.clear(),this}unbindKey(t,e){return this.keyboardImpl.off(t,e),this}dispose(){this.keyboardImpl.dispose()}}c([n.Disposable.dispose()],d.prototype,"dispose",null);export{d as K};
