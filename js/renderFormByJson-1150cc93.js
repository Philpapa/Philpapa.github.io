import{r as V,l as W,M as q,A as X,u as m,G as Y,P as h,y as B,i as k}from"./_vue@2.7.16@vue-c82c1faf.js";import{n as Z,u as j,t as ee,F as v,l as te}from"./index-66a898a3.js";const ae={name:"renderFormByJson"},le=Object.assign(ae,{props:{data:{type:Object,default(){return{id:"basic",isBasic:!0,children:[]}}}},emits:["fillPatientInfo"],setup($,{emit:c}){const u=$,d=j({isPrint:e=>e.form.isPrint}),{isPrint:y}=d,M=V(!0),N=W("comData",{}),C=V(null),_=V({}),E=V({});q("formValue",_),q("formData",u.data);const J=V({}),T=e=>{let{isBasic:a,children:l,name:n}=e;if(!a){const{defVal:o,id:t,props:{dicOrigin:i,datset_id:r,datset_name:s},slots:f,dataset_code:A,dataset_field:F}=e;let R={};if(A&&(R.dataset_code=A),F&&(R.dataset_field=F),h(E.value,t,R),h(_.value,t,o),i&&i==2&&h(J.value,t,{datset_id:r,datset_name:s}),f&&f.named&&f.named.length>0)for(let P in f.named){let p=f.named[P].comDetail;!p||T(p)}}if(l&&l.length>0&&n!=="dActiveTable")for(let o in l){let t=l[o];T(t)}},g=V({}),D=V({});q("validateData",D);const z=(...e)=>{const a=e[1]?"":e[2];h(D.value,e[0],a)},b=e=>{let{isBasic:a,children:l,name:n}=e;if(!a){const{id:o,slots:t}=e;if(n!=="dActiveTable"){let i=v.requiredFn(e,{formValue:m(_)});i&&h(g.value,o,i)}if(t&&t.named&&t.named.length>0)for(let i in t.named){let r=t.named[i].comDetail;!r||b(r)}}if(l&&l.length>0&&n!=="dActiveTable")for(let o in l){let t=l[o];b(t)}},G=e=>{if(!v.isEmpty(e)){if(e==="clear"){B(()=>{var a,l;(l=(a=m(C))==null?void 0:a.clearValidate)==null||l.call(a)});return}if(Array.isArray(e)){if(m(g)[e[0]])return;h(g.value,e[0],e[1]),B(()=>{var a,l;(l=(a=m(C))==null?void 0:a.clearValidate)==null||l.call(a,e[0])})}else m(g)[e]&&(k(D.value,e),k(g.value,e),B(()=>{var a,l;(l=(a=m(C))==null?void 0:a.clearValidate)==null||l.call(a,e)}))}},H=e=>{if(e[1]==="delete")for(let a in e[0])k(_.value,e[0][a]);else e.forEach(a=>{for(let l in a.data){let n=v.copy(a.data[l]);h(_.value,l,n)}})},w=e=>{var i,r;const{id:a,defVal:l,name:n,props:o,slots:t}=e;if(o.isCollect){if(n!=="dDraggable")h(_.value,a,l);else if(e.tag==="slot"&&e.children.length>0)for(let s in e.children)w(e.children[s])}else{if(h(_.value,a,l),Array.isArray(l)&&((r=(i=m(C))==null?void 0:i.validateField)==null||r.call(i,a)),n==="dInput"){const{isSearch:s,fieldsSet:f,rowInfo:A}=o;if(!s||v.isEmpty(A)||v.isEmpty(f))return;let F={};try{F=JSON.parse(A)}catch(p){console.log(p)}let R={},P={};for(let p of f)p.reflectName&&(P[p.name]=p.reflectName);for(let p in F){let U=F[p];v.isEmpty(P[p])||(R[P[p]]=U)}c("fillPatientInfo",R);return}if(t&&t.named&&t.named.length)for(let s in t.named){let f=t.named[s].comDetail;!f||w(f)}}},O=(e,a)=>{let l=[];const{isBasic:n,children:o}=e;if(!n){const{connect_field:t,props:{isCollect:i}}=e;!i&&t&&t===a&&(l=[...l,e])}if(o&&o.length>0)for(let t of o)l=[...l,...O(t,a)];return l},x={string:"",object:[],number:0},L=([e,a])=>{let l=O(u.data,a),n=l.find(t=>t.props.isRequired&&t.id!==e),o=l.find(t=>t.id===e);if(n){let{props:{isRequired:t,timeCompareArr:i}}=n;o.props.isRequired=t,n.props.isRequired=!1,i&&(o.props.timeCompareArr=v.copy(i),n.props.timeCompareArr=[]);for(let r of l)if(r.id!==e)k(g.value,r.id),B(()=>{var s,f;(f=(s=m(C))==null?void 0:s.clearValidate)==null||f.call(s,r.id)});else{let s=v.requiredFn(o,{formValue:m(_)});h(g.value,e,s)}}for(let t of l)t.id!==e&&h(t,"defVal",v.copy(x[typeof t.defVal]))},Q=e=>{let a=v.findTargetComp(u.data,e);if(!a||["dImage","dText","dTitle"].includes(a.name))return;let l=Array.isArray(a.defVal)?[]:"";a.defVal=l,h(_.value,e,l),B(()=>{var n,o;(o=(n=m(C))==null?void 0:n.clearValidate)==null||o.call(n,e)})},S=V({}),I=["441900","442000","460400"],K=()=>te().then(e=>{let a={province:[],city:{},area:{}},l=e||[],n=[],o=[];for(let t in l){let i=l[t],r=t.slice(2,4),s=t.slice(4);r==="00"&&s==="00"?(a.province.push({label:i,value:t}),a.city[t]=[]):r!=="00"&&s==="00"?n.push({label:i,value:t}):r!=="00"&&s!=="00"&&o.push({label:i,value:t})}n.forEach(t=>{var r,s;let i=`${t.value.slice(0,2)}0000`;(s=(r=a.city[i])==null?void 0:r.push)==null||s.call(r,t),I.includes(t.value)?a.area[t.value]=[{...t}]:a.area[t.value]=[]}),o.forEach(t=>{var r,s;let i=`${t.value.slice(0,4)}00`;(s=(r=a.area[i])==null?void 0:r.push)==null||s.call(r,t)}),S.value=a}).catch(e=>{console.log(e)});return q("regionData",S),X(async()=>{!m(y)&&b(u.data),T(u.data),await K(),D.value={}}),Y(()=>{setTimeout(()=>{var e,a;(a=(e=m(C))==null?void 0:e.clearValidate)==null||a.call(e)},300)}),{__sfc:!0,emit:c,props:u,states:d,isPrint:y,isCompact:M,comData:N,formRef:C,formValue:_,formFields:E,datasetValue:J,initData:T,rules:g,validateData:D,onFormValidate:z,initRules:b,editRule:G,editField:H,onCompInput:w,collectIdenticalCom:O,emptyValMap:x,clearOthField:L,clearCompVal:Q,regionData:S,verticalArea:I,getRegionDic:K,RenderShowComByJson:ee}}});var ie=function(){var c=this,u=c._self._c,d=c._self._setupProxy;return u("div",{ref:"toPdf",staticClass:"render-form",class:{isPrint:d.isPrint,isCompact:d.isCompact}},[u("el-form",c._b({ref:"formRef",attrs:{model:d.formValue,disabled:d.isPrint||c.$attrs.disabled,rules:d.isPrint?{}:d.rules,validateOnRuleChange:!1},on:{validate:d.onFormValidate}},"el-form",c.$attrs,!1),[c._l(c.data.children,function(y){return[y.name==="dDraggable"?u("div",{key:y.id+"print",staticClass:"render-comp-print",style:{width:y.props.width?`${y.props.width}%`:"fit-content"}},[u(d.RenderShowComByJson,c._g({key:y.id,attrs:{data:y},on:{input:d.onCompInput,clearOthField:d.clearOthField,clearCompVal:d.clearCompVal,editRule:d.editRule,editField:d.editField}},c.$listeners))],1):u(d.RenderShowComByJson,c._g({key:y.id,attrs:{data:y},on:{input:d.onCompInput,clearOthField:d.clearOthField,clearCompVal:d.clearCompVal,editRule:d.editRule,editField:d.editField}},c.$listeners))]})],2)],1)},re=[],ne=Z(le,ie,re,!1,null,"cda12aff",null,null);const de=ne.exports;export{de as r};
