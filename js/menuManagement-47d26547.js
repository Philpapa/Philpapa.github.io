import{n as $,J,K as M,L as B,G as U,M as V,_ as K}from"./index-66a898a3.js";import{h as I,r,y as j}from"./_vue@2.7.16@vue-c82c1faf.js";import{e as b}from"./_element-ui@2.15.14@element-ui-d6404236.js";import{m as q}from"./_vuex@3.6.2@vuex-0d722715.js";import"./_axios@1.6.7@axios-8eaa8064.js";import"./_side-channel@1.0.5@side-channel-2c942eb6.js";import"./_get-intrinsic@1.2.4@get-intrinsic-c09dd1a7.js";import"./_es-errors@1.3.0@es-errors-d863dafe.js";import"./_has-symbols@1.0.3@has-symbols-af84758f.js";import"./_has-proto@1.0.1@has-proto-ed1b0be6.js";import"./_function-bind@1.1.2@function-bind-0a5fc7a8.js";import"./_hasown@2.0.1@hasown-7211ef3d.js";import"./_call-bind@1.0.7@call-bind-90319db2.js";import"./_set-function-length@1.2.1@set-function-length-ac203dfa.js";import"./_define-data-property@1.1.4@define-data-property-c2b4af81.js";import"./_es-define-property@1.0.0@es-define-property-86f51ffb.js";import"./_gopd@1.0.1@gopd-7b0e1986.js";import"./_has-property-descriptors@1.0.2@has-property-descriptors-af639a50.js";import"./_qs@6.11.2@qs-d48efb00.js";import"./_vue-router@3.5.3@vue-router-44f70d6f.js";import"./_nanoid@3.3.7@nanoid-3ec3f908.js";import"./_gm-crypto@0.1.12@gm-crypto-48543d3c.js";import"./_to-arraybuffer@1.0.1@to-arraybuffer-dd910a5e.js";import"./_buffer@5.7.1@buffer-81215e29.js";import"./_base64-js@1.5.1@base64-js-554c8894.js";import"./_ieee754@1.2.1@ieee754-0706f68c.js";import"./_jsbn@1.1.0@jsbn-726a10f4.js";import"./_@antv_x6-common@2.0.17@@antv-e9d2c7f8.js";import"./_lodash-es@4.17.21@lodash-es-326016e5.js";import"./_element-resize-detector@1.2.4@element-resize-detector-0b105688.js";import"./_batch-processor@1.0.0@batch-processor-252a9c8d.js";import"./_@vueuse_core@10.7.2@@vueuse-38acc5bf.js";import"./_@vueuse_shared@10.7.2@@vueuse-98aa9f98.js";import"./_vue-demi@0.14.7@vue-demi-52bac217.js";import"./_v-region@2.3.0@v-region-cb5f6f14.js";import"./_@antv_x6@2.18.1@@antv-4eec9d0e.js";import"./_@antv_x6-geometry@2.0.5@@antv-5981308d.js";import"./_@antv_x6-vue-shape@2.1.2@@antv-7a0d94b2.js";import"./_vuedraggable@2.24.3@vuedraggable-f97e6635.js";import"./_sortablejs@1.10.2@sortablejs-2915de19.js";import"./_deepmerge@1.5.2@deepmerge-251d9111.js";import"./_resize-observer-polyfill@1.5.1@resize-observer-polyfill-88ffd6cd.js";import"./_throttle-debounce@1.1.0@throttle-debounce-d93b3c53.js";import"./_babel-helper-vue-jsx-merge-props@2.0.3@babel-helper-vue-jsx-merge-props-72d30afb.js";import"./_normalize-wheel@1.0.1@normalize-wheel-1b789469.js";import"./_async-validator@1.8.5@async-validator-8fabaacf.js";import"./_babel-runtime@6.26.0@babel-runtime-ff8b37cd.js";import"./_core-js@2.6.12@core-js-edebcccf.js";const z=I({name:"menuManagement",setup(){const f=r([]),e=r(),t=r([]);function a(){J().then(s=>{const{data:l,status:i}=s;if(i===104){if(t.value=l?l.list:[],h.value){let n=[];t.value.forEach(p=>{n=[...n,...k(p)]});let u=n.find(p=>h.value.id===p.id);u&&y(u)}else y(t.value[0]);j(()=>{h.value?e.value.setCurrentKey(h.value.id):e.value.setCurrentKey(t.value[0].id)})}})}a();const g=r([]),P=r([]),h=r("");function y(s){h.value=JSON.parse(JSON.stringify(s));const l=k(s).filter(i=>!i.childs);g.value=l}function k(s){let l=[];const{childs:i}=s;if(l.push(s),i)for(let n of i)l=[...l,...k(n)];return l}function N(s){let l=s.status?"\u505C\u7528":"\u542F\u7528";b.exports.MessageBox.confirm(`\u662F\u5426\u8981${l}\uFF1F`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"}).then(()=>{const i={ids:[s.id],status:!s.status};M(i).then(n=>{const{status:u}=n;let p=Array.from(e.value.store._getAllNodes());f.value=p.filter(c=>c.expanded).map(c=>c.data.id),u===100&&a(),b.exports.Message.success("\u64CD\u4F5C\u6210\u529F")})}).catch(i=>{console.log(i)})}function C(s){const l=P.value.map(i=>i.id);l.length?b.exports.MessageBox.confirm(`\u662F\u5426\u8981\u6279\u91CF${s?"\u542F\u7528":"\u505C\u7528"}\uFF1F`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"}).then(()=>{M({ids:l,status:s}).then(n=>{const{status:u}=n;let p=Array.from(e.value.store._getAllNodes());f.value=p.filter(c=>c.expanded).map(c=>c.data.id),u===100&&a(),b.exports.Message.success("\u64CD\u4F5C\u6210\u529F")})}).catch(()=>{}):this.$message.error("\u8BF7\u52FE\u9009\u9700\u8981\u4FEE\u6539\u7684\u6570\u636E")}const x=r(!1),_=r({}),w=r(!1),d=r([]),D=r([]),v=r([]),o=r(!1),m=r(!1);async function E(s){_.value=JSON.parse(JSON.stringify(s)),x.value=!0,await B().then(l=>{const{data:i,status:n}=l;n===100&&(D.value=i,v.value=D.value.map(u=>u.name))}),await U({menuIDList:[s.id]}).then(l=>{const{data:i,status:n}=l;if(n===104&&i.length){const{parentName:u,router:p,operationName:c}=i[0];if(Object.assign(_.value,{parentName:u,router:p}),c){let S={};c.split(",").forEach(L=>{let A=L.split("||");S[A[0]]=A[1]}),d.value=Object.keys(S)}O()}})}function O(){let s=v.value.length,l=d.value.length;if(!s||!l){o.value=!1,m.value=!1;return}s===l?(o.value=!0,m.value=!1):s>l&&(o.value=!1,m.value=!0)}function H(s){Array.isArray(s)?v.value.length<=s.length?(o.value=!v.value.some(l=>!s.includes(l)),m.value=!o.value):(o.value=!1,m.value=!0):s===!1?(o.value=!1,m.value=!1,d.value=[]):s===!0&&(o.value=!0,m.value=!1,d.value=JSON.parse(JSON.stringify(v.value)))}function T(){let s=[];v.value.forEach(i=>{d.value.includes(i)?s.push({name:i,status:!0}):s.push({name:i,status:!1})}),console.log(_.value,"formData.value");let l={id:_.value.id,router:_.value.router,menuOperation:s};V(l).then(i=>{const{status:n}=i;n===103&&b.exports.Message.success("\u4FDD\u5B58\u6210\u529F")}).finally(()=>{x.value=!1,o.value=!1,m.value=!1,d.value=[]})}return{defaultExpandedKeys:f,menuTree:e,treeData:t,menuList:g,multipleSelection:P,currentMenu:h,getMenuDetail:y,menuStatusHandler:N,menuStatusMultipleHandler:C,dialogVisible:x,formData:_,hasEditUrl:w,checkedPermission:d,permissionDic:D,permissionNameDic:v,checkAll:o,checked:m,initDialogData:E,menuPermissionCheckHandler:H,updateMenu:T}},data(){return{pagePermission:[]}},computed:{...q({menuPermission:f=>f.user.menuPermission})},methods:{hasPermissions(f){return this.pagePermission.some(e=>e.value1===f)}},mounted(){this.pagePermission=this.menuPermission[this.$route.name]}});var F=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"menu-management"},[t("el-tree",{ref:"menuTree",attrs:{data:e.treeData,"highlight-current":"",props:{children:"childs",label:"name"},"default-expanded-keys":e.defaultExpandedKeys,"node-key":"id"},on:{"node-click":e.getMenuDetail},scopedSlots:e._u([{key:"default",fn:function({data:a}){return[t("div",{staticClass:"tree-content"},[t("span",{staticClass:"tree-name"},[e._v(e._s(a.name))]),!a.childs||!a.childs.length?t("span",{class:{"menu-status":!0,enable:a.status,disable:!a.status}}):e._e()])]}}])}),t("div",{staticClass:"menu-set"},[t("div",{staticClass:"menu-btns"},[e.hasPermissions("edit")?t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(a){return e.menuStatusMultipleHandler(!1)}}},[e._v("\u6279\u91CF\u505C\u7528")]):e._e(),e.hasPermissions("edit")?t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(a){return e.menuStatusMultipleHandler(!0)}}},[e._v("\u6279\u91CF\u542F\u7528")]):e._e()],1),t("el-table",{staticClass:"plain_table",attrs:{data:e.menuList},on:{"selection-change":a=>{e.multipleSelection=a}}},[t("template",{slot:"empty"},[t("img",{staticStyle:{width:"200px"},attrs:{src:K,alt:""}}),t("span",[e._v("\u6682\u65E0\u6570\u636E\u54E6\uFF5E")])]),t("el-table-column",{attrs:{type:"selection",width:"38"}}),t("el-table-column",{attrs:{prop:"id",label:"ID"}}),t("el-table-column",{attrs:{prop:"name",label:"\u83DC\u5355\u540D\u79F0","show-overflow-tooltip":"","min-width":"90"}}),t("el-table-column",{attrs:{prop:"icon",label:"\u56FE\u6807"}}),t("el-table-column",{attrs:{prop:"parentName",label:"\u4E0A\u7EA7\u83DC\u5355","show-overflow-tooltip":"","min-width":"90"}}),t("el-table-column",{attrs:{prop:"intro",label:"\u83DC\u5355\u8BF4\u660E","show-overflow-tooltip":"","min-width":"90"}}),t("el-table-column",{attrs:{prop:"type",label:"\u83DC\u5355\u7C7B\u578B"}}),t("el-table-column",{attrs:{prop:"status",label:"\u72B6\u6001"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("div",[t("span",{class:{"status-point":!0,success:a.status,gray:!a.status}},[e._v(e._s(a.status?"\u542F\u7528":"\u505C\u7528"))])])]}}])}),t("el-table-column",{attrs:{label:"\u64CD\u4F5C",width:"107"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[e.hasPermissions("edit")?t("el-button",{attrs:{type:"text"},on:{click:function(g){return e.initDialogData(a)}}},[e._v("\u7F16\u8F91")]):e._e(),e.hasPermissions("edit")?t("el-button",{attrs:{type:"text"},on:{click:function(g){return e.menuStatusHandler(a)}}},[e._v(e._s(a.status?"\u505C\u7528":"\u542F\u7528"))]):e._e()]}}])})],2)],1),t("el-dialog",{staticClass:"menu-dialog",attrs:{title:"\u7F16\u8F91",width:"515px",visible:e.dialogVisible,"close-on-click-modal":!1,"before-close":()=>{e.dialogVisible=!1,e.checkAll=!1,e.checked=!1,e.checkedPermission=[]}}},[t("el-form",{attrs:{model:e.formData,"label-width":"85px"}},[t("el-row",{attrs:{gutter:32}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"\u83DC\u5355\u540D\u79F0\uFF1A"}},[t("div",[e._v(e._s(e.formData.name))])])],1),t("el-col",{attrs:{span:16}},[t("el-form-item",{attrs:{label:"\u4E0A\u7EA7\u83DC\u5355\uFF1A"}},[t("div",[e._v(e._s(e.formData.parentName))])])],1)],1),e.formData.type==="system"?t("el-form-item",{attrs:{label:"\u94FE\u63A5\u5730\u5740\uFF1A"}},[t("div",[e._v(e._s(e.formData.router))])]):e._e(),e.formData.type==="other"?t("el-row",[t("el-col",{attrs:{span:20}},[t("el-form-item",{attrs:{label:"\u94FE\u63A5\u5730\u5740\uFF1A"}},[e.hasEditUrl?[t("el-input",{attrs:{placeholder:"\u94FE\u63A5\u5730\u5740",type:"text"},model:{value:e.input,callback:function(a){e.input=typeof a=="string"?a.trim():a},expression:"input"}})]:[t("div",[e._v(e._s(e.formData.router))])]],2)],1),t("el-col",{attrs:{span:4}},[t("el-form-item",[t("el-button",{attrs:{type:"text"},on:{click:function(a){e.hasEditUrl=!e.hasEditUrl}}},[e._v(" "+e._s(e.hasEditUrl?"\u4FDD\u5B58":"\u7F16\u8F91")+" ")])],1)],1)],1):e._e(),t("el-form-item",{attrs:{label:"\u56FE\u6807\uFF1A"}}),t("el-form-item",{attrs:{label:"\u83DC\u5355\u8BF4\u660E\uFF1A"}},[t("div",[e._v(e._s(e.formData.intro))])]),t("el-form-item",{attrs:{label:"\u83DC\u5355\u529F\u80FD\uFF1A"}},[t("el-checkbox",{attrs:{indeterminate:e.checked},on:{change:e.menuPermissionCheckHandler},model:{value:e.checkAll,callback:function(a){e.checkAll=a},expression:"checkAll"}},[e._v("\u5168\u9009 ")]),t("el-checkbox-group",{on:{change:e.menuPermissionCheckHandler},model:{value:e.checkedPermission,callback:function(a){e.checkedPermission=a},expression:"checkedPermission"}},e._l(e.permissionDic,function(a){return t("el-checkbox",{key:a.id,attrs:{label:a.name}},[e._v(" "+e._s(a.intro)+" ")])}),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(a){return e.updateMenu()}}},[e._v("\u786E\u5B9A")]),t("el-button",{on:{click:()=>{e.dialogVisible=!1,e.checkAll=!1,e.checked=!1,e.checkedPermission=[]}}},[e._v("\u53D6\u6D88")])],1)],1)],1)},G=[],R=$(z,F,G,!1,null,"afc25216",null,null);const qe=R.exports;export{qe as default};
