import{h as q,r as l,w as A,y as M,G as j,X as H}from"./_vue@2.7.16@vue-c82c1faf.js";import{n as B,m as J,o as R,p as z,q as K,r as G}from"./index-66a898a3.js";import{e as _}from"./_element-ui@2.15.14@element-ui-d6404236.js";const Q=q({name:"eTree",props:{data:{type:Array},flatData:{type:Array},type:{type:String},range:{type:String},inner:{type:String},initData:{type:Object}},setup(s,{emit:e}){const t=l([]),r=l(),u=l({children:"children",label:"name"}),i=l(""),h=l(s.inner);function x(a){h.value!=="move"&&(i.value=a,e("node-click",a,s.range))}function y(a,n){N.value=!0,I.value="add",L.value=a===0?"\u65B0\u589E\u5206\u7EC4":"\u65B0\u589E\u5206\u7C7B",b.value={parent_id:a===0?"0":n.id}}function k(a,n){N.value=!0,I.value="mod",L.value=a===0?"\u7F16\u8F91\u5206\u7EC4":"\u7F16\u8F91\u5206\u7C7B",b.value={...n,level:a}}async function S(a){console.log(typeof s.type),I.value="del",_.exports.MessageBox.confirm("\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u6570\u636E, \u662F\u5426\u7EE7\u7EED?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"}).then(async()=>{const{children:n}=a;if(n&&n.length>0){_.exports.Message.warning("\u8BF7\u5148\u5220\u9664\u5B50\u7EA7\u6570\u636E");return}const d={1:"getTableList",2:"getFormListByCate",3:"getQryPgLstBySort"};let o;s.type==="3"?o=Object.assign({"/src/apis/qrypage.js":z}):o=Object.assign({"/src/apis/customForm.js":K}),o=Object.values(o)[0];const g=o[d[s.type]],w=await g({pageNum:0,pageSize:0,filter:{sortId:a.id}}).then(m=>{const{status:T,data:C}=m;if(T===104&&C)return C.list});if(w&&w.length>0){const m=w.filter(T=>T.status!=="3");if(m&&m.length>0){_.exports.Message.warning("\u8BF7\u5148\u5220\u9664\u5B50\u7EA7\u6570\u636E");return}}c(a)}).catch(n=>{console.log(n)})}function V(){F.value.validate(a=>{if(a){let n=JSON.parse(JSON.stringify(b.value));delete n.children,delete n.level,c(n),O()}})}function c(a){const n={act:I.value,...a,type:s.type,dat_range:s.range};J(n).then(d=>{const{status:o,msg:g}=d;o===102||o===100?(_.exports.Message.success(g),e("refresh")):_.exports.Message.warning(g)})}function v(a,n){a==="a"?y(n.level,n.data):a==="b"?k(n.level,n.data):a==="c"&&S(n.data)}function p(a){return a.data.id==="-0000"||i.value.id!==a.data.id?!1:!a.data.children||a.data.children.length===0}function f(a,n){return console.log(n.data),n.data.id==="-0000"?!1:n.data.parent_id==="0"}function $(a,n){let d=a.data,o=n.data,g;d.parent_id===o.id?g=!0:g=!o.children.some(m=>m.id===d.id);const w={act:"mov",id:d.id,type:s.type,parent_id:d.parent_id,nparent_id:g?"0":o.id};R(w).then(m=>{const{status:T,msg:C}=m;T==100?(_.exports.Message.success(C),e("refresh")):_.exports.Message.error(C)})}function D(a,n){n&&(e("checkChange",{...a,range:s.range}),r.value.setCheckedKeys([a.id]))}const N=l(!1),b=l({}),F=l(),I=l(""),L=l(""),P=l({name:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0",trigger:["change","input","blur"]}]});function O(){N.value=!1,b.value={},M(()=>{F.value.clearValidate()})}return A(()=>s.data,a=>{if(s.range==="-1")return;t.value=a,h.value==="move"&&r.value.setCheckedKeys([]);let n=a[0];i.value&&s.flatData.find(o=>o.id===i.value.id)&&(n=i.value),x(n),M(()=>{let d=r.value.getNode(i.value.id);d&&(i.value=d.data),r.value.setCurrentKey(n.id)})},{deep:!0}),j(()=>{s.initData&&s.initData.id&&(i.value=s.initData)}),{treeData:t,cTree:r,treeProp:u,currentNode:i,isInner:h,nodeClickHandler:x,addType:y,handleTypeCommand:v,submitHandler:V,allowDrag:p,allowDrop:f,handleDrop:$,checkChange:D,dialogVisible:N,formVal:b,fomValRef:F,title:L,rules:P,closeForm:O}}});var U=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"c-tree",class:{"c-tree_inner":e.isInner,"c-tree_move":e.isInner==="move","c-tree_choose":e.isInner==="choose"}},[t("el-tree",e._b({ref:"cTree",attrs:{data:e.treeData,props:e.treeProp,draggable:"","node-key":"id","default-expand-all":"","show-checkbox":e.isInner==="move","check-strictly":e.isInner==="move","highlight-current":e.isInner!=="move","expand-on-click-node":!1,indent:24,"allow-drop":e.allowDrop,"allow-drag":e.allowDrag},on:{"node-click":e.nodeClickHandler,"node-drop":e.handleDrop,"check-change":e.checkChange},scopedSlots:e._u([{key:"default",fn:function({node:r,data:u}){return[t("div",{staticClass:"c-tree-node"},[r.level===1?t("i",{staticClass:"el-icon-my-folder",class:u.icon?`el-icon-my-${u.icon}`:""}):e._e(),t("span",{staticClass:"c-tree-node-label"},[e._v(e._s(u.name))]),e.type!=="4"?t("span",{staticClass:"c-tree-node-drop",on:{click:function(i){i.stopPropagation()}}},[t("el-dropdown",{attrs:{trigger:"click","hide-on-click":!1},on:{command:i=>{e.handleTypeCommand(i,r)}}},[t("i",{directives:[{name:"show",rawName:"v-show",value:e.currentNode.id===u.id,expression:"currentNode.id === data.id"}],staticClass:"el-icon-my-moreActive"}),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[r.level===1?t("el-dropdown-item",{attrs:{command:"a"}},[e._v("\u65B0\u589E\u5B50\u7C7B")]):e._e(),u.id!=="-0000"?t("el-dropdown-item",{attrs:{command:"b"}},[e._v(e._s(r.level===1?"\u7F16\u8F91\u5206\u7EC4":"\u7F16\u8F91\u5206\u7C7B"))]):e._e(),u.id!=="-0000"?t("el-dropdown-item",{attrs:{command:"c"}},[e._v(e._s(r.level===1?"\u5220\u9664\u5206\u7EC4":"\u5220\u9664\u5206\u7C7B"))]):e._e()],1)],1)],1):e._e()])]}}])},"el-tree",e.$attrs,!1)),e.type!=="4"?t("el-button",{staticClass:"c-tree-add-btn",staticStyle:{margin:"8px 4px 1px 4px"},attrs:{plain:"",type:"primary",icon:"el-icon-plus"},on:{click:function(r){return e.addType(0)}}},[e._v("\u65B0\u589E\u5206\u7EC4")]):e._e(),t("el-dialog",{staticClass:"tree-dialog",attrs:{title:e.title,"close-on-click-modal":!1,visible:e.dialogVisible,"before-close":e.closeForm,"append-to-body":""},on:{"update:visible":function(r){e.dialogVisible=r}}},[t("el-form",{ref:"fomValRef",attrs:{model:e.formVal,rules:e.rules,"label-width":"92px",size:"mini"}},[t("el-form-item",{attrs:{label:e.title.slice(-2)+"\u540D\u79F0\uFF1A",prop:"name",required:""}},[t("el-input",{attrs:{type:"text"},model:{value:e.formVal.name,callback:function(r){e.$set(e.formVal,"name",typeof r=="string"?r.trim():r)},expression:"formVal.name"}})],1),t("el-form-item",{attrs:{label:"\u5E8F\u53F7\uFF1A",prop:"sort_index"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{"controls-position":"right"},model:{value:e.formVal.sort_index,callback:function(r){e.$set(e.formVal,"sort_index",r)},expression:"formVal.sort_index"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.submitHandler}},[e._v("\u786E\u5B9A")]),t("el-button",{on:{click:e.closeForm}},[e._v("\u53D6\u6D88")])],1)],1)],1)},X=[],E=B(Q,U,X,!1,null,"07bf7080",null,null);const W=E.exports;const Y={name:"category",components:{CTree:W},props:{type:{type:String},title:{type:String},inner:{type:String}},setup(s,{emit:e}){const t=H(),r=l("0"),u=l([]),i=l([]),h=l(s.title),x=l(s.inner),y=l(!0);function k(){G(s.type,r.value).then(c=>{const{status:v,data:p}=c;if(v===104){let f=[{id:"0",parent_id:null},{id:"-0000",name:"\u9ED8\u8BA4\u5206\u7EC4",parent_id:"0"},...p];s.type==="4"&&f.splice(1,1),i.value=JSON.parse(JSON.stringify(f)),u.value=S(f,f[0])}})}function S(c,v){let p=c.filter(f=>f.parent_id===v.id);if(p.length>0){for(let f in p){let $=p[f],D=S(c,$);D.length>0&&(p[f].children=D)}return p}else return[]}function V(c){y.value=c,e("tab-toggle",c)}return j(()=>{if(t.initData){const{range:c,dat_range:v}=t.initData;r.value=c||v||"0"}k()}),{activeTab:r,groupCollectFlat:i,groupCollect:u,cTitle:h,isInner:x,showTab:y,getSortList:k,handleShowTab:V}}};var Z=function(){var e=this,t=e._self._c;return t("div",{staticClass:"category",class:{category_hidden:!e.showTab,category_inner:e.isInner}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.showTab,expression:"showTab"}],staticClass:"category-title"},[t("span",[e._v(e._s(e.cTitle))]),t("i",{staticClass:"el-icon-d-arrow-left",on:{click:function(r){return e.handleShowTab(!1)}}})]),t("el-tabs",{directives:[{name:"show",rawName:"v-show",value:e.showTab,expression:"showTab"}],on:{"tab-click":e.getSortList},model:{value:e.activeTab,callback:function(r){e.activeTab=r},expression:"activeTab"}},[t("el-tab-pane",{attrs:{label:"\u7EC4\u7EC7\u7A7A\u95F4",name:"0"}},[t("C-Tree",e._g(e._b({attrs:{inner:e.isInner,type:e.type,range:e.activeTab==="0"?e.activeTab:"-1",data:e.groupCollect,flatData:e.groupCollectFlat},on:{refresh:e.getSortList}},"C-Tree",e.$attrs,!1),e.$listeners))],1),t("el-tab-pane",{attrs:{label:"\u5E73\u53F0\u7A7A\u95F4",name:"1"}},[t("C-Tree",e._g(e._b({attrs:{inner:e.isInner,type:e.type,range:e.activeTab==="1"?e.activeTab:"-1",data:e.groupCollect,flatData:e.groupCollectFlat},on:{refresh:e.getSortList}},"C-Tree",e.$attrs,!1),e.$listeners))],1)],1),t("i",{directives:[{name:"show",rawName:"v-show",value:!e.showTab,expression:"!showTab"}],staticClass:"el-icon-d-arrow-right",on:{click:function(r){return e.handleShowTab(!0)}}})],1)},ee=[],te=B(Y,Z,ee,!1,null,"6eb9296e",null,null);const se=te.exports;export{se as c};
