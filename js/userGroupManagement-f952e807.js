import{h as Y,r as l,O as A,y as z}from"./_vue@2.7.16@vue-c82c1faf.js";import{u as Z}from"./useUserQuery-9522bea9.js";import{n as ee,B as te,C as se,D as ae,E as re,G as ie,H as ne,I as oe,z as le}from"./index-36339b5b.js";import{m as ce}from"./_vuex@3.6.2@vuex-0d722715.js";import{e as g}from"./_element-ui@2.15.14@element-ui-d6404236.js";import"./_@antv_x6-common@2.0.17@@antv-e9d2c7f8.js";import"./_lodash-es@4.17.21@lodash-es-326016e5.js";import"./_axios@1.6.7@axios-8eaa8064.js";import"./_side-channel@1.0.5@side-channel-2c942eb6.js";import"./_get-intrinsic@1.2.4@get-intrinsic-c09dd1a7.js";import"./_es-errors@1.3.0@es-errors-d863dafe.js";import"./_has-symbols@1.0.3@has-symbols-af84758f.js";import"./_has-proto@1.0.1@has-proto-ed1b0be6.js";import"./_function-bind@1.1.2@function-bind-0a5fc7a8.js";import"./_hasown@2.0.1@hasown-7211ef3d.js";import"./_call-bind@1.0.7@call-bind-90319db2.js";import"./_set-function-length@1.2.1@set-function-length-ac203dfa.js";import"./_define-data-property@1.1.4@define-data-property-c2b4af81.js";import"./_es-define-property@1.0.0@es-define-property-86f51ffb.js";import"./_gopd@1.0.1@gopd-7b0e1986.js";import"./_has-property-descriptors@1.0.2@has-property-descriptors-af639a50.js";import"./_qs@6.11.2@qs-d48efb00.js";import"./_vue-router@3.5.3@vue-router-44f70d6f.js";import"./_nanoid@3.3.7@nanoid-3ec3f908.js";import"./_gm-crypto@0.1.12@gm-crypto-48543d3c.js";import"./_to-arraybuffer@1.0.1@to-arraybuffer-dd910a5e.js";import"./_buffer@5.7.1@buffer-81215e29.js";import"./_base64-js@1.5.1@base64-js-554c8894.js";import"./_ieee754@1.2.1@ieee754-0706f68c.js";import"./_jsbn@1.1.0@jsbn-726a10f4.js";import"./_element-resize-detector@1.2.4@element-resize-detector-0b105688.js";import"./_batch-processor@1.0.0@batch-processor-252a9c8d.js";import"./_@vueuse_core@10.7.2@@vueuse-38acc5bf.js";import"./_@vueuse_shared@10.7.2@@vueuse-98aa9f98.js";import"./_vue-demi@0.14.7@vue-demi-52bac217.js";import"./_v-region@2.3.0@v-region-cb5f6f14.js";import"./_@antv_x6@2.18.1@@antv-4eec9d0e.js";import"./_@antv_x6-geometry@2.0.5@@antv-5981308d.js";import"./_@antv_x6-vue-shape@2.1.2@@antv-7a0d94b2.js";import"./_vuedraggable@2.24.3@vuedraggable-f97e6635.js";import"./_sortablejs@1.10.2@sortablejs-2915de19.js";import"./_deepmerge@1.5.2@deepmerge-251d9111.js";import"./_resize-observer-polyfill@1.5.1@resize-observer-polyfill-88ffd6cd.js";import"./_throttle-debounce@1.1.0@throttle-debounce-d93b3c53.js";import"./_babel-helper-vue-jsx-merge-props@2.0.3@babel-helper-vue-jsx-merge-props-72d30afb.js";import"./_normalize-wheel@1.0.1@normalize-wheel-1b789469.js";import"./_async-validator@1.8.5@async-validator-8fabaacf.js";import"./_babel-runtime@6.26.0@babel-runtime-ff8b37cd.js";import"./_core-js@2.6.12@core-js-edebcccf.js";const ue=Y({name:"userGroupManagement",setup(){const u=l("query"),e=A({name:""}),[t,s,n,f,L,D,M]=Z({api:le,params:e});f();const I=l(),p=l({}),b=l(""),v=l(!1),c=l({}),J=A({name:[{required:!0,validator:(r,a,i)=>{a?a&&(a.length<2||a.length>50)?i(new Error("\u59D3\u540D\u957F\u5EA6\u5FC5\u987B\u57282-50\u4F4D\u4E4B\u95F4")):i():i(new Error("\u8BF7\u8F93\u5165\u540D\u79F0"))},trigger:"blur"}]});function R(r){v.value=!0,b.value="\u7F16\u8F91",p.value=JSON.parse(JSON.stringify(r)),c.value=JSON.parse(JSON.stringify(r))}function T(r){g.exports.MessageBox.confirm("\u6B64\u64CD\u4F5C\u5C06\u4F1A\u6C38\u4E45\u5220\u9664\u6570\u636E, \u662F\u5426\u7EE7\u7EED?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"}).then(()=>{te(r.id).then(a=>{const{msg:i}=a;g.exports.Message({type:"success",message:i}),M(r.id),f()})})}function w(r){p.value=JSON.parse(JSON.stringify(r)),u.value="setting",z(()=>{U(r.id)})}function B(){I.value.validate(r=>{if(r)if(b.value==="\u64CD\u4F5C\u5458\u7EC4\u7BA1\u7406\u6DFB\u52A0"){const a={name:c.value.name,status:c.value.status,remarks:c.value.remarks};se(a).then(i=>{const{msg:o}=i;g.exports.Message({type:"success",message:o}),f(),v.value=!1})}else{const a={name:c.value.name,id:c.value.id,status:c.value.status,remarks:c.value.remarks};ae(a).then(i=>{const{msg:o}=i;g.exports.Message({type:"success",message:o}),f(),v.value=!1})}})}function E(){b.value="",I.value.clearValidate(),c.value={}}const $=l(),y=l([]),k=l([]);function U(r){re({id:r}).then(a=>{y.value=a.data,V(y.value[0]),z(()=>{$.value.setCurrentKey(y.value[0].id)})})}function V(r){const a=q(r),o={menuIDList:a.map(O=>O.id),userGroupId:p.value.id,menuName:"",pagePromissio:""};ie(o).then(O=>{if(!O.data)return;let W=O.data.map(x=>{let X=a.find(d=>d.id===x.id),G={};x.operationName.split(",").forEach(d=>{let j=d.split("||");G[j[0]]=j[1]});let S=Object.keys(G),m=x.setOperation?x.setOperation.split(","):[];m=m.filter(d=>S.includes(d));let h,C;return m.length>0?S.length<=m.length?(h=!S.some(d=>!m.includes(d)),C=!h):S.length>m.length&&(h=!1,C=!0):(h=!1,C=!1),{...X,operationName:G,setOperation:m,checked:C,checkAll:h}});k.value=W,console.log(k.value,"menuSetPermission")})}function q(r){let a=[];const{childs:i}=r;if(a.push(r),i)for(let o of i)a=[...a,...q(o)];return a}function H(r,a){let i=Object.keys(a.operationName);Array.isArray(r)?i.length<=r.length?(a.checkAll=!i.some(o=>!r.includes(o)),a.checked=!a.checkAll):(a.checkAll=!1,a.checked=!0):r===!1?(a.checkAll=!1,a.checked=!1,a.setOperation=[]):r===!0&&(a.checkAll=!0,a.checked=!1,a.setOperation=JSON.parse(JSON.stringify(i)))}function F(){const a={dataList:k.value.map(i=>({menuId:i.id,menuStatus:i.menuOperationStatus,permissionList:Object.keys(i.operationName).map(o=>({name:o,status:i.setOperation.includes(o)}))})),userGroupId:p.value.id};ne(a).then(i=>{const{msg:o}=i;g.exports.Message({type:"success",message:o}),f()})}const P=l(),_=A({copyOrigin:""}),N=l(!1);function K(){_.copyOrigin="",N.value=!1,P.value.clearValidate()}function Q(){P.value.validate(r=>{if(r){const a={sourceUserGroupID:_.copyOrigin,targetUserGroupID:p.value.id};oe(a).then(i=>{const{msg:o}=i;g.exports.Message({type:"success",message:o}),U(p.value.id),_.copyOrigin=""}).finally(()=>{N.value=!1})}})}return{pageShow:u,reqLoading:t,page:s,list:n,queryCB:f,changeSize:L,changeCurrent:D,deletePageChange:M,formInlineRef:I,currentRow:p,title:b,dialogVisible:v,formInline:c,rules:J,rowEdit:R,delUserManage:T,permissionStatus:w,submitForm:B,closeDialog:E,menuTree:$,treeData:y,menuSetPermission:k,getMenuOperation:V,menuPermissionCheckHandler:H,saveUserMenuPermission:F,copyRef:P,copyObj:_,copyVisible:N,copyClose:K,saveCopy:Q}},data(){return{pagePermission:[]}},computed:{...ce({menuPermission:u=>u.user.menuPermission})},methods:{hasPermissions(u){return this.pagePermission.some(e=>e.value1===u)}},mounted(){this.pagePermission=this.menuPermission[this.$route.name]}});var pe=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.reqLoading,expression:"reqLoading"}],staticClass:"userGroup-management"},[t("div",{staticClass:"userGroup-header"},[e.pageShow==="query"?[e.hasPermissions("add")?t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:()=>{e.dialogVisible=!0,e.title="\u64CD\u4F5C\u5458\u7EC4\u7BA1\u7406\u6DFB\u52A0"}}},[e._v("\u65B0\u589E")]):e._e()]:[t("el-button",{on:{click:()=>{e.pageShow="query",e.queryCB()}}},[e._v("\u53D6\u6D88")]),t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(s){e.copyVisible=!0}}},[e._v("\u590D\u5236\u6743\u9650")]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveUserMenuPermission}},[e._v("\u4FDD\u5B58")])]],2),e.pageShow==="query"?[t("el-table",{staticClass:"plain_table",staticStyle:{width:"calc(100% - 24px)","margin-left":"12px"},attrs:{"highlight-current-row":"",data:e.list,height:"calc(100% - 104px)"}},[t("el-table-column",{attrs:{prop:"id",label:"ID",width:"100"}}),t("el-table-column",{attrs:{prop:"name",label:"\u540D\u79F0",width:"200"}}),t("el-table-column",{attrs:{prop:"remarks",label:"\u5907\u6CE8","min-width":"200"}}),t("el-table-column",{attrs:{prop:"status",label:"\u72B6\u6001",width:"70"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[t("div",[t("span",{class:s.status===!0?"status-background-color-green":"status-background-color-gray"},[e._v(e._s(s.status?"\u542F\u7528":"\u505C\u7528"))])])]}}],null,!1,1677746998)}),t("el-table-column",{attrs:{label:"\u64CD\u4F5C",width:"160"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[e.hasPermissions("edit")?t("el-button",{attrs:{type:"text"},on:{click:function(n){return e.rowEdit(s)}}},[e._v(" \u7F16\u8F91 ")]):e._e(),e.hasPermissions("edit")?t("el-button",{attrs:{type:"text"},on:{click:function(n){return e.permissionStatus(s)}}},[e._v(" \u6743\u9650 ")]):e._e(),e.hasPermissions("delete")?t("el-button",{attrs:{type:"text"},on:{click:function(n){return e.delUserManage(s)}}},[e._v(" \u5220\u9664 ")]):e._e()]}}],null,!1,4031728632)})],1),t("d-page",{staticClass:"c-paginate",attrs:{"pager-count":5,"current-page":e.page.pageNum,"page-sizes":[10,20,30,50,100],"page-size":e.page.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.page.total},on:{"current-change":e.changeCurrent,"size-change":e.changeSize}})]:[t("div",{staticClass:"userGroup-setting"},[t("el-tree",{ref:"menuTree",attrs:{data:e.treeData,"highlight-current":"",props:{children:"childs",label:"name"},"node-key":"id"},on:{"node-click":e.getMenuOperation}}),t("el-table",{staticClass:"plain_table",attrs:{data:e.menuSetPermission}},[t("el-table-column",{attrs:{prop:"name",label:"\u83DC\u5355\u540D\u79F0","show-overflow-tooltip":"",width:"120"}}),t("el-table-column",{attrs:{prop:"setOperation",label:"\u6743\u9650","min-width":"858"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[t("div",{staticClass:"operation-list"},[t("el-checkbox",{attrs:{indeterminate:s.checked,disabled:!s.menuOperationStatus},on:{change:n=>e.menuPermissionCheckHandler(n,s)},model:{value:s.checkAll,callback:function(n){e.$set(s,"checkAll",n)},expression:"row.checkAll"}},[e._v("\u5168\u9009")]),t("el-checkbox-group",{on:{change:n=>e.menuPermissionCheckHandler(n,s)},model:{value:s.setOperation,callback:function(n){e.$set(s,"setOperation",n)},expression:"row.setOperation"}},e._l(Object.keys(s.operationName),function(n){return t("el-checkbox",{key:n+s.id,attrs:{label:n,disabled:!s.menuOperationStatus}},[e._v(" "+e._s(s.operationName[n])+" ")])}),1)],1)]}}])}),t("el-table-column",{attrs:{prop:"menuOperationStatus",label:"\u542F\u7528",width:"77",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[t("el-switch",{attrs:{mini:"","active-color":"#007aff","inactive-color":"#bfbfbf"},model:{value:s.menuOperationStatus,callback:function(n){e.$set(s,"menuOperationStatus",n)},expression:"row.menuOperationStatus"}})]}}])})],1)],1)],t("el-dialog",{staticClass:"userGroup-dialog",attrs:{title:e.title,visible:e.dialogVisible,width:"572px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(s){e.dialogVisible=s},close:e.closeDialog}},[t("el-form",{ref:"formInlineRef",staticClass:"demo-form-inline",attrs:{model:e.formInline,rules:e.rules}},[t("el-form-item",{attrs:{label:"\u540D\u79F0\uFF1A",prop:"name"}},[t("el-input",{staticClass:"fe-input-176",attrs:{clearable:"",maxlength:"20",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},model:{value:e.formInline.name,callback:function(s){e.$set(e.formInline,"name",s)},expression:"formInline.name"}})],1),t("el-form-item",{attrs:{label:"\u72B6\u6001\uFF1A",prop:"status"}},[t("el-switch",{attrs:{"active-color":"#1890ff","inactive-color":"#b9b9b9"},model:{value:e.formInline.status,callback:function(s){e.$set(e.formInline,"status",s)},expression:"formInline.status"}})],1),t("el-form-item",{staticClass:"fe-lastelement-margin",attrs:{label:"\u5907\u6CE8\uFF1A",prop:"remarks"}},[t("el-input",{staticClass:"fe-texarea-size",attrs:{type:"textarea",rows:3,clearable:"",resize:"none",placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",maxlength:"500","show-word-limit":""},model:{value:e.formInline.remarks,callback:function(s){e.$set(e.formInline,"remarks",s)},expression:"formInline.remarks"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(s){return e.submitForm("formInline")}}},[e._v("\u4FDD\u5B58")]),t("el-button",{on:{click:()=>{e.dialogVisible=!1,e.formInline={}}}},[e._v("\u53D6\u6D88")])],1)],1),t("el-dialog",{staticClass:"copy-dialog",attrs:{title:"\u590D\u5236\u6743\u9650",visible:e.copyVisible,width:"416px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(s){e.copyVisible=s},"before-close":e.copyClose}},[t("el-alert",{attrs:{title:"\u590D\u5236\u6743\u9650\u4F1A\u8986\u76D6\u6389\u8BE5\u7EC4\u4E4B\u524D\u7684\u6743\u9650\u3002",type:"info",closable:!1,"show-icon":""}}),t("el-form",{ref:"copyRef",staticStyle:{"margin-top":"12px"},attrs:{model:e.copyObj}},[t("el-form-item",{attrs:{prop:"copyOrigin",label:"\u590D\u5236\u6765\u6E90","label-width":"80px",rules:{required:!0,message:"\u8BF7\u9009\u62E9\u590D\u5236\u6765\u6E90",trigger:"blur"}}},[t("el-select",{attrs:{clearable:"",placeholder:"\u8BF7\u9009\u62E9"},model:{value:e.copyObj.copyOrigin,callback:function(s){e.$set(e.copyObj,"copyOrigin",s)},expression:"copyObj.copyOrigin"}},e._l(e.list.filter(s=>s.id!==e.currentRow.id),function(s){return t("el-option",{key:s.id,attrs:{label:s.name,value:s.id}})}),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.saveCopy}},[e._v("\u786E\u5B9A")]),t("el-button",{on:{click:()=>{e.copyVisible=!1,e.copyObj.copyOrigin=""}}},[e._v("\u53D6\u6D88")])],1)],1)],2)},me=[],de=ee(ue,pe,me,!1,null,"bb48d636",null,null);const ut=de.exports;export{ut as default};
