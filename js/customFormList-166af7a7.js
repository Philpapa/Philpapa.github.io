import{c as v}from"./category-b830facf.js";import{r as g}from"./renderFormByJson-f12da1d8.js";import{a as _}from"./index-3e7639ed.js";import{F as b}from"./_file-saver@2.0.5@file-saver-fdbc3d5f.js";import{n as w}from"./index-f23e66cc.js";import"./_vue@2.7.16@vue-83e28a6d.js";import"./_@antv_x6-common@2.0.17@@antv-5f61d1c3.js";import"./_lodash-es@4.17.21@lodash-es-326016e5.js";import"./_element-ui@2.15.14@element-ui-fc052bc5.js";import"./_deepmerge@1.5.2@deepmerge-251d9111.js";import"./_resize-observer-polyfill@1.5.1@resize-observer-polyfill-9304753a.js";import"./_throttle-debounce@1.1.0@throttle-debounce-d93b3c53.js";import"./_babel-helper-vue-jsx-merge-props@2.0.3@babel-helper-vue-jsx-merge-props-72d30afb.js";import"./_normalize-wheel@1.0.1@normalize-wheel-1b789469.js";import"./_async-validator@1.8.5@async-validator-0d2cd599.js";import"./_babel-runtime@6.26.0@babel-runtime-ff8b37cd.js";import"./_core-js@2.6.12@core-js-edebcccf.js";import"./_vuex@3.6.2@vuex-0d722715.js";import"./_axios@1.6.6@axios-0e1c8a69.js";import"./_side-channel@1.0.4@side-channel-286692b5.js";import"./_get-intrinsic@1.2.2@get-intrinsic-d65d77de.js";import"./_has-symbols@1.0.3@has-symbols-af84758f.js";import"./_has-proto@1.0.1@has-proto-ed1b0be6.js";import"./_function-bind@1.1.2@function-bind-0a5fc7a8.js";import"./_hasown@2.0.0@hasown-843e4100.js";import"./_call-bind@1.0.5@call-bind-875e1b33.js";import"./_set-function-length@1.2.0@set-function-length-16fcf548.js";import"./_define-data-property@1.1.1@define-data-property-b4413702.js";import"./_has-property-descriptors@1.0.1@has-property-descriptors-19326040.js";import"./_gopd@1.0.1@gopd-5fc553b7.js";import"./_qs@6.11.2@qs-b0c89749.js";import"./_vue-router@3.5.3@vue-router-44f70d6f.js";import"./_nanoid@3.3.7@nanoid-3ec3f908.js";import"./_gm-crypto@0.1.12@gm-crypto-0d53e928.js";import"./_to-arraybuffer@1.0.1@to-arraybuffer-11df8309.js";import"./_buffer@5.7.1@buffer-3f1a9d90.js";import"./_base64-js@1.5.1@base64-js-787d8b6c.js";import"./_ieee754@1.2.1@ieee754-00029a05.js";import"./_jsbn@1.1.0@jsbn-569987c9.js";import"./_element-resize-detector@1.2.4@element-resize-detector-0b105688.js";import"./_batch-processor@1.0.0@batch-processor-252a9c8d.js";import"./_@vueuse_core@10.7.2@@vueuse-c641c031.js";import"./_@vueuse_shared@10.7.2@@vueuse-de6891b4.js";import"./_vue-demi@0.14.6@vue-demi-7b32015b.js";import"./_v-region@2.3.0@v-region-1f02d150.js";import"./_@antv_x6@2.18.1@@antv-b1d372ee.js";import"./_@antv_x6-geometry@2.0.5@@antv-094791ee.js";import"./_@antv_x6-vue-shape@2.1.1@@antv-8e71ca73.js";import"./_vuedraggable@2.24.3@vuedraggable-31bb3ba2.js";import"./_sortablejs@1.10.2@sortablejs-39264ca6.js";const y={name:"customFormList",components:{renderFormByJson:g,category:v},data(){return{loading:!1,tableData:[],arr:{},showVisible:!1,showFormVisible:!1,showMoveVisible:!1,dataSetList:[],bus_field:"",tableset:[],versionMap:{},showMoreId:"",circleStyle:_,showTab:!0,currentDataSet:null,currentDataSetMenu:null,currentGroup:{},tab:"",moveItem:null,moveTNode:null,filterSetName:""}},methods:{saveMove(){if(!this.moveTNode)return;const{id:i,range:t}=this.moveTNode,e={act:"mov",original_id:this.moveItem.original_id,sortId:this.moveItem.sort_id,nsortId:i,dat_range:t};console.log(this.moveItem,"moveItem"),console.log(this.moveTNode,"moveTNode"),this.$api.customForm.actForm(e).then(s=>{const{status:o,msg:r}=s;o==100?(this.$message.success(r),this.getFormListById(this.moveItem.sort_id,this.currentGroup.dat_range)):this.$message.warning(r)}).finally(()=>{this.showMoveVisible=!1,this.moveItem=null,this.moveTNode=null})},getFormListById(i,t){!this.$F.isEmpty(t)&&(this.tab=t),this.loading=!0,this.tableData=[],this.versionMap={},this.showMoreId="";const e={pageNum:0,pageSize:0,filter:{sortId:i,likeVal:"",dat_range:t}};this.$api.customForm.getFormListByCate(e).then(s=>{const{status:o,data:{list:r},msg:c}=s;if(o==104){let n=r||[],m=[],d={};n=n.filter(a=>a.status!=="3"),n.forEach(a=>{let l=a.version.slice(1),u=a.status==="1";a.original_id in d?d[a.original_id].push({...a,v:l,enable:u}):d[a.original_id]=[{...a,v:l,enable:u}]});for(let a in d){let l=d[a];if(l&&l.length>0){l.sort((p,h)=>h.v-p.v);let u=l[0],f=this.onGetFormVersionCache(a);if(f){let p=l.find(h=>h.id===f.id);p&&(u=p)}m.push(u)}}m=m.map(a=>({...a,icon:"el-icon-my-more"})),this.tableData=m,this.versionMap=d}else this.$message.warning(c)}).finally(()=>{this.loading=!1})},async getTableList(i,t){const e={pageNum:0,pageSize:0,filter:{sortId:i,likeVal:"",dat_range:t}};this.$api.customForm.getTableList(e).then(s=>{const{status:o,data:{list:r},msg:c}=s;o==104?this.dataSetList=r:this.$message.warning(c)})},jumpStep(){this.$router.push({name:"formBuilder",params:{isAdd:!0,currentGroup:this.currentGroup}})},nextStep(){if(!this.currentDataSetMenu||!this.currentDataSet){this.$message.warning("\u8BF7\u5148\u9009\u62E9\u6570\u636E\u96C6");return}const{datset_name:i,id:t,sort_id:e,datsource_id:s}=this.currentDataSet,o={datset_id:t,datset_name:i,datsource_id:s,sort_id:this.currentGroup.id,l_sort_id:e,dat_range:this.currentDataSetMenu.range};this.$router.push({name:"formBuilder",params:{isAdd:!0,row:o,currentGroup:this.currentGroup}})},async editFormInfo(i){console.log(i,"row"),await this.getFormText(i.id);const t={isAdd:!1,row:{...i,form_text:this.arr,tableset:this.tableset,dat_range:this.tab},currentGroup:this.currentGroup};this.onSetFormVersionCache(i),this.$router.push({name:"formBuilder",params:t})},getFormText(i){return this.$api.customForm.getFormText({id:i}).then(t=>{t.status==104?(this.arr=JSON.parse(t.data.form_text),this.bus_field=t.data.bus_field||"",this.tableset=t.data.tableset||[]):this.$message.warning(t.msg)})},async preview(i){await this.getFormText(i.id),this.showVisible=!0},changeVersion(i){this.tableData.forEach((t,e)=>{i.original_id===t.original_id&&this.tableData.splice(e,1,{...i,enable:i.status==1})})},handleVersionCommand(i,t){let s=this.versionMap[t.original_id].find(o=>i===o.id);s&&(this.onSetFormVersionCache(s),this.changeVersion(s))},async addVersion(i,t){let s=this.versionMap[i.original_id][0];if(!s)return;let o=s.version.split(""),r;t?r=`v${Number(o[1])+1}.0`:r=`v${o[1]}.${Number(o[3])+1}`,console.log(r),await this.getFormText(i.id);let c=this.tableset.map(n=>({...n,act:"itr"}));this.$api.customForm.submitFormTemp({act:"itr",...i,version:r,form_text:JSON.stringify(this.arr),bus_field:this.bus_field,dat_range:this.currentGroup.dat_range,tableset:c}).then(n=>{n.status==100?(this.$message.success(n.msg),this.onSetFormVersionCache(i,"up"),this.getFormListById(this.currentGroup.id,this.currentGroup.dat_range)):this.$message.warning(n.msg)})},async updateForm(i,t,e){let s=!0;if(e==="deletion"&&(s=await this.$confirm("\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u5DF2\u6784\u5EFA\u6570\u636E, \u662F\u5426\u7EE7\u7EED?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"}).then(()=>!0).catch(()=>!1)),!s)return;const o=e==="deletion"?102:100,r={act:e,id:i.id,original_id:i.original_id,status:t};this.$api.customForm.actForm(r).then(c=>{const{status:n,msg:m}=c;n==o?(this.$message.success(m),["enable","disable"].includes(e)&&this.onSetFormVersionCache(i),this.getFormListById(this.currentGroup.id,this.currentGroup.dat_range)):this.$message.warning(m)})},handleMoreCommand(i,t){i==="a"?this.addVersion(t,!0):i==="b"?this.addVersion(t,!1):i==="c"?this.updateForm(t,"1","enable"):i==="d"?this.updateForm(t,"2","disable"):i==="e"?(this.showMoveVisible=!0,this.moveItem=t):i==="f"&&this.exportData(t)},exportData(i){this.$api.customForm.getFormText({id:i.id}).then(t=>{if(t.status==104){const e=t.data.form_text,s=new Blob([e],{type:""});b.saveAs(s,"data.json"),console.log(e,"formData")}else this.$message({type:"warning",message:t.msg})})},copyVal(i){let t=document.createElement("input");t.value=i,document.body.appendChild(t),t.select(),document.execCommand("copy"),this.$message.success("\u590D\u5236\u6210\u529F"),document.body.removeChild(t)},onToggleFormStatus(i,t){console.log(t,"item"),i?this.updateForm(t,"1","enable"):this.updateForm(t,"2","disable")},onSetFormVersionCache(i,t){let e=this.onGetFormVersionCache();t?delete e[i.original_id]:e[i.original_id]=i,localStorage.setItem("formVersionCache",JSON.stringify(e))},onGetFormVersionCache(i){let t=localStorage.getItem("formVersionCache")||"{}";if(t=JSON.parse(t),!i)return t;if(t[i])return t[i]}},created(){let i=this.$route.params;this.currentGroup=i&&i.currentGroup?i.currentGroup:{}},computed:{filterData(){let i=[];return this.$F.isEmpty(this.filterSetName)?i=this.tableData:i=this.tableData.filter(t=>t.name.includes(this.filterSetName)),i}}};var C=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"asideBox"},[e("category",{attrs:{type:"2",title:"\u8868\u5355\u7BA1\u7406",initData:t.currentGroup},on:{"node-click":(s,o)=>{t.currentGroup={...s,dat_range:o},t.getFormListById(s.id,o)},"tab-toggle":s=>{t.showTab=s}}})],1),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"contentboxRight"},[e("div",{staticClass:"demo-form-inline",class:{isIndent:!t.showTab}},[e("div",{staticClass:"breadCrumb"},[e("span",{staticClass:"cateName"},[t._v(t._s(t.currentGroup.name))]),e("span",{staticClass:"count"},[t._v("/\u5171"+t._s(t.filterData.length)+"\u6761\u6570\u636E")])]),e("div",{staticClass:"filter"},[e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165","suffix-icon":"el-icon-search",size:"mini",maxlength:25},model:{value:t.filterSetName,callback:function(s){t.filterSetName=typeof s=="string"?s.trim():s},expression:"filterSetName"}}),e("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:function(s){t.showFormVisible=!0}}},[t._v("\u65B0\u589E")])],1)]),e("div",{staticClass:"card-container"},[t.filterData&&t.filterData.length>0?t._l(t.filterData,function(s){return e("div",{key:s.id,staticClass:"card-item"},[e("div",{staticClass:"card-item-title",attrs:{title:s.name}},[e("div",{staticClass:"card-item-box"},[e("i",{staticClass:"el-icon-my-formI",class:{"is-draft":s.status==="0"}}),e("div",{staticClass:"card-item-name"},[t._v(" "+t._s(s.name)+" "),e("div",{staticClass:"card-item-version"},[e("el-dropdown",{staticClass:"version-dropMenu",attrs:{trigger:"click"},on:{command:o=>{t.handleVersionCommand(o,s)}}},[e("span",{staticStyle:{cursor:"pointer"}},[e("span",{staticStyle:{color:"#595959","font-size":"14px","margin-right":"8px"}},[t._v(t._s(s.version))]),e("i",{staticClass:"el-dropdown-link el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",t._l(t.versionMap[s.original_id],function(o){return e("el-dropdown-item",{key:o.id,attrs:{command:o.id}},[t._v(t._s(o.version)+" "),e("span",{staticClass:"circleStyle",class:`circleStyle-${t.circleStyle[o.status]}`})])}),1)],1)],1)])]),e("div",{staticClass:"card-item-status"},[e("el-switch",{attrs:{"active-color":"#47a077","inactive-color":"#bfbfbf"},on:{change:o=>t.onToggleFormStatus(o,s)},model:{value:s.enable,callback:function(o){t.$set(s,"enable",o)},expression:"item.enable"}})],1)]),e("div",{staticClass:"card-item-tool"},[e("div",{staticClass:"tools-box"},[s.status!=1?e("div",{staticClass:"tools-btn",on:{click:function(o){return t.editFormInfo(s)}}},[e("dIcon",{attrs:{name:"edit"}}),e("span",[t._v("\u7F16\u8F91")])],1):t._e(),e("div",{staticClass:"tools-btn",on:{click:function(o){return t.preview(s)}}},[e("dIcon",{attrs:{name:"viewLst"}}),e("span",[t._v("\u9884\u89C8")])],1),e("div",{staticClass:"tools-btn",on:{click:function(o){return t.updateForm(s,"3","deletion")}}},[e("dIcon",{attrs:{name:"delLst"}}),e("span",[t._v("\u5220\u9664")])],1),e("div",{directives:[{name:"show",rawName:"v-show",value:s.status==1,expression:"item.status == 1"}],staticClass:"tools-btn"},[e("el-popover",{attrs:{"popper-class":"preview-popover",placement:"bottom",title:"\u8868\u5355\u7F16\u7801",width:"200",trigger:"click","visible-arrow":!1,content:s.id}},[e("span",{attrs:{slot:"reference"},slot:"reference"},[e("d-icon",{attrs:{name:"viewcode"}}),e("span",{on:{click:function(o){return t.copyVal(s.id)}}},[t._v("\u7F16\u7801")])],1)])],1)]),e("div",{staticClass:"card-item-dropMenu"},[e("el-dropdown",{attrs:{trigger:"click","hide-on-click":!1},on:{"visible-change":o=>{o?t.showMoreId=s.id:t.showMoreId=""},command:o=>{t.handleMoreCommand(o,s)}}},[e("i",{staticClass:"el-dropdown-link",class:t.showMoreId===s.id?"el-icon-my-moreActive":"el-icon-my-more",staticStyle:{cursor:"pointer"}}),e("el-dropdown-menu",[e("el-dropdown-item",{attrs:{command:"a"}},[t._v("\u5347\u7EA7\u5927\u7248\u672C")]),e("el-dropdown-item",{attrs:{command:"b"}},[t._v("\u5347\u7EA7\u5C0F\u7248\u672C")]),e("el-dropdown-item",{attrs:{command:"f"}},[t._v("\u5BFC\u51FA\u6A21\u677F")]),e("el-dropdown-item",{attrs:{command:"e"}},[t._v("\u79FB\u52A8\u81F3")])],1)],1)],1)])])}):e("div",{staticClass:"empty-container"},[t._m(0)])],2)]),e("el-dialog",{staticClass:"view-edit",attrs:{title:"\u9009\u62E9\u6570\u636E\u96C6","close-on-click-modal":!1,visible:t.showFormVisible,"before-close":()=>{t.showFormVisible=!1},width:"938px"},on:{"update:visible":function(s){t.showFormVisible=s}}},[e("el-container",[e("el-aside",{attrs:{width:"240px"}},[e("category",{attrs:{type:"1",inner:"choose"},on:{"node-click":(s,o)=>{t.currentDataSetMenu={...s,range:o},t.getTableList(s.id,o)}}})],1),e("el-main",[t.dataSetList.length>0?e("el-row",t._l(t.dataSetList,function(s){return e("el-col",{key:s.id,class:t.currentDataSet&&t.currentDataSet.id===s.id?"box-border":"",attrs:{span:12}},[e("div",{staticClass:"box-btn",on:{click:function(o){t.currentDataSet=JSON.parse(JSON.stringify(s))},dblclick:()=>{t.currentDataSet=JSON.parse(JSON.stringify(s)),t.nextStep()}}},[e("i",{staticClass:"el-icon-my-dataset2"}),e("div",{staticClass:"box-fit"},[t._v(" "+t._s(s.datset_name)+" "),e("div",{staticClass:"databaseName"},[t._v(" "+t._s(s.datset_content)+" ")])])])])}),1):e("div",{staticClass:"fe-full"},[e("div",{staticClass:"empty_pic"},[e("span",[t._v("\u6682\u65E0\u6570\u636E\u54E6\uFF5E")])])])],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:t.jumpStep}},[t._v("\u8DF3\u8FC7")]),e("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.nextStep}},[t._v("\u4E0B\u4E00\u6B65")]),e("el-button",{attrs:{size:"mini"},on:{click:function(s){t.showFormVisible=!1}}},[t._v("\u53D6\u6D88")])],1)],1),e("el-dialog",{staticClass:"view-edit form-view-dialog",attrs:{title:"\u9884\u89C8\u6548\u679C","close-on-click-modal":!1,visible:t.showVisible,"before-close":()=>{t.showVisible=!1}},on:{"update:visible":function(s){t.showVisible=s}}},[e("renderFormByJson",{ref:"rForm",attrs:{data:t.arr}}),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(s){t.showVisible=!1}}},[t._v("\u5173\u95ED")])],1)],1),e("el-dialog",{staticClass:"view-edit move-dialog",attrs:{title:"\u79FB\u52A8\u81F3","close-on-click-modal":!1,visible:t.showMoveVisible,"before-close":()=>{t.showMoveVisible=!1,t.moveItem=null,t.moveTNode=null},width:"500px"},on:{"update:visible":function(s){t.showMoveVisible=s}}},[t.showMoveVisible?e("category",{attrs:{type:"2",inner:"move"},on:{checkChange:s=>{t.moveTNode=s}}}):t._e(),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.saveMove}},[t._v("\u786E\u5B9A")]),e("el-button",{on:{click:()=>{t.showMoveVisible=!1,t.moveItem=null,t.moveTNode=null}}},[t._v("\u53D6\u6D88")])],1)],1)],1)},F=[function(){var i=this,t=i._self._c;return t("div",{staticClass:"empty_pic"},[t("span",[i._v("\u6682\u65E0\u6570\u636E\u54E6\uFF5E")])])}],S=w(y,C,F,!1,null,"4ae89d37",null,null);const yt=S.exports;export{yt as default};
