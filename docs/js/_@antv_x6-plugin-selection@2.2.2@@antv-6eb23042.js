import{l as o}from"./_@antv_x6@2.18.1@@antv-b1d372ee.js";var C=globalThis&&globalThis.__decorate||function(n,e,t,s){var l=arguments.length,i=l<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,s);else for(var r=n.length-1;r>=0;r--)(a=n[r])&&(i=(l<3?a(i):l>3?a(e,t,i):a(e,t))||i);return l>3&&i&&Object.defineProperty(e,t,i),i};class x extends o.View{get graph(){return this.options.graph}get boxClassName(){return this.prefixClassName(d.classNames.box)}get $boxes(){return o.Dom.children(this.container,this.boxClassName)}get handleOptions(){return this.options}constructor(e){super(),this.options=e,this.options.model&&(this.options.collection=this.options.model.collection),this.options.collection?this.collection=this.options.collection:(this.collection=new o.Collection([],{comparator:d.depthComparator}),this.options.collection=this.collection),this.boxCount=0,this.createContainer(),this.startListening()}startListening(){const e=this.graph,t=this.collection;this.delegateEvents({[`mousedown .${this.boxClassName}`]:"onSelectionBoxMouseDown",[`touchstart .${this.boxClassName}`]:"onSelectionBoxMouseDown"},!0),e.on("scale",this.onGraphTransformed,this),e.on("translate",this.onGraphTransformed,this),e.model.on("updated",this.onModelUpdated,this),t.on("added",this.onCellAdded,this),t.on("removed",this.onCellRemoved,this),t.on("reseted",this.onReseted,this),t.on("updated",this.onCollectionUpdated,this),t.on("node:change:position",this.onNodePositionChanged,this),t.on("cell:changed",this.onCellChanged,this)}stopListening(){const e=this.graph,t=this.collection;this.undelegateEvents(),e.off("scale",this.onGraphTransformed,this),e.off("translate",this.onGraphTransformed,this),e.model.off("updated",this.onModelUpdated,this),t.off("added",this.onCellAdded,this),t.off("removed",this.onCellRemoved,this),t.off("reseted",this.onReseted,this),t.off("updated",this.onCollectionUpdated,this),t.off("node:change:position",this.onNodePositionChanged,this),t.off("cell:changed",this.onCellChanged,this)}onRemove(){this.stopListening()}onGraphTransformed(){this.updateSelectionBoxes()}onCellChanged(){this.updateSelectionBoxes()}onNodePositionChanged({node:e,options:t}){const{showNodeSelectionBox:s,pointerEvents:l}=this.options,{ui:i,selection:a,translateBy:r,snapped:h}=t,c=(s!==!0||l&&this.getPointerEventsValue(l)==="none")&&!this.translating&&!a,p=i&&r&&e.id===r;if(c&&(p||h)){this.translating=!0;const u=e.position(),b=e.previous("position"),f=u.x-b.x,m=u.y-b.y;(f!==0||m!==0)&&this.translateSelectedNodes(f,m,e,t),this.translating=!1}}onModelUpdated({removed:e}){e&&e.length&&this.unselect(e)}isEmpty(){return this.length<=0}isSelected(e){return this.collection.has(e)}get length(){return this.collection.length}get cells(){return this.collection.toArray()}select(e,t={}){t.dryrun=!0;const s=this.filter(Array.isArray(e)?e:[e]);return this.collection.add(s,t),this}unselect(e,t={}){return t.dryrun=!0,this.collection.remove(Array.isArray(e)?e:[e],t),this}reset(e,t={}){if(e){if(t.batch){const c=this.filter(Array.isArray(e)?e:[e]);return this.collection.reset(c,Object.assign(Object.assign({},t),{ui:!0})),this}const s=this.cells,l=this.filter(Array.isArray(e)?e:[e]),i={},a={};s.forEach(c=>i[c.id]=c),l.forEach(c=>a[c.id]=c);const r=[],h=[];return l.forEach(c=>{i[c.id]||r.push(c)}),s.forEach(c=>{a[c.id]||h.push(c)}),h.length&&this.unselect(h,Object.assign(Object.assign({},t),{ui:!0})),r.length&&this.select(r,Object.assign(Object.assign({},t),{ui:!0})),h.length===0&&r.length===0&&this.updateContainer(),this}return this.clean(t)}clean(e={}){return this.length&&(e.batch===!1?this.unselect(this.cells,e):this.collection.reset([],Object.assign(Object.assign({},e),{ui:!0}))),this}setFilter(e){this.options.filter=e}setContent(e){this.options.content=e}startSelecting(e){e=this.normalizeEvent(e),this.clean();let t,s;const l=this.graph.container;if(e.offsetX!=null&&e.offsetY!=null&&l.contains(e.target))t=e.offsetX,s=e.offsetY;else{const i=o.Dom.offset(l),a=l.scrollLeft,r=l.scrollTop;t=e.clientX-i.left+window.pageXOffset+a,s=e.clientY-i.top+window.pageYOffset+r}o.Dom.css(this.container,{top:s,left:t,width:1,height:1}),this.setEventData(e,{action:"selecting",clientX:e.clientX,clientY:e.clientY,offsetX:t,offsetY:s,scrollerX:0,scrollerY:0,moving:!1}),this.delegateDocumentEvents(d.documentEvents,e.data)}filter(e){const t=this.options.filter;return e.filter(s=>Array.isArray(t)?t.some(l=>typeof l=="string"?s.shape===l:s.id===l.id):typeof t=="function"?o.FunctionExt.call(t,this.graph,s):!0)}stopSelecting(e){const t=this.graph,s=this.getEventData(e);switch(s.action){case"selecting":{let i=o.Dom.width(this.container),a=o.Dom.height(this.container);const r=o.Dom.offset(this.container),h=t.pageToLocal(r.left,r.top),c=t.transform.getScale();i/=c.sx,a/=c.sy;const p=new o.Rectangle(h.x,h.y,i,a),u=this.getCellViewsInArea(p).map(b=>b.cell);this.reset(u,{batch:!0}),this.hideRubberband();break}case"translating":{const i=t.snapToGrid(e.clientX,e.clientY);if(!this.options.following){const a=s;this.updateSelectedNodesPosition({dx:a.clientX-a.originX,dy:a.clientY-a.originY})}this.graph.model.stopBatch("move-selection"),this.notifyBoxEvent("box:mouseup",e,i.x,i.y);break}default:{this.clean();break}}}onMouseUp(e){this.getEventData(e).action&&(this.stopSelecting(e),this.undelegateDocumentEvents())}onSelectionBoxMouseDown(e){this.options.following||e.stopPropagation();const t=this.normalizeEvent(e);this.options.movable&&this.startTranslating(t);const s=this.getCellViewFromElem(t.target);this.setEventData(t,{activeView:s});const l=this.graph.snapToGrid(t.clientX,t.clientY);this.notifyBoxEvent("box:mousedown",t,l.x,l.y),this.delegateDocumentEvents(d.documentEvents,t.data)}startTranslating(e){this.graph.model.startBatch("move-selection");const t=this.graph.snapToGrid(e.clientX,e.clientY);this.setEventData(e,{action:"translating",clientX:t.x,clientY:t.y,originX:t.x,originY:t.y})}getRestrictArea(){const e=this.graph.options.translating.restrict,t=typeof e=="function"?o.FunctionExt.call(e,this.graph,null):e;return typeof t=="number"?this.graph.transform.getGraphArea().inflate(t):t===!0?this.graph.transform.getGraphArea():t||null}getSelectionOffset(e,t){let s=e.x-t.clientX,l=e.y-t.clientY;const i=this.getRestrictArea();if(i){const a=this.collection.toArray(),r=o.Cell.getCellsBBox(a,{deep:!0})||o.Rectangle.create(),h=i.x-r.x,c=i.y-r.y,p=i.x+i.width-(r.x+r.width),u=i.y+i.height-(r.y+r.height);if(s<h&&(s=h),l<c&&(l=c),p<s&&(s=p),u<l&&(l=u),!this.options.following){const b=e.x-t.originX,f=e.y-t.originY;s=b<=h||b>=p?0:s,l=f<=c||f>=u?0:l}}return{dx:s,dy:l}}updateElementPosition(e,t,s){const l=o.Dom.css(e,"left"),i=o.Dom.css(e,"top"),a=l?parseFloat(l):0,r=i?parseFloat(i):0;o.Dom.css(e,"left",a+t),o.Dom.css(e,"top",r+s)}updateSelectedNodesPosition(e){const{dx:t,dy:s}=e;if(t||s)if(this.translateSelectedNodes(t,s),this.boxesUpdated)this.collection.length>1&&this.updateSelectionBoxes();else{const l=this.graph.transform.getScale();for(let i=0,a=this.$boxes,r=a.length;i<r;i+=1)this.updateElementPosition(a[i],t*l.sx,s*l.sy);this.updateElementPosition(this.selectionContainer,t*l.sx,s*l.sy)}}autoScrollGraph(e,t){const s=this.graph.getPlugin("scroller");return s?s.autoScroll(e,t):{scrollerX:0,scrollerY:0}}adjustSelection(e){const t=this.normalizeEvent(e),s=this.getEventData(t);switch(s.action){case"selecting":{const i=s;i.moving!==!0&&(o.Dom.appendTo(this.container,this.graph.container),this.showRubberband(),i.moving=!0);const{scrollerX:a,scrollerY:r}=this.autoScrollGraph(t.clientX,t.clientY);i.scrollerX+=a,i.scrollerY+=r;const h=t.clientX-i.clientX+i.scrollerX,c=t.clientY-i.clientY+i.scrollerY,p=parseInt(o.Dom.css(this.container,"left")||"0",10),u=parseInt(o.Dom.css(this.container,"top")||"0",10);o.Dom.css(this.container,{left:h<0?i.offsetX+h:p,top:c<0?i.offsetY+c:u,width:Math.abs(h),height:Math.abs(c)});break}case"translating":{const i=this.graph.snapToGrid(t.clientX,t.clientY),a=s,r=this.getSelectionOffset(i,a);this.options.following?this.updateSelectedNodesPosition(r):this.updateContainerPosition(r),r.dx&&(a.clientX=i.x),r.dy&&(a.clientY=i.y),this.notifyBoxEvent("box:mousemove",e,i.x,i.y);break}}this.boxesUpdated=!1}translateSelectedNodes(e,t,s,l){const i={},a=[];if(s&&(i[s.id]=!0),this.collection.toArray().forEach(r=>{r.getDescendants({deep:!0}).forEach(h=>{i[h.id]=!0})}),l&&l.translateBy){const r=this.graph.getCellById(l.translateBy);r&&(i[r.id]=!0,r.getDescendants({deep:!0}).forEach(h=>{i[h.id]=!0}),a.push(r))}this.collection.toArray().forEach(r=>{if(!i[r.id]){const h=Object.assign(Object.assign({},l),{selection:this.cid,exclude:a});r.translate(e,t,h),this.graph.model.getConnectedEdges(r).forEach(c=>{i[c.id]||(c.translate(e,t,h),i[c.id]=!0)})}})}getCellViewsInArea(e){const t=this.graph,s={strict:this.options.strict};let l=[];return this.options.rubberNode&&(l=l.concat(t.model.getNodesInArea(e,s).map(i=>t.renderer.findViewByCell(i)).filter(i=>i!=null))),this.options.rubberEdge&&(l=l.concat(t.model.getEdgesInArea(e,s).map(i=>t.renderer.findViewByCell(i)).filter(i=>i!=null))),l}notifyBoxEvent(e,t,s,l){const a=this.getEventData(t).activeView;this.trigger(e,{e:t,view:a,x:s,y:l,cell:a.cell})}getSelectedClassName(e){return this.prefixClassName(`${e.isNode()?"node":"edge"}-selected`)}addCellSelectedClassName(e){const t=this.graph.renderer.findViewByCell(e);t&&t.addClass(this.getSelectedClassName(e))}removeCellUnSelectedClassName(e){const t=this.graph.renderer.findViewByCell(e);t&&t.removeClass(this.getSelectedClassName(e))}destroySelectionBox(e){this.removeCellUnSelectedClassName(e),this.canShowSelectionBox(e)&&(o.Dom.remove(this.container.querySelector(`[data-cell-id="${e.id}"]`)),this.$boxes.length===0&&this.hide(),this.boxCount=Math.max(0,this.boxCount-1))}destroyAllSelectionBoxes(e){e.forEach(t=>this.removeCellUnSelectedClassName(t)),this.hide(),o.Dom.remove(this.$boxes),this.boxCount=0}hide(){o.Dom.removeClass(this.container,this.prefixClassName(d.classNames.rubberband)),o.Dom.removeClass(this.container,this.prefixClassName(d.classNames.selected))}showRubberband(){o.Dom.addClass(this.container,this.prefixClassName(d.classNames.rubberband))}hideRubberband(){o.Dom.removeClass(this.container,this.prefixClassName(d.classNames.rubberband))}showSelected(){o.Dom.removeAttribute(this.container,"style"),o.Dom.addClass(this.container,this.prefixClassName(d.classNames.selected))}createContainer(){this.container=document.createElement("div"),o.Dom.addClass(this.container,this.prefixClassName(d.classNames.root)),this.options.className&&o.Dom.addClass(this.container,this.options.className),this.selectionContainer=document.createElement("div"),o.Dom.addClass(this.selectionContainer,this.prefixClassName(d.classNames.inner)),this.selectionContent=document.createElement("div"),o.Dom.addClass(this.selectionContent,this.prefixClassName(d.classNames.content)),o.Dom.append(this.selectionContainer,this.selectionContent),o.Dom.attr(this.selectionContainer,"data-selection-length",this.collection.length),o.Dom.prepend(this.container,this.selectionContainer)}updateContainerPosition(e){(e.dx||e.dy)&&this.updateElementPosition(this.selectionContainer,e.dx,e.dy)}updateContainer(){const e={x:1/0,y:1/0},t={x:0,y:0};this.collection.toArray().filter(i=>this.canShowSelectionBox(i)).forEach(i=>{const a=this.graph.renderer.findViewByCell(i);if(a){const r=a.getBBox({useCellGeometry:!0});e.x=Math.min(e.x,r.x),e.y=Math.min(e.y,r.y),t.x=Math.max(t.x,r.x+r.width),t.y=Math.max(t.y,r.y+r.height)}}),o.Dom.css(this.selectionContainer,{position:"absolute",pointerEvents:"none",left:e.x,top:e.y,width:t.x-e.x,height:t.y-e.y}),o.Dom.attr(this.selectionContainer,"data-selection-length",this.collection.length);const l=this.options.content;if(l)if(typeof l=="function"){const i=o.FunctionExt.call(l,this.graph,this,this.selectionContent);i&&(this.selectionContent.innerHTML=i)}else this.selectionContent.innerHTML=l;this.collection.length>0&&!this.container.parentNode?o.Dom.appendTo(this.container,this.graph.container):this.collection.length<=0&&this.container.parentNode&&this.container.parentNode.removeChild(this.container)}canShowSelectionBox(e){return e.isNode()&&this.options.showNodeSelectionBox===!0||e.isEdge()&&this.options.showEdgeSelectionBox===!0}getPointerEventsValue(e){return typeof e=="string"?e:e(this.cells)}createSelectionBox(e){if(this.addCellSelectedClassName(e),this.canShowSelectionBox(e)){const t=this.graph.renderer.findViewByCell(e);if(t){const s=t.getBBox({useCellGeometry:!0}),l=this.boxClassName,i=document.createElement("div"),a=this.options.pointerEvents;o.Dom.addClass(i,l),o.Dom.addClass(i,`${l}-${e.isNode()?"node":"edge"}`),o.Dom.attr(i,"data-cell-id",e.id),o.Dom.css(i,{position:"absolute",left:s.x,top:s.y,width:s.width,height:s.height,pointerEvents:a?this.getPointerEventsValue(a):"auto"}),o.Dom.appendTo(i,this.container),this.showSelected(),this.boxCount+=1}}}updateSelectionBoxes(){this.collection.length>0&&(this.boxesUpdated=!0,this.confirmUpdate())}confirmUpdate(){if(this.boxCount){this.hide();for(let e=0,t=this.$boxes,s=t.length;e<s;e+=1){const l=t[e],i=o.Dom.attr(l,"data-cell-id");o.Dom.remove(l),this.boxCount-=1;const a=this.collection.get(i);a&&this.createSelectionBox(a)}this.updateContainer()}return 0}getCellViewFromElem(e){const t=e.getAttribute("data-cell-id");if(t){const s=this.collection.get(t);if(s)return this.graph.renderer.findViewByCell(s)}return null}onCellRemoved({cell:e}){this.destroySelectionBox(e),this.updateContainer()}onReseted({previous:e,current:t}){this.destroyAllSelectionBoxes(e),t.forEach(s=>{this.listenCellRemoveEvent(s),this.createSelectionBox(s)}),this.updateContainer()}onCellAdded({cell:e}){this.listenCellRemoveEvent(e),this.createSelectionBox(e),this.updateContainer()}listenCellRemoveEvent(e){e.off("removed",this.onCellRemoved,this),e.on("removed",this.onCellRemoved,this)}onCollectionUpdated({added:e,removed:t,options:s}){e.forEach(i=>{this.trigger("cell:selected",{cell:i,options:s}),i.isNode()?this.trigger("node:selected",{cell:i,options:s,node:i}):i.isEdge()&&this.trigger("edge:selected",{cell:i,options:s,edge:i})}),t.forEach(i=>{this.trigger("cell:unselected",{cell:i,options:s}),i.isNode()?this.trigger("node:unselected",{cell:i,options:s,node:i}):i.isEdge()&&this.trigger("edge:unselected",{cell:i,options:s,edge:i})});const l={added:e,removed:t,options:s,selected:this.cells.filter(i=>!!this.graph.getCellById(i.id))};this.trigger("selection:changed",l)}dispose(){this.clean(),this.remove(),this.off()}}C([o.View.dispose()],x.prototype,"dispose",null);var d;(function(n){const e="widget-selection";n.classNames={root:e,inner:`${e}-inner`,box:`${e}-box`,content:`${e}-content`,rubberband:`${e}-rubberband`,selected:`${e}-selected`},n.documentEvents={mousemove:"adjustSelection",touchmove:"adjustSelection",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"};function t(s){return s.getAncestors().length}n.depthComparator=t})(d||(d={}));const y=`.x6-widget-selection {
  position: absolute;
  top: 0;
  left: 0;
  display: none;
  width: 0;
  height: 0;
  touch-action: none;
}
.x6-widget-selection-rubberband {
  display: block;
  overflow: visible;
  opacity: 0.3;
}
.x6-widget-selection-selected {
  display: block;
}
.x6-widget-selection-box {
  cursor: move;
}
.x6-widget-selection-inner[data-selection-length='0'],
.x6-widget-selection-inner[data-selection-length='1'] {
  display: none;
}
.x6-widget-selection-content {
  position: absolute;
  top: 100%;
  right: -20px;
  left: -20px;
  margin-top: 30px;
  padding: 6px;
  line-height: 14px;
  text-align: center;
  border-radius: 6px;
}
.x6-widget-selection-content:empty {
  display: none;
}
.x6-widget-selection-rubberband {
  background-color: #3498db;
  border: 2px solid #2980b9;
}
.x6-widget-selection-box {
  box-sizing: content-box !important;
  margin-top: -4px;
  margin-left: -4px;
  padding-right: 4px;
  padding-bottom: 4px;
  border: 2px dashed #feb663;
  box-shadow: 2px 2px 5px #d3d3d3;
}
.x6-widget-selection-inner {
  box-sizing: content-box !important;
  margin-top: -8px;
  margin-left: -8px;
  padding-right: 12px;
  padding-bottom: 12px;
  border: 2px solid #feb663;
  box-shadow: 2px 2px 5px #d3d3d3;
}
.x6-widget-selection-content {
  color: #fff;
  font-size: 10px;
  background-color: #6a6b8a;
}
`;o.Graph.prototype.isSelectionEnabled=function(){const n=this.getPlugin("selection");return n?n.isEnabled():!1};o.Graph.prototype.enableSelection=function(){const n=this.getPlugin("selection");return n&&n.enable(),this};o.Graph.prototype.disableSelection=function(){const n=this.getPlugin("selection");return n&&n.disable(),this};o.Graph.prototype.toggleSelection=function(n){const e=this.getPlugin("selection");return e&&e.toggleEnabled(n),this};o.Graph.prototype.isMultipleSelection=function(){const n=this.getPlugin("selection");return n?n.isMultipleSelection():!1};o.Graph.prototype.enableMultipleSelection=function(){const n=this.getPlugin("selection");return n&&n.enableMultipleSelection(),this};o.Graph.prototype.disableMultipleSelection=function(){const n=this.getPlugin("selection");return n&&n.disableMultipleSelection(),this};o.Graph.prototype.toggleMultipleSelection=function(n){const e=this.getPlugin("selection");return e&&e.toggleMultipleSelection(n),this};o.Graph.prototype.isSelectionMovable=function(){const n=this.getPlugin("selection");return n?n.isSelectionMovable():!1};o.Graph.prototype.enableSelectionMovable=function(){const n=this.getPlugin("selection");return n&&n.enableSelectionMovable(),this};o.Graph.prototype.disableSelectionMovable=function(){const n=this.getPlugin("selection");return n&&n.disableSelectionMovable(),this};o.Graph.prototype.toggleSelectionMovable=function(n){const e=this.getPlugin("selection");return e&&e.toggleSelectionMovable(n),this};o.Graph.prototype.isRubberbandEnabled=function(){const n=this.getPlugin("selection");return n?n.isRubberbandEnabled():!1};o.Graph.prototype.enableRubberband=function(){const n=this.getPlugin("selection");return n&&n.enableRubberband(),this};o.Graph.prototype.disableRubberband=function(){const n=this.getPlugin("selection");return n&&n.disableRubberband(),this};o.Graph.prototype.toggleRubberband=function(n){const e=this.getPlugin("selection");return e&&e.toggleRubberband(n),this};o.Graph.prototype.isStrictRubberband=function(){const n=this.getPlugin("selection");return n?n.isStrictRubberband():!1};o.Graph.prototype.enableStrictRubberband=function(){const n=this.getPlugin("selection");return n&&n.enableStrictRubberband(),this};o.Graph.prototype.disableStrictRubberband=function(){const n=this.getPlugin("selection");return n&&n.disableStrictRubberband(),this};o.Graph.prototype.toggleStrictRubberband=function(n){const e=this.getPlugin("selection");return e&&e.toggleStrictRubberband(n),this};o.Graph.prototype.setRubberbandModifiers=function(n){const e=this.getPlugin("selection");return e&&e.setRubberbandModifiers(n),this};o.Graph.prototype.setSelectionFilter=function(n){const e=this.getPlugin("selection");return e&&e.setSelectionFilter(n),this};o.Graph.prototype.setSelectionDisplayContent=function(n){const e=this.getPlugin("selection");return e&&e.setSelectionDisplayContent(n),this};o.Graph.prototype.isSelectionEmpty=function(){const n=this.getPlugin("selection");return n?n.isEmpty():!0};o.Graph.prototype.cleanSelection=function(n){const e=this.getPlugin("selection");return e&&e.clean(n),this};o.Graph.prototype.resetSelection=function(n,e){const t=this.getPlugin("selection");return t&&t.reset(n,e),this};o.Graph.prototype.getSelectedCells=function(){const n=this.getPlugin("selection");return n?n.getSelectedCells():[]};o.Graph.prototype.getSelectedCellCount=function(){const n=this.getPlugin("selection");return n?n.getSelectedCellCount():0};o.Graph.prototype.isSelected=function(n){const e=this.getPlugin("selection");return e?e.isSelected(n):!1};o.Graph.prototype.select=function(n,e){const t=this.getPlugin("selection");return t&&t.select(n,e),this};o.Graph.prototype.unselect=function(n,e){const t=this.getPlugin("selection");return t&&t.unselect(n,e),this};var S=globalThis&&globalThis.__decorate||function(n,e,t,s){var l=arguments.length,i=l<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,s);else for(var r=n.length-1;r>=0;r--)(a=n[r])&&(i=(l<3?a(i):l>3?a(e,t,i):a(e,t))||i);return l>3&&i&&Object.defineProperty(e,t,i),i};class g extends o.Basecoat{get rubberbandDisabled(){return this.options.enabled!==!0||this.options.rubberband!==!0}get disabled(){return this.options.enabled!==!0}get length(){return this.selectionImpl.length}get cells(){return this.selectionImpl.cells}constructor(e={}){super(),this.name="selection",this.movedMap=new WeakMap,this.unselectMap=new WeakMap,this.options=Object.assign(Object.assign({enabled:!0},g.defaultOptions),e),o.CssLoader.ensure(this.name,y)}init(e){this.graph=e,this.selectionImpl=new x(Object.assign(Object.assign({},this.options),{graph:e})),this.setup(),this.startListening()}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(e){return e!=null?e!==this.isEnabled()&&(e?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}isMultipleSelection(){return this.isMultiple()}enableMultipleSelection(){return this.enableMultiple(),this}disableMultipleSelection(){return this.disableMultiple(),this}toggleMultipleSelection(e){return e!=null?e!==this.isMultipleSelection()&&(e?this.enableMultipleSelection():this.disableMultipleSelection()):this.isMultipleSelection()?this.disableMultipleSelection():this.enableMultipleSelection(),this}isSelectionMovable(){return this.options.movable!==!1}enableSelectionMovable(){return this.selectionImpl.options.movable=!0,this}disableSelectionMovable(){return this.selectionImpl.options.movable=!1,this}toggleSelectionMovable(e){return e!=null?e!==this.isSelectionMovable()&&(e?this.enableSelectionMovable():this.disableSelectionMovable()):this.isSelectionMovable()?this.disableSelectionMovable():this.enableSelectionMovable(),this}isRubberbandEnabled(){return!this.rubberbandDisabled}enableRubberband(){return this.rubberbandDisabled&&(this.options.rubberband=!0),this}disableRubberband(){return this.rubberbandDisabled||(this.options.rubberband=!1),this}toggleRubberband(e){return e!=null?e!==this.isRubberbandEnabled()&&(e?this.enableRubberband():this.disableRubberband()):this.isRubberbandEnabled()?this.disableRubberband():this.enableRubberband(),this}isStrictRubberband(){return this.selectionImpl.options.strict===!0}enableStrictRubberband(){return this.selectionImpl.options.strict=!0,this}disableStrictRubberband(){return this.selectionImpl.options.strict=!1,this}toggleStrictRubberband(e){return e!=null?e!==this.isStrictRubberband()&&(e?this.enableStrictRubberband():this.disableStrictRubberband()):this.isStrictRubberband()?this.disableStrictRubberband():this.enableStrictRubberband(),this}setRubberbandModifiers(e){this.setModifiers(e)}setSelectionFilter(e){return this.setFilter(e),this}setSelectionDisplayContent(e){return this.setContent(e),this}isEmpty(){return this.length<=0}clean(e={}){return this.selectionImpl.clean(e),this}reset(e,t={}){return this.selectionImpl.reset(e?this.getCells(e):[],t),this}getSelectedCells(){return this.cells}getSelectedCellCount(){return this.length}isSelected(e){return this.selectionImpl.isSelected(e)}select(e,t={}){const s=this.getCells(e);return s.length&&(this.isMultiple()?this.selectionImpl.select(s,t):this.reset(s.slice(0,1),t)),this}unselect(e,t={}){return this.selectionImpl.unselect(this.getCells(e),t),this}setup(){this.selectionImpl.on("*",(e,t)=>{this.trigger(e,t),this.graph.trigger(e,t)})}startListening(){this.graph.on("blank:mousedown",this.onBlankMouseDown,this),this.graph.on("blank:click",this.onBlankClick,this),this.graph.on("cell:mousemove",this.onCellMouseMove,this),this.graph.on("cell:mouseup",this.onCellMouseUp,this),this.selectionImpl.on("box:mousedown",this.onBoxMouseDown,this)}stopListening(){this.graph.off("blank:mousedown",this.onBlankMouseDown,this),this.graph.off("blank:click",this.onBlankClick,this),this.graph.off("cell:mousemove",this.onCellMouseMove,this),this.graph.off("cell:mouseup",this.onCellMouseUp,this),this.selectionImpl.off("box:mousedown",this.onBoxMouseDown,this)}onBlankMouseDown({e}){if(!this.allowBlankMouseDown(e))return;const t=this.graph.panning.allowPanning(e,!0),s=this.graph.getPlugin("scroller"),l=s&&s.allowPanning(e,!0);(this.allowRubberband(e,!0)||this.allowRubberband(e)&&!l&&!t)&&this.startRubberband(e)}allowBlankMouseDown(e){const t=this.options.eventTypes;return(t==null?void 0:t.includes("leftMouseDown"))&&e.button===0||(t==null?void 0:t.includes("mouseWheelDown"))&&e.button===1}onBlankClick(){this.clean()}allowRubberband(e,t){return!this.rubberbandDisabled&&o.ModifierKey.isMatch(e,this.options.modifiers,t)}allowMultipleSelection(e){return this.isMultiple()&&o.ModifierKey.isMatch(e,this.options.multipleSelectionModifiers)}onCellMouseMove({cell:e}){this.movedMap.set(e,!0)}onCellMouseUp({e,cell:t}){const s=this.options;let l=this.disabled;!l&&this.movedMap.has(t)&&(l=s.selectCellOnMoved===!1,l||(l=s.selectNodeOnMoved===!1&&t.isNode()),l||(l=s.selectEdgeOnMoved===!1&&t.isEdge())),l||(this.allowMultipleSelection(e)?this.unselectMap.has(t)?this.unselectMap.delete(t):this.isSelected(t)?this.unselect(t):this.select(t):this.reset(t)),this.movedMap.delete(t)}onBoxMouseDown({e,cell:t}){this.disabled||this.allowMultipleSelection(e)&&(this.unselect(t),this.unselectMap.set(t,!0))}getCells(e){return(Array.isArray(e)?e:[e]).map(t=>typeof t=="string"?this.graph.getCellById(t):t).filter(t=>t!=null)}startRubberband(e){return this.rubberbandDisabled||this.selectionImpl.startSelecting(e),this}isMultiple(){return this.options.multiple!==!1}enableMultiple(){return this.options.multiple=!0,this}disableMultiple(){return this.options.multiple=!1,this}setModifiers(e){return this.options.modifiers=e,this}setContent(e){return this.selectionImpl.setContent(e),this}setFilter(e){return this.selectionImpl.setFilter(e),this}dispose(){this.stopListening(),this.off(),this.selectionImpl.dispose(),o.CssLoader.clean(this.name)}}S([o.Basecoat.dispose()],g.prototype,"dispose",null);(function(n){n.defaultOptions={rubberband:!1,rubberNode:!0,rubberEdge:!1,pointerEvents:"auto",multiple:!0,multipleSelectionModifiers:["ctrl","meta"],movable:!0,strict:!1,selectCellOnMoved:!1,selectNodeOnMoved:!1,selectEdgeOnMoved:!1,following:!0,content:null,eventTypes:["leftMouseDown","mouseWheelDown"]}})(g||(g={}));export{g as S};
