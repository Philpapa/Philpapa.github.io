import{M as X,r as o,a4 as A,Y as Z,g as ee,l as g,a7 as te,z,a8 as se,a9 as ae,aa as ne,ab as le,ac as re,ad as ie,a5 as oe}from"./index.0af4b258.js";import{u as ce}from"./useUserQuery.3719189f.js";const ue=X({name:"userGroupManagement",setup(){const u=o("query"),e=A({name:""}),[t,s,r,f,L,D,M]=ce({api:oe,params:e});f();const P=o(),p=o({}),b=o(""),v=o(!1),c=o({}),J=A({name:[{required:!0,validator:(n,a,l)=>{a?a&&(a.length<2||a.length>50)?l(new Error("\u59D3\u540D\u957F\u5EA6\u5FC5\u987B\u57282-50\u4F4D\u4E4B\u95F4")):l():l(new Error("\u8BF7\u8F93\u5165\u540D\u79F0"))},trigger:"blur"}]});function R(n){v.value=!0,b.value="\u7F16\u8F91",p.value=JSON.parse(JSON.stringify(n)),c.value=JSON.parse(JSON.stringify(n))}function T(n){g.exports.MessageBox.confirm("\u6B64\u64CD\u4F5C\u5C06\u4F1A\u6C38\u4E45\u5220\u9664\u6570\u636E, \u662F\u5426\u7EE7\u7EED?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"}).then(()=>{te(n.id).then(a=>{const{msg:l}=a;g.exports.Message({type:"success",message:l}),M(n.id),f()})})}function w(n){p.value=JSON.parse(JSON.stringify(n)),u.value="setting",z(()=>{U(n.id)})}function B(){P.value.validate(n=>{if(n)if(b.value==="\u64CD\u4F5C\u5458\u7EC4\u7BA1\u7406\u6DFB\u52A0"){const a={name:c.value.name,status:c.value.status,remarks:c.value.remarks};se(a).then(l=>{const{msg:i}=l;g.exports.Message({type:"success",message:i}),f(),v.value=!1})}else{const a={name:c.value.name,id:c.value.id,status:c.value.status,remarks:c.value.remarks};ae(a).then(l=>{const{msg:i}=l;g.exports.Message({type:"success",message:i}),f(),v.value=!1})}})}function E(){b.value="",P.value.clearValidate(),c.value={}}const $=o(),y=o([]),k=o([]);function U(n){ne({id:n}).then(a=>{y.value=a.data,V(y.value[0]),z(()=>{$.value.setCurrentKey(y.value[0].id)})})}function V(n){const a=q(n),i={menuIDList:a.map(O=>O.id),userGroupId:p.value.id,menuName:"",pagePromissio:""};le(i).then(O=>{if(!O.data)return;let Y=O.data.map(x=>{let W=a.find(d=>d.id===x.id),G={};x.operationName.split(",").forEach(d=>{let j=d.split("||");G[j[0]]=j[1]});let S=Object.keys(G),m=x.setOperation?x.setOperation.split(","):[];m=m.filter(d=>S.includes(d));let h,C;return m.length>0?S.length<=m.length?(h=!S.some(d=>!m.includes(d)),C=!h):S.length>m.length&&(h=!1,C=!0):(h=!1,C=!1),{...W,operationName:G,setOperation:m,checked:C,checkAll:h}});k.value=Y,console.log(k.value,"menuSetPermission")})}function q(n){let a=[];const{childs:l}=n;if(a.push(n),l)for(let i of l)a=[...a,...q(i)];return a}function F(n,a){let l=Object.keys(a.operationName);Array.isArray(n)?l.length<=n.length?(a.checkAll=!l.some(i=>!n.includes(i)),a.checked=!a.checkAll):(a.checkAll=!1,a.checked=!0):n===!1?(a.checkAll=!1,a.checked=!1,a.setOperation=[]):n===!0&&(a.checkAll=!0,a.checked=!1,a.setOperation=JSON.parse(JSON.stringify(l)))}function H(){const a={dataList:k.value.map(l=>({menuId:l.id,menuStatus:l.menuOperationStatus,permissionList:Object.keys(l.operationName).map(i=>({name:i,status:l.setOperation.includes(i)}))})),userGroupId:p.value.id};re(a).then(l=>{const{msg:i}=l;g.exports.Message({type:"success",message:i}),f()})}const I=o(),_=A({copyOrigin:""}),N=o(!1);function K(){_.copyOrigin="",N.value=!1,I.value.clearValidate()}function Q(){I.value.validate(n=>{if(n){const a={sourceUserGroupID:_.copyOrigin,targetUserGroupID:p.value.id};ie(a).then(l=>{const{msg:i}=l;g.exports.Message({type:"success",message:i}),U(p.value.id),_.copyOrigin=""}).finally(()=>{N.value=!1})}})}return{pageShow:u,reqLoading:t,page:s,list:r,queryCB:f,changeSize:L,changeCurrent:D,deletePageChange:M,formInlineRef:P,currentRow:p,title:b,dialogVisible:v,formInline:c,rules:J,rowEdit:R,delUserManage:T,permissionStatus:w,submitForm:B,closeDialog:E,menuTree:$,treeData:y,menuSetPermission:k,getMenuOperation:V,menuPermissionCheckHandler:F,saveUserMenuPermission:H,copyRef:I,copyObj:_,copyVisible:N,copyClose:K,saveCopy:Q}},data(){return{pagePermission:[]}},computed:{...Z({menuPermission:u=>u.user.menuPermission})},methods:{hasPermissions(u){return this.pagePermission.some(e=>e.value1===u)}},mounted(){this.pagePermission=this.menuPermission[this.$route.name]}});var pe=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.reqLoading,expression:"reqLoading"}],staticClass:"userGroup-management"},[t("div",{staticClass:"userGroup-header"},[e.pageShow==="query"?[e.hasPermissions("add")?t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:()=>{e.dialogVisible=!0,e.title="\u64CD\u4F5C\u5458\u7EC4\u7BA1\u7406\u6DFB\u52A0"}}},[e._v("\u65B0\u589E")]):e._e()]:[t("el-button",{on:{click:()=>{e.pageShow="query",e.queryCB()}}},[e._v("\u53D6\u6D88")]),t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(s){e.copyVisible=!0}}},[e._v("\u590D\u5236\u6743\u9650")]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveUserMenuPermission}},[e._v("\u4FDD\u5B58")])]],2),e.pageShow==="query"?[t("el-table",{staticClass:"plain_table",staticStyle:{width:"calc(100% - 24px)","margin-left":"12px"},attrs:{"highlight-current-row":"",data:e.list,height:"calc(100% - 104px)"}},[t("el-table-column",{attrs:{prop:"id",label:"ID",width:"100"}}),t("el-table-column",{attrs:{prop:"name",label:"\u540D\u79F0",width:"200"}}),t("el-table-column",{attrs:{prop:"remarks",label:"\u5907\u6CE8","min-width":"200"}}),t("el-table-column",{attrs:{prop:"status",label:"\u72B6\u6001",width:"70"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[t("div",[t("span",{class:s.status===!0?"status-background-color-green":"status-background-color-gray"},[e._v(e._s(s.status?"\u542F\u7528":"\u505C\u7528"))])])]}}],null,!1,1677746998)}),t("el-table-column",{attrs:{label:"\u64CD\u4F5C",width:"160"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[e.hasPermissions("edit")?t("el-button",{attrs:{type:"text"},on:{click:function(r){return e.rowEdit(s)}}},[e._v(" \u7F16\u8F91 ")]):e._e(),e.hasPermissions("edit")?t("el-button",{attrs:{type:"text"},on:{click:function(r){return e.permissionStatus(s)}}},[e._v(" \u6743\u9650 ")]):e._e(),e.hasPermissions("delete")?t("el-button",{attrs:{type:"text"},on:{click:function(r){return e.delUserManage(s)}}},[e._v(" \u5220\u9664 ")]):e._e()]}}],null,!1,4031728632)})],1),t("d-page",{staticClass:"c-paginate",attrs:{"pager-count":5,"current-page":e.page.pageNum,"page-sizes":[10,20,30,50,100],"page-size":e.page.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.page.total},on:{"current-change":e.changeCurrent,"size-change":e.changeSize}})]:[t("div",{staticClass:"userGroup-setting"},[t("el-tree",{ref:"menuTree",attrs:{data:e.treeData,"highlight-current":"",props:{children:"childs",label:"name"},"node-key":"id"},on:{"node-click":e.getMenuOperation}}),t("el-table",{staticClass:"plain_table",attrs:{data:e.menuSetPermission}},[t("el-table-column",{attrs:{prop:"name",label:"\u83DC\u5355\u540D\u79F0","show-overflow-tooltip":"",width:"120"}}),t("el-table-column",{attrs:{prop:"setOperation",label:"\u6743\u9650","min-width":"858"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[t("div",{staticClass:"operation-list"},[t("el-checkbox",{attrs:{indeterminate:s.checked,disabled:!s.menuOperationStatus},on:{change:r=>e.menuPermissionCheckHandler(r,s)},model:{value:s.checkAll,callback:function(r){e.$set(s,"checkAll",r)},expression:"row.checkAll"}},[e._v("\u5168\u9009")]),t("el-checkbox-group",{on:{change:r=>e.menuPermissionCheckHandler(r,s)},model:{value:s.setOperation,callback:function(r){e.$set(s,"setOperation",r)},expression:"row.setOperation"}},e._l(Object.keys(s.operationName),function(r){return t("el-checkbox",{key:r+s.id,attrs:{label:r,disabled:!s.menuOperationStatus}},[e._v(" "+e._s(s.operationName[r])+" ")])}),1)],1)]}}])}),t("el-table-column",{attrs:{prop:"menuOperationStatus",label:"\u542F\u7528",width:"77",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:s}){return[t("el-switch",{attrs:{mini:"","active-color":"#007aff","inactive-color":"#bfbfbf"},model:{value:s.menuOperationStatus,callback:function(r){e.$set(s,"menuOperationStatus",r)},expression:"row.menuOperationStatus"}})]}}])})],1)],1)],t("el-dialog",{staticClass:"userGroup-dialog",attrs:{title:e.title,visible:e.dialogVisible,width:"572px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(s){e.dialogVisible=s},close:e.closeDialog}},[t("el-form",{ref:"formInlineRef",staticClass:"demo-form-inline",attrs:{model:e.formInline,rules:e.rules}},[t("el-form-item",{attrs:{label:"\u540D\u79F0\uFF1A",prop:"name"}},[t("el-input",{staticClass:"fe-input-176",attrs:{clearable:"",maxlength:"20",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},model:{value:e.formInline.name,callback:function(s){e.$set(e.formInline,"name",s)},expression:"formInline.name"}})],1),t("el-form-item",{attrs:{label:"\u72B6\u6001\uFF1A",prop:"status"}},[t("el-switch",{attrs:{"active-color":"#1890ff","inactive-color":"#b9b9b9"},model:{value:e.formInline.status,callback:function(s){e.$set(e.formInline,"status",s)},expression:"formInline.status"}})],1),t("el-form-item",{staticClass:"fe-lastelement-margin",attrs:{label:"\u5907\u6CE8\uFF1A",prop:"remarks"}},[t("el-input",{staticClass:"fe-texarea-size",attrs:{type:"textarea",rows:3,clearable:"",resize:"none",placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",maxlength:"500","show-word-limit":""},model:{value:e.formInline.remarks,callback:function(s){e.$set(e.formInline,"remarks",s)},expression:"formInline.remarks"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(s){return e.submitForm("formInline")}}},[e._v("\u4FDD\u5B58")]),t("el-button",{on:{click:()=>{e.dialogVisible=!1,e.formInline={}}}},[e._v("\u53D6\u6D88")])],1)],1),t("el-dialog",{staticClass:"copy-dialog",attrs:{title:"\u590D\u5236\u6743\u9650",visible:e.copyVisible,width:"416px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(s){e.copyVisible=s},"before-close":e.copyClose}},[t("el-alert",{attrs:{title:"\u590D\u5236\u6743\u9650\u4F1A\u8986\u76D6\u6389\u8BE5\u7EC4\u4E4B\u524D\u7684\u6743\u9650\u3002",type:"info",closable:!1,"show-icon":""}}),t("el-form",{ref:"copyRef",staticStyle:{"margin-top":"12px"},attrs:{model:e.copyObj}},[t("el-form-item",{attrs:{prop:"copyOrigin",label:"\u590D\u5236\u6765\u6E90","label-width":"80px",rules:{required:!0,message:"\u8BF7\u9009\u62E9\u590D\u5236\u6765\u6E90",trigger:"blur"}}},[t("el-select",{attrs:{clearable:"",placeholder:"\u8BF7\u9009\u62E9"},model:{value:e.copyObj.copyOrigin,callback:function(s){e.$set(e.copyObj,"copyOrigin",s)},expression:"copyObj.copyOrigin"}},e._l(e.list.filter(s=>s.id!==e.currentRow.id),function(s){return t("el-option",{key:s.id,attrs:{label:s.name,value:s.id}})}),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.saveCopy}},[e._v("\u786E\u5B9A")]),t("el-button",{on:{click:()=>{e.copyVisible=!1,e.copyObj.copyOrigin=""}}},[e._v("\u53D6\u6D88")])],1)],1)],2)},me=[],de=ee(ue,pe,me,!1,null,"bb48d636",null,null);const be=de.exports;export{be as default};
