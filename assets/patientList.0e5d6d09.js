import{c as h}from"./category.795889f8.js";import{g as v,_ as p}from"./index.0af4b258.js";const _={name:"patientList",components:{category:h},data(){return{filterSetName:"",tableInfo:[],showTab:!0,settingVisible:!1,showMoveVisible:!1,currentDataSetMenu:null,currentDataSet:null,dataSetList:[],showMoreIdx:null,currentGroup:"",tab:"",moveItem:null,moveTNode:null}},methods:{async handleMoreCommand(a,t){a==="c"?this.setActQryPage("1",t):a==="d"?this.setActQryPage("2",t):a==="e"&&(this.showMoveVisible=!0,this.moveItem=t),this.showMoreIdx=null},async queryInfoStatusHandler(a,t){console.log(a,"datSet");let e;t==="add"?e=a.id:["mod","view"].includes(t)&&(e=a.datset_id);let s=await this.getSetFields(e)||{},i=s.list||[],n=[],o=[];if(a.datset_type==="P"){let c=s.listExt||[];n=i.map(l=>({id:this.$F.nanoid(),name:l.name,describe:l.describe,alias:l.describe,type:"",search:!1,width:150,dicSet:[],allowDrag:!0,props:{defVal:""},dicType:"1"})),o=c.map(l=>{let m=l.name.includes("Time"),r={id:this.$F.nanoid(),name:l.name,describe:l.name,alias:l.name,type:m?"dTime":"dInput",search:!0,width:150,dicSet:[],allowDrag:!0,props:{defVal:""},dicType:"1",cType:"P"};return m&&(r.props.timeType="datetime",r.props.format="yyyy-MM-dd HH:mm"),r})}else{let c,l=[],m={};if(t==="add")c=[];else if(["mod","view"].includes(t)){const r=await this.getQryPageCfgInfo({id:a.id}),{field_text:f}=r;c=f||"[]";try{c=JSON.parse(c)}catch(g){c=[],console.log(g)}}c=c.map(r=>({...r,allowDrag:!0})),c.forEach(r=>{l.push(r.name),m[r.name]=r}),i.forEach(r=>{m[r.name]?o.push({...m[r.name],describe:r.describe}):n.push({id:this.$F.nanoid(),name:r.name,describe:r.describe,alias:r.describe,type:"",search:!1,width:150,dicSet:[],allowDrag:!0,props:{defVal:""},dicType:"1"})}),o.sort((r,f)=>l.indexOf(r.name)-l.indexOf(f.name)),n=[...o,...n]}let d={data:n,datset_name:a.datset_name,name:t==="add"?"\u9ED8\u8BA4\u67E5\u8BE2\u914D\u7F6E\u540D\u79F0":a.name,enableArr:o,datset_id:e,datset_type:a.datset_type,sort_id:this.currentGroup.id,menu_id:t==="add"?this.currentDataSetMenu.id:a.sort_id,status:t==="add"?"0":a.status};const u={act:t,setInfo:d,dat_range:this.tab,currentGroup:this.currentGroup};t!=="add"&&(u.id=a.id),this.$router.push({name:"querySet",params:u})},saveMove(){const{id:a,range:t}=this.moveTNode,e={act:"mov",id:this.moveItem.id,SortId:this.moveItem.sort_id,NSortId:a,dat_range:t};this.$api.qrypage.actQryPage(e).then(s=>{const{status:i,msg:n}=s;i===100?(this.$message.success(n),this.getQryPgLstBySort(this.moveItem.sort_id,this.currentGroup.dat_range)):this.$message.warning(n)}).finally(()=>{this.showMoveVisible=!1})},getSetTableList(a,t){const e={pageNum:0,pageSize:0,filter:{sortId:a,likeVal:"",dat_range:t}};this.$api.customForm.getTableList(e).then(s=>{const{status:i,data:{list:n},msg:o}=s;i==104?this.dataSetList=n:this.$message.warning(o)})},async getSetFields(a){const t={id:a,pageNum:0,pageSize:0,total:0};return await this.$api.customForm.getDtSetFieldInfo(t).then(e=>{const{status:s,data:i}=e;if(s===104)return i})},resetSetInfo(){this.settingVisible=!1,this.currentDataSetMenu=null,this.currentDataSet=null,this.state=null},getQryPgLstBySort(a,t){!this.$F.isEmpty(t)&&(this.tab=t);const e={pageNum:0,pageSize:0,filter:{sortId:a,likeVal:"",dat_range:t}};this.$api.qrypage.getQryPgLstBySort(e).then(s=>{const{status:i,data:{list:n},msg:o}=s;i==104?(this.tableInfo=n.map(d=>({...d,status:d.status?d.status:"0"}))||[],this.tableInfo=this.tableInfo.filter(d=>d.status!=="3")):this.$message({type:"warning",message:o})}).catch(()=>{})},async setActQryPage(a,t){if(a==="3"){let i=!0;if(i=await this.$confirm("\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u6570\u636E, \u662F\u5426\u7EE7\u7EED?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"}).then(()=>!0).catch(()=>!1),!i)return;console.log(t,"info");const{datset_id:n,id:o}=t;let d={act:"del",datset_id:n,id:o};this.$api.qrypage.submitQryPageCfgInfo(d).then(u=>{const{status:c,msg:l}=u;if(c===102){this.$message.success(l),this.getQryPgLstBySort(t.sort_id,this.currentGroup.dat_range);return}}).catch(u=>{console.log(u,"err")});return}const s={act:{1:"enable",2:"disable"}[a],id:t.id,status:a};this.$api.qrypage.actQryPage(s).then(i=>{const{status:n,msg:o}=i;n==100?(this.$message.success(o),this.getQryPgLstBySort(t.sort_id,this.currentGroup.dat_range)):this.$message.warning(o)})},async getQryPageCfgInfo(a){return await this.$api.qrypage.getQryPageCfgInfo(a).then(t=>{const{status:e,data:s,msg:i}=t;if(e==104)return s;this.$message({type:"warning",message:i})}).catch(()=>{})},formatStatus(a){return[{name:"\u8349\u7A3F",color:"#fea600",bgcolor:"#fffaf0"},{name:"\u5DF2\u542F\u7528",color:"#52C31B",bgcolor:"#F5FCF2"},{name:"\u5DF2\u505C\u7528",color:"#909399",bgcolor:"#f4f4f5"},{name:"\u5DF2\u5220\u9664",color:"#909399",bgcolor:"#f4f4f5"}][a]}},computed:{filterData(){return this.$F.isEmpty(this.filterSetName)?this.tableInfo:this.tableInfo.filter(a=>a.name.includes(this.filterSetName))}},created(){let a=this.$route.params;this.currentGroup=a&&a.currentGroup?a.currentGroup:{}}};var y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"patient-container"},[e("div",{staticClass:"patient-aside"},[e("category",{attrs:{type:"3",title:"\u67E5\u8BE2\u9875\u9762\u914D\u7F6E",initData:t.currentGroup},on:{"node-click":(s,i)=>{t.currentGroup={...s,dat_range:i},t.getQryPgLstBySort(s.id,i)},"tab-toggle":s=>{t.showTab=s}}})],1),e("div",{staticClass:"patient-box"},[e("div",{staticClass:"demo-form-inline",class:{isIndent:!t.showTab}},[e("div",{staticClass:"breadCrumb"},[e("span",{staticClass:"cateName"},[t._v(t._s(t.currentGroup.name))]),e("span",{staticClass:"count"},[t._v("/\u5171"+t._s(t.filterData.length||0)+"\u6761\u6570\u636E")])]),e("div",{staticClass:"filter"},[e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165","suffix-icon":"el-icon-search",size:"mini",maxlength:25},model:{value:t.filterSetName,callback:function(s){t.filterSetName=typeof s=="string"?s.trim():s},expression:"filterSetName"}}),e("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:function(s){t.settingVisible=!0}}},[t._v("\u65B0\u589E")])],1)]),e("div",{staticClass:"patient-items"},[t.filterData.length>0?t._l(t.filterData,function(s){return e("div",{key:s.id,staticClass:"card-item"},[e("div",{staticClass:"card-item-title",attrs:{title:s.name}},[e("div",{staticClass:"card-item-box"},[e("i",{staticClass:"el-icon-my-querySet"}),e("div",{staticClass:"card-item-name"},[t._v(" "+t._s(s.name)+" "),e("div",{staticClass:"card-item-version"},[e("span",{staticStyle:{color:"#595959","font-size":"14px","margin-right":"8px"}},[t._v("\u6570\u636E\u96C6\uFF1A"+t._s(s.datset_name))])])])]),e("div",{staticClass:"card-item-status",style:{color:t.formatStatus(s.status).color,background:t.formatStatus(s.status).bgcolor}},[t._v(t._s(t.formatStatus(s.status).name))])]),e("div",{staticClass:"card-item-tool"},[e("div",{staticClass:"tools-box"},[s.status!=1?e("div",{staticClass:"tools-btn",on:{click:function(i){return t.queryInfoStatusHandler(s,"mod")}}},[e("dIcon",{attrs:{name:"edit"}}),e("span",[t._v("\u7F16\u8F91")])],1):t._e(),e("div",{staticClass:"tools-btn",on:{click:function(i){return t.queryInfoStatusHandler(s,"view")}}},[e("dIcon",{attrs:{name:"viewLst"}}),e("span",[t._v("\u9884\u89C8")])],1),e("div",{staticClass:"tools-btn",on:{click:function(i){return t.setActQryPage("3",s)}}},[e("dIcon",{attrs:{name:"delLst"}}),e("span",[t._v("\u5220\u9664")])],1)]),e("div",{staticClass:"card-item-dropMenu"},[e("el-dropdown",{attrs:{trigger:"click","hide-on-click":!1},on:{"visible-change":i=>{i?t.showMoreIdx=s.id:t.showMoreIdx=""},command:i=>{t.handleMoreCommand(i,s)}}},[e("i",{staticClass:"el-dropdown-link",class:t.showMoreIdx===s.id?"el-icon-my-moreActive":"el-icon-my-more",staticStyle:{cursor:"pointer"}}),e("el-dropdown-menu",[s.status!=1?e("el-dropdown-item",{attrs:{command:"c"}},[t._v("\u542F\u7528")]):t._e(),s.status==1?e("el-dropdown-item",{attrs:{command:"d"}},[t._v("\u505C\u7528")]):t._e(),e("el-dropdown-item",{attrs:{command:"e"}},[t._v("\u79FB\u52A8\u81F3")])],1)],1)],1)])])}):e("div",{staticClass:"fe-full"},[e("el-empty",{attrs:{image:p,description:"\u6682\u65E0\u6570\u636E\u54E6\uFF5E","image-size":280}})],1)],2)]),e("el-dialog",{staticClass:"setting",attrs:{title:"\u9009\u62E9\u6570\u636E\u96C6",visible:t.settingVisible,"close-on-click-modal":!1,"before-close":t.resetSetInfo,width:"938px"},on:{"update:visible":function(s){t.settingVisible=s}}},[e("el-container",[e("el-aside",{attrs:{width:"240px"}},[e("category",{attrs:{type:"1",inner:"choose"},on:{"node-click":(s,i)=>{t.currentDataSetMenu=s,t.getSetTableList(s.id,i)}}})],1),e("el-main",[t.dataSetList.length>0?e("el-row",t._l(t.dataSetList,function(s){return e("el-col",{key:s.id,class:t.currentDataSet&&t.currentDataSet.id===s.id?"box-border":"",attrs:{span:12}},[e("div",{staticClass:"box-btn",on:{click:function(i){t.currentDataSet=s},dblclick:function(i){return t.queryInfoStatusHandler(s,"add")}}},[e("i",{staticClass:"el-icon-my-dataset2"}),e("div",{staticClass:"box-fit"},[t._v(" "+t._s(s.datset_name)+" "),e("div",{staticClass:"databaseName"},[t._v(" "+t._s(s.datset_content)+" ")])])])])}),1):e("div",{staticClass:"fe-full"},[e("el-empty",{attrs:{image:p,description:"\u6682\u65E0\u6570\u636E\u54E6\uFF5E","image-size":200}})],1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{disabled:!t.currentDataSet,type:"primary"},on:{click:function(s){return t.queryInfoStatusHandler(t.currentDataSet,"add")}}},[t._v("\u4E0B\u4E00\u6B65")]),e("el-button",{on:{click:t.resetSetInfo}},[t._v("\u53D6\u6D88")])],1)],1),e("el-dialog",{staticClass:"view-edit move-dialog",attrs:{title:"\u79FB\u52A8\u81F3",width:"500px","close-on-click-modal":!1,visible:t.showMoveVisible,"before-close":()=>{t.showMoveVisible=!1,t.moveItem=null,t.moveTNode=null}},on:{"update:visible":function(s){t.showMoveVisible=s}}},[t.showMoveVisible?e("category",{attrs:{type:"3",inner:"move"},on:{checkChange:s=>{t.moveTNode=s}}}):t._e(),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.saveMove}},[t._v("\u786E\u5B9A")]),e("el-button",{on:{click:()=>{t.showMoveVisible=!1,t.moveItem=null,t.moveTNode=null}}},[t._v("\u53D6\u6D88")])],1)],1)],1)},b=[],w=v(_,y,b,!1,null,"b3ba00e4",null,null);const S=w.exports;export{S as default};
