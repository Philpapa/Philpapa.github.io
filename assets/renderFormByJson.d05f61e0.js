import{g as W,h as X,r as V,o as Y,D as q,E as Z,u as m,N as j,V as ee,s as h,F as v,z as P,I as k,K as te}from"./index.0af4b258.js";const ae={name:"renderFormByJson"},le=Object.assign(ae,{props:{data:{type:Object,default(){return{id:"basic",isBasic:!0,children:[]}}}},emits:["fillPatientInfo"],setup(S,{emit:c}){const u=S,d=X({isPrint:e=>e.form.isPrint}),{isPrint:y}=d,M=V(!0),N=Y("comData",{}),g=V(null),_=V({}),$=V({});q("formValue",_),q("formData",u.data);const J=V({}),T=e=>{let{isBasic:a,children:l,name:n}=e;if(!a){const{defVal:s,id:t,props:{dicOrigin:i,datset_id:r,datset_name:o},slots:f,dataset_code:A,dataset_field:F}=e;let R={};if(A&&(R.dataset_code=A),F&&(R.dataset_field=F),h($.value,t,R),h(_.value,t,s),i&&i==2&&h(J.value,t,{datset_id:r,datset_name:o}),f&&f.named&&f.named.length>0)for(let B in f.named){let p=f.named[B].comDetail;!p||T(p)}}if(l&&l.length>0&&n!=="dActiveTable")for(let s in l){let t=l[s];T(t)}},C=V({}),D=V({});q("validateData",D);const z=(...e)=>{const a=e[1]?"":e[2];h(D.value,e[0],a)},b=e=>{let{isBasic:a,children:l,name:n}=e;if(!a){const{id:s,slots:t}=e;if(n!=="dActiveTable"){let i=v.requiredFn(e,{formValue:m(_)});i&&h(C.value,s,i)}if(t&&t.named&&t.named.length>0)for(let i in t.named){let r=t.named[i].comDetail;!r||b(r)}}if(l&&l.length>0&&n!=="dActiveTable")for(let s in l){let t=l[s];b(t)}},G=e=>{if(!v.isEmpty(e)){if(e==="clear"){P(()=>{var a,l;(l=(a=m(g))==null?void 0:a.clearValidate)==null||l.call(a)});return}if(Array.isArray(e)){if(m(C)[e[0]])return;h(C.value,e[0],e[1]),P(()=>{var a,l;(l=(a=m(g))==null?void 0:a.clearValidate)==null||l.call(a,e[0])})}else m(C)[e]&&(k(D.value,e),k(C.value,e),P(()=>{var a,l;(l=(a=m(g))==null?void 0:a.clearValidate)==null||l.call(a,e)}))}},H=e=>{if(e[1]==="delete")for(let a in e[0])k(_.value,e[0][a]);else e.forEach(a=>{for(let l in a.data){let n=v.copy(a.data[l]);h(_.value,l,n)}})},w=e=>{var i,r;const{id:a,defVal:l,name:n,props:s,slots:t}=e;if(s.isCollect){if(n!=="dDraggable")h(_.value,a,l);else if(e.tag==="slot"&&e.children.length>0)for(let o in e.children)w(e.children[o])}else{if(h(_.value,a,l),Array.isArray(l)&&((r=(i=m(g))==null?void 0:i.validateField)==null||r.call(i,a)),n==="dInput"){const{isSearch:o,fieldsSet:f,rowInfo:A}=s;if(!o||v.isEmpty(A)||v.isEmpty(f))return;let F={};try{F=JSON.parse(A)}catch(p){console.log(p)}let R={},B={};for(let p of f)p.reflectName&&(B[p.name]=p.reflectName);for(let p in F){let U=F[p];v.isEmpty(B[p])||(R[B[p]]=U)}c("fillPatientInfo",R);return}if(t&&t.named&&t.named.length)for(let o in t.named){let f=t.named[o].comDetail;!f||w(f)}}},E=(e,a)=>{let l=[];const{isBasic:n,children:s}=e;if(!n){const{connect_field:t,props:{isCollect:i}}=e;!i&&t&&t===a&&(l=[...l,e])}if(s&&s.length>0)for(let t of s)l=[...l,...E(t,a)];return l},x={string:"",object:[],number:0},L=([e,a])=>{let l=E(u.data,a),n=l.find(t=>t.props.isRequired&&t.id!==e),s=l.find(t=>t.id===e);if(n){let{props:{isRequired:t,timeCompareArr:i}}=n;s.props.isRequired=t,n.props.isRequired=!1,i&&(s.props.timeCompareArr=v.copy(i),n.props.timeCompareArr=[]);for(let r of l)if(r.id!==e)k(C.value,r.id),P(()=>{var o,f;(f=(o=m(g))==null?void 0:o.clearValidate)==null||f.call(o,r.id)});else{let o=v.requiredFn(s,{formValue:m(_)});h(C.value,e,o)}}for(let t of l)t.id!==e&&h(t,"defVal",v.copy(x[typeof t.defVal]))},Q=e=>{let a=v.findTargetComp(u.data,e);if(!a||["dImage","dText","dTitle"].includes(a.name))return;let l=Array.isArray(a.defVal)?[]:"";a.defVal=l,h(_.value,e,l),P(()=>{var n,s;(s=(n=m(g))==null?void 0:n.clearValidate)==null||s.call(n,e)})},O=V({}),I=["441900","442000","460400"],K=()=>te().then(e=>{let a={province:[],city:{},area:{}},l=e||[],n=[],s=[];for(let t in l){let i=l[t],r=t.slice(2,4),o=t.slice(4);r==="00"&&o==="00"?(a.province.push({label:i,value:t}),a.city[t]=[]):r!=="00"&&o==="00"?n.push({label:i,value:t}):r!=="00"&&o!=="00"&&s.push({label:i,value:t})}n.forEach(t=>{var r,o;let i=`${t.value.slice(0,2)}0000`;(o=(r=a.city[i])==null?void 0:r.push)==null||o.call(r,t),I.includes(t.value)?a.area[t.value]=[{...t}]:a.area[t.value]=[]}),s.forEach(t=>{var r,o;let i=`${t.value.slice(0,4)}00`;(o=(r=a.area[i])==null?void 0:r.push)==null||o.call(r,t)}),O.value=a}).catch(e=>{console.log(e)});return q("regionData",O),Z(async()=>{!m(y)&&b(u.data),T(u.data),await K(),D.value={}}),j(()=>{setTimeout(()=>{var e,a;(a=(e=m(g))==null?void 0:e.clearValidate)==null||a.call(e)},300)}),{__sfc:!0,emit:c,props:u,states:d,isPrint:y,isCompact:M,comData:N,formRef:g,formValue:_,formFields:$,datasetValue:J,initData:T,rules:C,validateData:D,onFormValidate:z,initRules:b,editRule:G,editField:H,onCompInput:w,collectIdenticalCom:E,emptyValMap:x,clearOthField:L,clearCompVal:Q,regionData:O,verticalArea:I,getRegionDic:K,RenderShowComByJson:ee}}});var ie=function(){var c=this,u=c._self._c,d=c._self._setupProxy;return u("div",{ref:"toPdf",staticClass:"render-form",class:{isPrint:d.isPrint,isCompact:d.isCompact}},[u("el-form",c._b({ref:"formRef",attrs:{model:d.formValue,disabled:d.isPrint||c.$attrs.disabled,rules:d.isPrint?{}:d.rules,validateOnRuleChange:!1},on:{validate:d.onFormValidate}},"el-form",c.$attrs,!1),[c._l(c.data.children,function(y){return[y.name==="dDraggable"?u("div",{key:y.id+"print",staticClass:"render-comp-print",style:{width:y.props.width?`${y.props.width}%`:"fit-content"}},[u(d.RenderShowComByJson,c._g({key:y.id,attrs:{data:y},on:{input:d.onCompInput,clearOthField:d.clearOthField,clearCompVal:d.clearCompVal,editRule:d.editRule,editField:d.editField}},c.$listeners))],1):u(d.RenderShowComByJson,c._g({key:y.id,attrs:{data:y},on:{input:d.onCompInput,clearOthField:d.clearOthField,clearCompVal:d.clearCompVal,editRule:d.editRule,editField:d.editField}},c.$listeners))]})],2)],1)},re=[],ne=W(le,ie,re,!1,null,"cda12aff",null,null);const oe=ne.exports;export{oe as r};
