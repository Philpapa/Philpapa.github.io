import{Y as mapState,Z as mapMutations,$ as axios,a0 as checkFormEnable,a1 as getLicense,g as normalizeComponent}from"./index.0af4b258.js";import{P as Print}from"./printFn.27369ba5.js";import{r as renderFormByJson}from"./renderFormByJson.d05f61e0.js";const reportCard_vue_vue_type_style_index_0_lang="",reportCard_vue_vue_type_style_index_1_scoped_5670d065_lang="",_sfc_main={name:"reportCard",provide(){return{comData:this,regionMap:this.regionMap}},components:{renderFormByJson},data(){return{activeName:"",loading:!1,formList:[],dialogTitle:"\u65B0\u589E",tabData:[],curRow:{},bgkData:[],versionList:{},datsetname_list:[],selectSetname:{},filedsList:{},outreach_id:"",act:"add",outreachform:null,cbInfo:null,slaveId:"",btnLoading:!1,printPaddingList:[],printWidth:0,isEmpty:!1,emptyNote:"",regionMap:{},expireData:{},municipalities:["110000","120000","310000","500000","810000","820000"],vCity:["441900","442000","460400"],debounceTimeout:null}},computed:{...mapState({isPrint:t=>t.form.isPrint,isShowPrintRes:t=>t.form.isShowPrintRes})},watch:{isShowPrintRes:{deep:!0,handler(t){t?(this.$nextTick(()=>{this.printPaddingList=[NaN,NaN],this.controlPadding()}),window.addEventListener("resize",this.controlPadding)):window.removeEventListener("resize",this.controlPadding)}}},mounted(){this.setPrintResShow(!1),this.setPrint(!1),this.formCommunicate(),this.getLicenseInfo(),window.addEventListener("message",t=>{!t.data||(t.data.handle==="save"?this.saveFormCallback(t.data):t.data.handle==="htmlPrint"&&this.generatePrintView(),t.data.flag&&this.formCommunicate(t.data.data))})},methods:{...mapMutations({setPrint:"form/SET_PRINT",setPrintResShow:"form/SET_PRINT_RES"}),controlPadding(){let t=this.$refs.printView.$el,e=Number(t.clientWidth);if(this.printPaddingList.some(i=>isNaN(i)))this.printPaddingList=[40,e-40];else{let i=this.printPaddingList[0]/this.printWidth,l=this.printPaddingList[1]/this.printWidth;this.printPaddingList=[Math.ceil(i*e),Math.floor(l*e)]}this.printWidth=e},formatTooltip(t){return this.printPaddingList.indexOf(t)==1?this.printWidth-t:t},generatePrintView(){this.setPrint(!0),this.setPrintResShow(!0),setTimeout(()=>{const t=this.$refs.printView.$el,e=1083;let a=1,i=t.getBoundingClientRect(),l=this.$refs.printView.$children[0].$children;const n=m=>{m=Array.from(m);let _=[];return m.forEach(C=>{let F=(C==null?void 0:C.$el)||C;F._prevClass.includes("draggable-item-draggable")?_=[..._,...n(F.children||[])]:_.push(F)}),_};n(l).forEach(m=>{let C=m.getBoundingClientRect().y-i.y;m.classList.remove("print_gap"),C>a*e&&(a++,m.classList.add("print_gap"))}),t.style.height="fit-content",t.style.minHeight="100%"},200)},printFn(){Print(this.$refs.printView)},onTabChange(t){let e=this.tabData[Number(t.index)];if(!!this.$refs[e.id]&&(this.act==="add"&&this.activeName===this.slaveId||this.act!=="add"&&this.activeName===this.outreachform.form_id)){let i=this.echoFields(this.tabData[0].data,!1);this.cbInfo.udfmsg&&(i={...i,...this.cbInfo.udfmsg});let l=this.$refs[this.tabData[0].id],n=this.$refs[this.tabData[1].id];Array.isArray(l)&&(l=l[0]),Array.isArray(n)&&(n=n[0]);let h=l?l._setupProxy.formValue:{},m=n?n._setupProxy.formValue:{},_=l?l._setupProxy.formFields:{},C=n?n._setupProxy.formFields:{},F=this.tabData[1].params_list,c={};F.forEach(({zkid:s,fkid:f})=>{if(s in h&&f in m&&!this.$F.isEmpty(h[s])&&this.$F.isEmpty(m[f])){let o=_[s];o&&(o=o.dataset_field);let r=C[f];r&&(r=r.dataset_field),o&&r&&(c[r]=i[o])}}),console.log(c,"insertFields"),this.echoFields(this.tabData[1].data,!0,c)}},onParamsKeyTrans(t){},async addCRB(t){let e=await this.getAddFormInfo(t);const{data:{bus_field:a,form_text:i,id:l,name:n,form_name:h,tableset:m}}=e;let _={};try{_=JSON.parse(i)}catch(C){console.log(C)}if(await this.feedbackTabProperty(_,m),this.setNowCompVal(_,new Date),this.dialogTitle="\u65B0\u589E",this.showFormVisible=!0,_){this.tabData.push({id:t,data:_,name:n||h}),this.activeName=t;let C=this.cbInfo.udfmsg?this.cbInfo.udfmsg:{};this.echoFields(this.tabData[0].data,!0,C)}this.presetData(_.children)},async handleEdit(t){console.log(t,"rowInfo"),this.dialogTitle="\u7F16\u8F91";const e={filter:{dat_id:t.dat_id,form_id:t.form_id}};let a=null;this.$api.customForm.getBusFormInfo(e).then(async i=>{if(i.status===104){const{data:{tableinfo:l,dat_id:n}}=i;if(this.outreach_id=n,this.showFormVisible=!0,a=JSON.parse(i.data.form_text),a){await this.feedbackTabProperty(a,l);let h=i.data.data&&i.data.data[0]||{};this.outreachform=i.data.outreachform,this.tabData.push({id:t.form_id,data:a,name:i.data.form_name||i.data.name}),this.activeName=t.form_id,console.log(h,"fields"),this.echoFields(a,!0,h),this.presetData(a.children)}}else this.$message({type:"warning",message:i.msg})})},moveToErr(){this.$nextTick(()=>{let t=document.getElementsByClassName("is-error");t.length&&(t[0].scrollIntoView({block:"center",behavior:"smooth"}),setTimeout(()=>{t[0].previousElementSibling.querySelector("input")&&t[0].previousElementSibling.querySelector("input").focus()},800))})},save(t,e,a){console.log(this.act,e),console.log(this.outreachform,e),this.outreach_id="";let i=!0,l=[];for(let n in this.tabData){let h=this.tabData[n],m=h.id;if((Array.isArray(this.$refs[m])?this.$refs[m][0]:this.$refs[m]).$refs.formRef.validate(o=>i=o),!i){this.btnLoading=!1,this.moveToErr(),Number(n)===0?this.$message.warning("\u4E3B\u8868\u5355\u4FE1\u606F\u672A\u586B\u5199\u5B8C\u6574"):Number(n)===1&&this.$message.warning("\u5B50\u8868\u5355\u4FE1\u606F\u672A\u586B\u5199\u5B8C\u6574");return}let C=this.echoFields(h.data,!1),F,c;n==0?(F=e&&e.dat_id?"mod":"add",c=["add","caogao"].includes(t)?"":e.dat_id):this.outreachform&&this.outreachform.dat_id?(F="mod",c=this.outreachform.dat_id):(F="add",c="");let s={form_id:h.id,act:F,dat_id:c,data:C,origin:"\u4F20\u67D3\u75C5\u62A5\u544A\u5361"},f=this.echoTableFields(h.data);f=f.map(o=>o.filter(b=>b.act)),f=f.filter(o=>o.length>0),console.log(f,"tableRes"),f.length>0&&(f=f.map(o=>{let r=Object.keys(o[0].data).join(",");return r?o.map(D=>({...D,bus_field:r})):o}),s.table=f.map(o=>({tablemx:o}))),l.push(s)}console.log(l,"resFieldArr"),this.$api.customForm.submitBusForm(l[0]).then(n=>{if(n.status==100){l.length===2?(l[1].data={...l[1].data,outreach_id:n.data.datId},this.$api.customForm.submitBusForm(l[1]).then(m=>{m.status==100?(!this.cbInfo||!this.cbInfo.system)&&this.$message.success({message:m.msg}):(this.$message.warning({message:m.msg}),this.btnLoading=!1)}).catch(()=>{this.btnLoading=!1})):l.length===1&&(!this.cbInfo||!this.cbInfo.system)&&this.$message.success({message:n.msg});let h={dat_id:n.data.datId,form_id:l[0].form_id,fields:l[0].data,act:t};this.saveCbInfo(h,a)}else this.$message.warning({message:n.msg})}).catch(()=>{this.btnLoading=!1})},dSave(){this.debounce(this.save,1e3)(...arguments)},async presetData(t,e){if(Array.isArray(t))for(let a in t){let i=t[a];const{name:l,children:n,props:h}=i;if(l==="dSelect"&&h.datset_id){const{datset_id:m,datset_name:_}=h,C={pageNum:0,pageSize:0,filter:{datset_id:m,datset_name:_}};await this.$api.customForm.getBusDicLst(C).then(F=>{if(F.status===104&&F.data.list){const c=F.data.list.reduce((s,f,o)=>[...s,{value:f.id,label:f.name}],[]);t[a].props.dic=c}})}n&&n.length>0&&await this.presetData(t[a].children,e)}},getBusDicLst(t){const e={pageNum:0,pageSize:0,filter:{...t}};this.$api.customForm.getBusDicLst(e).then(a=>{const{status:i,msg:l}=a;if(i==104)return a;this.$message({type:"warning",message:l})})},async saveCbInfo(t,e){const{cbApi:a,configFields:i}=this.tabData[0].data,{system:l,udfmsg:n,token:h,userId:m}=this.cbInfo;l||(this.showFormVisible=!1,this.btnLoading=!1,this.$router.push({name:"reportList"}));let _={},C={};if(!this.$F.isEmpty(i))for(let s of i)this.$F.isEmpty(s.alias)||(_[s.dataset_field]=s.alias);for(let s in t.fields){let f=t.fields[s];_[s]?C[_[s]]=f:C[s]=f}let F={...n,...e,...C,formId:t.form_id,datId:t.dat_id,act:t.act};console.log(F,"params");const c={headers:{Authorization:h,["X-YH-Gateway-Token"]:h,["X-YH-Gateway-SystemUser-Id"]:m}};axios.post(a,F,c).then(s=>{const{status:f,msg:o}=s.data;f==100?(this.$message.success(o),window.parent.postMessage({flag:e,data:{...s.data,params:F}},"*")):this.$message.warning(o)}).catch(s=>{console.log(s,"err")}).finally(()=>{this.btnLoading=!1})},async getAddFormInfo(t){return await this.$api.customForm.getFormText({id:t}).then(e=>{const{status:a,msg:i}=e;if(a==104)return e;this.$message.warning(i)})},onFormatCAttrs(t){let e={};return t.forEach(a=>{const{key:i,value:l,type:n}=a;if(n==="json"){if(!this.$F.isEmpty(i)&&!this.$F.isEmpty(l)){let h=null;try{h=JSON.parse(l),e[i]=h}catch(m){console.log(m)}}}else!this.$F.isEmpty(i)&&!this.$F.isEmpty(l)&&(e[i]=l)}),e},echoFields(t,e,a){ci(this.act);let i=this;if(!t||Object.keys(t).length<1)return;if(e){let c=Object.keys(a);l.call(this,t,c),console.log(a,"add insert")}else{let c=m.call(this,t)||{};return console.log(c,"res"),c}async function l(c,s){const{isBasic:f,children:o,slots:r,name:b,tag:D}=c;if(!f&&b!=="dActiveTable"&&D!=="table"){const{dataset_field:$,reserve_field:u}=c;let p;if(this.act==="add"&&u&&u in this.cbInfo?p=this.cbInfo[u]:p=a[$],s.includes($)||s.includes(u)){const{attrs:y}=c;let v=this.onFormatCAttrs(y),d;if(["dCascader","dCheckbox"].includes(b))d=p?p.split("|"):[];else if(b==="dRegion")if(p){let w=p.slice(0,2)==="00"?"":p.slice(0,2).concat("0000"),g=p.slice(2,4)==="00"?"":p.slice(0,4).concat("00"),I=p.slice(4,6)==="00"?"":p.slice(0,6);this.vCity.includes(g)&&g!==p&&(I=g);let R=p.length!==9?"":p;d=[w,g,I,R]}else d=[];else b==="dSelect"?v.multiple?d=p?p.split("|"):[]:d=p:b==="dTime"?d=p&&p.slice(0,4)>1901?p:"":d=p;if(b==="dRadio"){const{attachedParams:w,tag:g}=c;g||!w||w.length===0?this.$F.isEmpty(d)||h(c,d):(console.log(c,d,"busObj dRadio"),n.call(this,c,d))}else Array.isArray(d)?d.length!==0&&(c.defVal=d):!this.$F.isEmpty(d)&&(c.defVal=d)}}if(o&&o.length>0)for(let $ in o){let u=o[$];l.call(this,u,s)}if(r&&r.named&&r.named.length)for(let $ in r.named){let u=r.named[$].comDetail;!u||l.call(this,u,s)}}async function n(c,s){const{connect_field:f,props:{dic:o}}=c;let r=[];f?o.find(D=>D.value===s)?(c.defVal=s,r=[c]):r=F(t,f):(c.defVal=s,r=[c]);for(let b of r){const{props:{dic:D},attachedParams:$,id:u}=b;if(!D||D.length===0||!D.find(d=>d.value===s)||(b.defVal=s,!$||$.length===0))continue;let y=$.find(d=>{let w=d.value.split("|");return Array.isArray(b.defVal)?w.some(g=>b.defVal.includes(g)):w.includes(b.defVal)});if(!y)continue;let v={status:"",data:{}};if(this.act==="add"?(v=await this.$api.customForm.getFormText({id:y.formId}),this.slaveId=y.formId):v=await this.$api.customForm.getBusFormInfo({filter:{dat_id:this.outreachform.dat_id,form_id:this.outreachform.form_id}}),console.log(v,"openCard res"),v.data){const{status:d,data:{form_text:w,data:g,name:I,form_name:R}}=v;if(d===104){let S={};try{S=JSON.parse(w)?JSON.parse(w):{}}catch(P){console.log(P)}if(S&&S.id==="basic"){let P={};g&&(P=g[0]),this.echoFields(S,!0,P),ci(`\u526F\u5361\u6570\u636E\uFF1A${JSON.stringify(P)}`),this.tabData.push({id:y.formId,data:S,name:I||R,params_list:y.params_list,cntCompId:u})}}}}}function h(c,s){const{connect_field:f,props:{dic:o}}=c;let r=[];f?o.find(D=>D.value===s)?(c.defVal=s,r=[c]):r=F(t,f):(c.defVal=s,r=[c]);for(let b of r){const{props:{dic:D}}=b;!D.find(u=>u.value===s)||(b.defVal=s)}}function m(c){let s={};const{children:f,isBasic:o}=c;if(!o){const{dataset_field:r,dataset_code:b,reserve_field:D,connect_field:$,name:u,attrs:p,props:{dic:y},slots:v,defVal:d}=c;let w={};if(p.forEach(g=>{const{key:I,value:R,type:S}=g;if(S==="json"){if(!this.$F.isEmpty(I)&&!this.$F.isEmpty(R)){let P=null;try{P=JSON.parse(R),w[I]=P}catch(k){console.log(k)}}}else!this.$F.isEmpty(I)&&!this.$F.isEmpty(R)&&(w[I]=R)}),this.$F.isEmpty(d))$||(r&&(s[r]=""),b&&(s[b]=""));else{let g=JSON.parse(JSON.stringify(d));if(Array.isArray(d))if(u=="dRegion"){let I=d.length;g=I!==0?d[I-1]:""}else g=d.join("|");if($){if(r&&g){s[r]=g;let I=_(c);s={...s,...I}}else if(!r&&g){let I=F(t,$);console.log(I,"identicalCom");let R=I.find(S=>!this.$F.isEmpty(S.dataset_field));if(R){const{dataset_field:S,dataset_code:P}=R;s[S]=g;let k=JSON.parse(JSON.stringify(c));k.dataset_code=P;let N=_(k);s={...s,...N}}}}else r&&(s[r]=g),b&&(s={...s,..._(c)})}if(v&&v.named&&v.named.length)for(let g in v.named){let I=v.named[g].comDetail;if(!I)continue;let R=m.call(this,I);s={...s,...R}}}if(f&&f.length>0)for(let r in f){let b=f[r];if(b.name!=="dActiveTable"){let D=m.call(this,b);s={...s,...D}}}return s}function _(c){let s={};const{dataset_code:f,defVal:o,props:{dic:r},attrs:b,name:D,id:$}=c;if(!f)return s;let u=JSON.parse(JSON.stringify(o));if(Array.isArray(o)&&(u=o.join("|")),["",void 0,null].includes(u))return{[f]:""};if(D==="dRegion")return i.regionMap[$]&&(s[f]=i.regionMap[$].split(" / ").join("|")),s;if(!r)return{[f]:""};if(D==="dCheckbox"){let p=[];r.forEach(y=>{o.includes(y.value)&&p.push(y.label)}),s[f]=p.join("|")}else if(D==="dRadio"){let p=r.find(y=>y.value===u);p&&(s[f]=p.label)}else if(D==="dSelect")if(b.find(y=>y.key==="multiple"&&y.value===!0)){let y=[];r.forEach(v=>{o.includes(v.value)&&y.push(v.label)}),s[f]=y.join("|")}else{let y=r.find(v=>v.value===u);y&&(s[f]=y.label)}else if(D==="dCascader"){let p=C(r);p=p.map(d=>[d.value,d.label]);let y=Object.fromEntries(p),v=o.map(d=>y[d]);s[f]=v.join("|")}return s}function C(c){let s=[];return c.forEach(f=>{let o=JSON.parse(JSON.stringify(f));if(o.children&&o.children.length>=1){let r=C(o.children);delete o.children,s=[...s,o,...r]}else s=[...s,o]}),s}function F(c,s){let f=[];const{isBasic:o,children:r}=c;if(!o){const{connect_field:b}=c;b&&b===s&&(f=[...f,c])}if(r&&r.length>0)for(let b of r)f=[...f,...F(b,s)];return f}},echoTableFields(t){let e=this;return i(t);function i(l){let n=[];const{children:h,isBasic:m}=l;if(!m){console.log(l,"busObj");const{tableInfo:_,dicList:C,children:F,props:{datset_id:c},datList:s,name:f}=l;if(f==="dActiveTable"){let o={},r={};for(let D of F){const{dataset_field:$,id:u,name:p,dataset_code:y,props:{dic:v}}=D;!$&&!y||(!o[u]&&(o[u]={}),$&&(o[u].dataset_field=$),y&&(o[u].dataset_code=y),r[u]=p==="dRegion"?"dRegion":v)}for(let D of C)for(let $ in D){let u=D[$];if(!u)continue;const{originId:p}=u;p&&o[p]&&(o[$]=o[p],r[p]&&(r[$]=r[p]))}let b=_.map((D,$)=>{var y,v,d,w;let u=JSON.parse(JSON.stringify(D));delete u.recognizeId,delete u.addId;let p={};for(let g in u.data)if(o[g]){let I=o[g];if(I.dataset_field){let R;if(r[g]&&r[g]==="dRegion")if(Array.isArray(u.data[g])&&u.data[g].length>0){let S=u.data[g].length;R=u.data[g][S-1]}else R="";else R=Array.isArray(u.data[g])?u.data[g].join("|"):u.data[g];p[I.dataset_field]=R}if(I.dataset_code&&r[g])if(r[g]==="dRegion"){let R=(w=(d=(v=(y=e.regionMap[g])==null?void 0:y.split)==null?void 0:v.call(y," / "))==null?void 0:d.join)==null?void 0:w.call(d,"|");p[I.dataset_code]=R||""}else if(Array.isArray(u.data[g])){let R=[];u.data[g].forEach(S=>{let P=r[g].find(k=>k.value===S);P&&R.push(P.label)}),p[I.dataset_code]=R.join("|")}else{let R=r[g].find(S=>S.value===u.data[g]);R&&(p[I.dataset_code]=R.label)}}return u.datset_id=c,s&&s.length>0&&s[$]&&(u.dat_id=s[$]),u.data=p,u});b&&b.length>0&&(n=[...n,b])}}if(h&&h.length>0)for(let _ in h){let C=h[_],F=i(C);n=[...n,...F]}return n}},clearFormValidate(){this.cbInfo&&this.cbInfo.system?(console.log(this.$postmateChild,"this.postmateChild"),window.parent.postMessage({flag:!0,data:{status:this.act}},"*")):(this.showFormVisible=!1,this.$router.push({name:"reportList"}))},async feedbackTabProperty(t,e){if(!e||e.length===0)return;const{children:a,isBasic:i}=t;if(!i){const{name:l,id:n}=t;if(l==="dActiveTable"){let h=e.find(m=>m.components_id===n);if(h){const{datset_id:m,datset_name:_,id:C}=h;if(this.act!=="add"){let F={outreach_id:this.outreach_id,datset_id:m,form_id:this.curRow.form_id,components_id:n},c={};for(let o of t.children)o.dataset_field&&(c[o.dataset_field]=o);console.log(c,"dicReflect");let f=(await this.$api.customForm.getBusFrmDetTableInfo(F)).data;if(f&&f.length>0){let o=f.map(D=>D.dat_id),r=[],b=[];for(let D of f){let $={},u={};for(let p of t.children){let y=this.$F.copy(p);y.id=this.$F.nanoid(),y.originId=p.id,y.dataset_field=p.dataset_field;let v=D[p.dataset_field]||p.defVal;if(["dCheckbox","dCascader"].includes(y.name))!Array.isArray(v)&&(v=v.split("|"));else if(y.name==="dSelect"){let d=y.attrs.find(w=>w.key==="multiple");d&&d.value===!0&&!Array.isArray(v)&&(v=v.split("|"))}else if(y.name==="dRegion"){let d;if(Array.isArray(v)?v.length>0?d=v[v.length-1]:d="":v.includes("|")?(d=v.split("|"),d.length>0?d=d[d.length-1]:d=""):d=v,d){let w=d.slice(0,2)==="00"?"":d.slice(0,2).concat("0000"),g=d.slice(2,4)==="00"?"":d.slice(0,4).concat("00"),I=d.slice(4,6)==="00"?"":d.slice(0,6);this.vCity.includes(g)&&g!==d&&(I=g);let R=d.length!==9?"":d;v=[w,g,I,R]}else v=[]}else y.name==="dTime"&&v.slice(0,4)<1901&&(v="");$[y.id]=v,u[y.id]=y}r=[...r,{data:$}],b=[...b,u]}t.defVal=r,t.datList=o,t.dicList=b}}t.props.datset_id=m,t.props.datset_name=_,t.props.id=C}}}if(a&&a.length>0)for(let l in a){let n=a[l];await this.feedbackTabProperty(n,e)}},fillPatientInfo(t,e){let{isBasic:a,children:i}=t;if(!a){let{dataset_field:l,slots:n}=t;if(e.hasOwnProperty(l)&&(t.defVal=Array.isArray(t.defVal)?e[l]||[]:e[l]||""),n&&n.named&&n.named.length)for(let h in n.named){let m=n.named[h].comDetail;!m||this.fillPatientInfo(m,e)}}if(i&&i.length>0)for(let l of i)this.fillPatientInfo(l,e)},setNowCompVal(t,e=new Date){let{isBasic:a,children:i}=t;if(!a){const{name:l,props:{isDefNow:n},attrs:h}=t;if(l==="dTime"&&n){let m=h.find(F=>F.key==="type"),_=h.find(F=>F.key==="value-format");if(!m)return;let C=m.value==="datetimerange";e=this.$F.formatTime(new Date,_.value),t.defVal=C?[e,e]:e}}if(i&&i.length>0)for(let l in i){let n=i[l];!n||this.setNowCompVal(n,e)}},editRequired(t,e){const[a,i]=e;let{isBasic:l,children:n}=t;if(!l){let{id:h}=t;h===a&&(t.props.isRequired=i)}if(n&&n.length>0)for(let h of n)this.editRequired(h,e)},initGpDisCdt(t){let{isBasic:e,children:a}=t;if(e){if(a&&a.length>0)for(let l of a)this.initGpDisCdt(l)}else{const{name:l}=t;if(l==="dDraggable"&&a&&a.length>0){let n=this.handleLogic(t)&&t.props.groupDisabled;console.log(n,"logicCdtFlag"),t.props.logicCdtFlag=n;for(let h of a)if(h.name!=="dDraggable"){let{slots:m}=h;if(h.props.logicCdtFlag=n,m&&m.named&&m.named.length>0)for(let _ of m.named)i(_,n)}else this.initGpDisCdt(h)}}function i(l,n){let{comDetail:h}=l;if(!h)return;let{slots:m}=h;if(l.comDetail.props.logicCdtFlag=n,m&&m.named&&m.named.length>0)for(let _ of m.named)i(_,n)}},handleLogic(com){const{props:{gpDisCdtGp}}=com;if(console.log(gpDisCdtGp,"gpDisCdtGp"),!gpDisCdtGp||gpDisCdtGp.length===0||gpDisCdtGp.length===1&&!Object.values(gpDisCdtGp[0]).some(e=>e))return!0;let logicStr="",logicReflect={and:"&&",or:"||"};for(let idx in gpDisCdtGp){let val=gpDisCdtGp[idx];const{key,label,logicOp}=val;let itemStr="";if(idx!=gpDisCdtGp.length-1)if(this.$F.isEmpty(key)||this.$F.isEmpty(label)||this.$F.isEmpty(logicOp))itemStr="false&&";else{let keyVal=this.cbInfo?this.$F.isEmpty(this.cbInfo[key])?!0:this.cbInfo[key]:!0;if(keyVal===!0)itemStr="false&&";else{let evalRes=`'${keyVal}'=='${label}'`;console.log(evalRes,"evalRes");try{evalRes=eval(evalRes)}catch(t){console.log(t)}itemStr=`${evalRes}${logicReflect[logicOp]}`}}else if(this.$F.isEmpty(key)||this.$F.isEmpty(label))itemStr="false";else if(this.cbInfo)if(this.cbInfo.hasOwnProperty(key)){let keyVal=this.cbInfo[key],evalRes=`'${keyVal}'=='${label}'`;try{evalRes=eval(evalRes)}catch(t){console.log(t)}itemStr=`${evalRes}`}else itemStr="false";else itemStr="false";logicStr+=itemStr}try{logicStr=eval(logicStr)}catch(t){console.log(t)}if(typeof logicStr=="boolean")return logicStr},async formCommunicate(t){console.log(this.$route.params.cbInfo,"\u8DEF\u7531\u53C2\u6570cbInfo");let e={},a=this.$route.params.cbInfo||{};if(t){let _=t.split("&");for(let C of _){let F=C.split("=");e[F[0]]=decodeURIComponent(F[1])}e.udfmsg=JSON.parse(e.udfmsg),a=e,console.log(e,"cbParamsObj")}if(console.log(a,"cbInfo"),Object.keys(a).length===0)return;const{id:i,act:l,dat_id:n,udfmsg:h,system:m}=a;if(this.cbInfo={...this.cbInfo,...a},m&&(this.cbInfo={...this.cbInfo,...h}),this.act=l,this.curRow={dat_id:n,form_id:i},l==="add"){if(await checkFormEnable(i).then(_=>{this.isEmpty=!1,this.emptyNote="",console.log(_,"is enable ?")}).catch(_=>{this.isEmpty=!0,this.emptyNote=_,console.log(_,"err")}),this.isEmpty)return;this.addCRB(i)}else["mod","view"].includes(l)&&this.handleEdit(this.curRow)},saveFormCallback(t){console.log(t,"data in saveFormCallback"),this.save(this.act,this.curRow,t.params)},getLicenseInfo(){getLicense().then(t=>{console.log(t);const{status:e,data:a}=t;e===100&&(this.expireData=a)})},debounce(t,e,a){var i=this;return function(){var l=arguments,n=function(){i.debounceTimeout=null,a||t.apply(i,l)},h=a&&!i.debounceTimeout;clearTimeout(i.debounceTimeout),i.debounceTimeout=setTimeout(n,e),h&&t.apply(i,l)}}}};var _sfc_render=function t(){var e=this,a=e._self._c;return a("div",{staticClass:"container"},[e.isEmpty?a("div",{staticStyle:{height:"100%",display:"flex","justify-content":"center","align-items":"center"}},[a("div",{staticStyle:{"font-size":"30px",padding:"8px"}},[e._v(e._s(e.emptyNote))]),a("el-button",{staticStyle:{"margin-left":"8px"},attrs:{size:"small"},on:{click:e.clearFormValidate}},[e._v("\u8FD4\u56DE")])],1):a("div",{directives:[{name:"show",rawName:"v-show",value:!e.isShowPrintRes,expression:"!isShowPrintRes"}],staticClass:"busForm"},[e.expireData.type===1?a("div",{staticClass:"expire-note"},[a("i",{staticClass:"el-icon-my-noteInfo",staticStyle:{"margin-right":"8px",color:"#007aff","font-size":"14px"}}),a("span",[e._v(e._s(e.expireData.content))])]):e._e(),e.tabData.length>1?a("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.onTabChange},model:{value:e.activeName,callback:function(i){e.activeName=i},expression:"activeName"}},e._l(e.tabData,function(i){return a("el-tab-pane",{key:i.id,attrs:{label:i.name,name:i.id}},[a("renderFormByJson",{key:i.id,ref:i.id,refInFor:!0,attrs:{data:i.data,isFirst:!0,disabled:e.act==="view"},on:{fillPatientInfo:l=>{e.fillPatientInfo(i.data,l)},editRequired:l=>{e.editRequired(i.data,l)}}})],1)}),1):e.tabData.length==1?a("renderFormByJson",{key:e.tabData[0].id,ref:e.tabData[0].id,attrs:{data:e.tabData[0].data,isFirst:!0,disabled:e.act==="view"},on:{fillPatientInfo:i=>{e.fillPatientInfo(e.tabData[0].data,i)},editRequired:i=>{e.editRequired(e.tabData[0].data,i)}}}):e._e(),e.act!=="view"&&e.cbInfo&&(!e.cbInfo.system||e.cbInfo.system&&e.cbInfo.showSaveBtn)?a("div",{staticClass:"footer-btn"},[e.dialogTitle==="\u65B0\u589E"?a("el-button",{attrs:{type:"primary",size:"small",loading:e.btnLoading},on:{click:function(i){return e.dSave("add")}}},[e._v("\u786E\u5B9A")]):e._e(),e.dialogTitle==="\u7F16\u8F91"?a("el-button",{attrs:{type:"primary",size:"small",loading:e.btnLoading},on:{click:function(i){return e.dSave("mod",e.curRow)}}},[e._v("\u786E\u5B9A")]):e._e(),a("el-button",{attrs:{size:"small"},on:{click:e.clearFormValidate}},[e._v("\u53D6\u6D88")])],1):e._e()],1),e.isShowPrintRes?a("div",{staticClass:"print-section"},[a("div",{staticClass:"tool"},[a("el-button",{on:{click:()=>{e.setPrintResShow(!1),e.setPrint(!1)}}},[e._v("\u8FD4\u56DE")]),a("el-button",{attrs:{type:"primary"},on:{click:e.printFn}},[e._v("\u6253\u5370")])],1),a("div",{staticStyle:{display:"inline-block"},attrs:{id:"canvasCon"}}),a("el-slider",{style:{width:`${e.printWidth}px`},attrs:{"format-tooltip":e.formatTooltip,range:"","show-stops":"",max:e.printWidth},model:{value:e.printPaddingList,callback:function(i){e.printPaddingList=i},expression:"printPaddingList"}}),e.tabData[0]?a("renderFormByJson",{ref:"printView",style:{padding:`0 ${e.printWidth-e.printPaddingList[1]}px 0 ${e.printPaddingList[0]}px`},attrs:{id:"printCon",data:e.tabData[0].data}}):e._e()],1):e._e()])},_sfc_staticRenderFns=[],__component__=normalizeComponent(_sfc_main,_sfc_render,_sfc_staticRenderFns,!1,null,"5670d065",null,null);const reportCard=__component__.exports;export{reportCard as default};
