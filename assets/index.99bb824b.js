import{a3 as r,g as lt}from"./index.0af4b258.js";import{F as yt}from"./FileSaver.min.e4a8dfbd.js";import{c as vt}from"./codeMirror.ac9e4b0d.js";class Ct{constructor(){this.cells=[]}copy(t,e,i={}){this.options=Object.assign({},i);const n=(r.Model.isModel(e)?e:e.model).cloneSubGraph(t,i);this.cells=r.ArrayExt.sortBy(Object.keys(n).map(a=>n[a]),a=>a.isEdge()?2:1),this.serialize(i)}cut(t,e,i={}){this.copy(t,e,i),(r.Graph.isGraph(e)?e.model:e).batchUpdate("cut",()=>{t.forEach(n=>n.remove())})}paste(t,e={}){const i=Object.assign(Object.assign({},this.options),e),{offset:o,edgeProps:n,nodeProps:a}=i;let l=20,c=20;o&&(l=typeof o=="number"?o:o.dx,c=typeof o=="number"?o:o.dy),this.deserialize(i);const h=this.cells;h.forEach(b=>{b.model=null,b.removeProp("zIndex"),(l||c)&&b.translate(l,c),a&&b.isNode()&&b.prop(a),n&&b.isEdge()&&b.prop(n)});const p=r.Graph.isGraph(t)?t.model:t;return p.batchUpdate("paste",()=>{p.addCells(this.cells)}),this.copy(h,t,e),h}serialize(t){t.useLocalStorage!==!1&&st.save(this.cells)}deserialize(t){if(t.useLocalStorage){const e=st.fetch();e&&(this.cells=e)}}isEmpty(t={}){return t.useLocalStorage&&this.deserialize(t),this.cells.length<=0}clean(){this.options={},this.cells=[],st.clean()}}var st;(function(s){const t=`${r.Config.prefixCls}.clipboard.cells`;function e(n){if(window.localStorage){const a=n.map(l=>l.toJSON());localStorage.setItem(t,JSON.stringify(a))}}s.save=e;function i(){if(window.localStorage){const n=localStorage.getItem(t),a=n?JSON.parse(n):[];if(a)return r.Model.fromJSON(a)}}s.fetch=i;function o(){window.localStorage&&localStorage.removeItem(t)}s.clean=o})(st||(st={}));r.Graph.prototype.isClipboardEnabled=function(){const s=this.getPlugin("clipboard");return s?s.isEnabled():!1};r.Graph.prototype.enableClipboard=function(){const s=this.getPlugin("clipboard");return s&&s.enable(),this};r.Graph.prototype.disableClipboard=function(){const s=this.getPlugin("clipboard");return s&&s.disable(),this};r.Graph.prototype.toggleClipboard=function(s){const t=this.getPlugin("clipboard");return t&&t.toggleEnabled(s),this};r.Graph.prototype.isClipboardEmpty=function(s){const t=this.getPlugin("clipboard");return t?t.isEmpty(s):!0};r.Graph.prototype.getCellsInClipboard=function(){const s=this.getPlugin("clipboard");return s?s.getCellsInClipboard():[]};r.Graph.prototype.cleanClipboard=function(){const s=this.getPlugin("clipboard");return s&&s.clean(),this};r.Graph.prototype.copy=function(s,t){const e=this.getPlugin("clipboard");return e&&e.copy(s,t),this};r.Graph.prototype.cut=function(s,t){const e=this.getPlugin("clipboard");return e&&e.cut(s,t),this};r.Graph.prototype.paste=function(s,t){const e=this.getPlugin("clipboard");return e?e.paste(s,t):[]};var wt=globalThis&&globalThis.__decorate||function(s,t,e,i){var o=arguments.length,n=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(s,t,e,i);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(n=(o<3?a(n):o>3?a(t,e,n):a(t,e))||n);return o>3&&n&&Object.defineProperty(t,e,n),n},St=globalThis&&globalThis.__rest||function(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,i=Object.getOwnPropertySymbols(s);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(s,i[o])&&(e[i[o]]=s[i[o]]);return e};class ct extends r.Basecoat{get disabled(){return this.options.enabled!==!0}get cells(){return this.clipboardImpl.cells}constructor(t={}){super(),this.name="clipboard",this.options=Object.assign({enabled:!0},t)}init(t){this.graph=t,this.clipboardImpl=new Ct,this.clipboardImpl.deserialize(this.options)}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(t){return t!=null?t!==this.isEnabled()&&(t?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}isEmpty(t={}){return this.clipboardImpl.isEmpty(t)}getCellsInClipboard(){return this.cells}clean(t){return(!this.disabled||t)&&(this.clipboardImpl.clean(),this.notify("clipboard:changed",{cells:[]})),this}copy(t,e={}){return this.disabled||(this.clipboardImpl.copy(t,this.graph,Object.assign(Object.assign({},this.commonOptions),e)),this.notify("clipboard:changed",{cells:t})),this}cut(t,e={}){return this.disabled||(this.clipboardImpl.cut(t,this.graph,Object.assign(Object.assign({},this.commonOptions),e)),this.notify("clipboard:changed",{cells:t})),this}paste(t={},e=this.graph){return this.disabled?[]:this.clipboardImpl.paste(e,Object.assign(Object.assign({},this.commonOptions),t))}get commonOptions(){const t=this.options;return St(t,["enabled"])}notify(t,e){this.trigger(t,e),this.graph.trigger(t,e)}dispose(){this.clean(!0),this.off()}}wt([r.Basecoat.dispose()],ct.prototype,"dispose",null);r.Graph.prototype.isHistoryEnabled=function(){const s=this.getPlugin("history");return s?s.isEnabled():!1};r.Graph.prototype.enableHistory=function(){const s=this.getPlugin("history");return s&&s.enable(),this};r.Graph.prototype.disableHistory=function(){const s=this.getPlugin("history");return s&&s.disable(),this};r.Graph.prototype.toggleHistory=function(s){const t=this.getPlugin("history");return t&&t.toggleEnabled(s),this};r.Graph.prototype.undo=function(s){const t=this.getPlugin("history");return t&&t.undo(s),this};r.Graph.prototype.redo=function(s){const t=this.getPlugin("history");return t&&t.redo(s),this};r.Graph.prototype.undoAndCancel=function(s){const t=this.getPlugin("history");return t&&t.cancel(s),this};r.Graph.prototype.canUndo=function(){const s=this.getPlugin("history");return s?s.canUndo():!1};r.Graph.prototype.canRedo=function(){const s=this.getPlugin("history");return s?s.canRedo():!1};r.Graph.prototype.cleanHistory=function(s){const t=this.getPlugin("history");return t&&t.clean(s),this};r.Graph.prototype.getHistoryStackSize=function(){return this.getPlugin("history").getSize()};r.Graph.prototype.getUndoStackSize=function(){return this.getPlugin("history").getUndoSize()};r.Graph.prototype.getRedoStackSize=function(){return this.getPlugin("history").getRedoSize()};r.Graph.prototype.getUndoRemainSize=function(){return this.getPlugin("history").getUndoRemainSize()};var ht=globalThis&&globalThis.__decorate||function(s,t,e,i){var o=arguments.length,n=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(s,t,e,i);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(n=(o<3?a(n):o>3?a(t,e,n):a(t,e))||n);return o>3&&n&&Object.defineProperty(t,e,n),n};class q extends r.Basecoat{constructor(t={}){super(),this.name="history",this.batchCommands=null,this.batchLevel=0,this.lastBatchIndex=-1,this.freezed=!1,this.stackSize=0,this.handlers=[];const{stackSize:e=0}=t;this.stackSize=e,this.options=L.getOptions(t),this.validator=new q.Validator({history:this,cancelInvalid:this.options.cancelInvalid})}init(t){this.graph=t,this.model=this.graph.model,this.clean(),this.startListening()}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(t){return t!=null?t!==this.isEnabled()&&(t?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}undo(t={}){if(!this.disabled){const e=this.undoStack.pop();e&&(this.revertCommand(e,t),this.redoStack.push(e),this.notify("undo",e,t))}return this}redo(t={}){if(!this.disabled){const e=this.redoStack.pop();e&&(this.applyCommand(e,t),this.undoStackPush(e),this.notify("redo",e,t))}return this}cancel(t={}){if(!this.disabled){const e=this.undoStack.pop();e&&(this.revertCommand(e,t),this.redoStack=[],this.notify("cancel",e,t))}return this}getSize(){return this.stackSize}getUndoRemainSize(){const t=this.undoStack.length;return this.stackSize-t}getUndoSize(){return this.undoStack.length}getRedoSize(){return this.redoStack.length}canUndo(){return!this.disabled&&this.undoStack.length>0}canRedo(){return!this.disabled&&this.redoStack.length>0}clean(t={}){return this.undoStack=[],this.redoStack=[],this.notify("clean",null,t),this}get disabled(){return this.options.enabled!==!0}validate(t,...e){return this.validator.validate(t,...e),this}startListening(){this.model.on("batch:start",this.initBatchCommand,this),this.model.on("batch:stop",this.storeBatchCommand,this),this.options.eventNames&&this.options.eventNames.forEach((t,e)=>{this.handlers[e]=this.addCommand.bind(this,t),this.model.on(t,this.handlers[e])}),this.validator.on("invalid",t=>this.trigger("invalid",t))}stopListening(){this.model.off("batch:start",this.initBatchCommand,this),this.model.off("batch:stop",this.storeBatchCommand,this),this.options.eventNames&&(this.options.eventNames.forEach((t,e)=>{this.model.off(t,this.handlers[e])}),this.handlers.length=0),this.validator.off("invalid")}createCommand(t){return{batch:t?t.batch:!1,data:{}}}revertCommand(t,e){this.freezed=!0;const i=Array.isArray(t)?L.sortBatchCommands(t):[t];for(let o=i.length-1;o>=0;o-=1){const n=i[o],a=Object.assign(Object.assign({},e),r.ObjectExt.pick(n.options,this.options.revertOptionsList||[]));this.executeCommand(n,!0,a)}this.freezed=!1}applyCommand(t,e){this.freezed=!0;const i=Array.isArray(t)?L.sortBatchCommands(t):[t];for(let o=0;o<i.length;o+=1){const n=i[o],a=Object.assign(Object.assign({},e),r.ObjectExt.pick(n.options,this.options.applyOptionsList||[]));this.executeCommand(n,!1,a)}this.freezed=!1}executeCommand(t,e,i){const o=this.model,n=o.getCell(t.data.id),a=t.event;if(L.isAddEvent(a)&&e||L.isRemoveEvent(a)&&!e)n&&n.remove(i);else if(L.isAddEvent(a)&&!e||L.isRemoveEvent(a)&&e){const l=t.data;l.node?o.addNode(l.props,i):l.edge&&o.addEdge(l.props,i)}else if(L.isChangeEvent(a)){const l=t.data,c=l.key;if(c&&n){const h=e?l.prev[c]:l.next[c];l.key==="attrs"&&this.ensureUndefinedAttrs(h,e?l.next[c]:l.prev[c])&&(i.dirty=!0),n.prop(c,h,i)}}else{const l=this.options.executeCommand;l&&r.FunctionExt.call(l,this,t,e,i)}}addCommand(t,e){if(this.freezed||this.disabled)return;const i=e,o=i.options||{};if(o.dryrun||L.isAddEvent(t)&&this.options.ignoreAdd||L.isRemoveEvent(t)&&this.options.ignoreRemove||L.isChangeEvent(t)&&this.options.ignoreChange)return;const n=this.options.beforeAddCommand;if(n!=null&&r.FunctionExt.call(n,this,t,e)===!1)return;t==="cell:change:*"&&(t=`cell:change:${i.key}`);const a=i.cell,l=r.Model.isModel(a);let c;if(this.batchCommands){c=this.batchCommands[Math.max(this.lastBatchIndex,0)];const p=l&&!c.modelChange||c.data.id!==a.id,b=c.event!==t;if(this.lastBatchIndex>=0&&(p||b)){const u=this.batchCommands.findIndex(f=>(l&&f.modelChange||f.data.id===a.id)&&f.event===t);u<0||L.isAddEvent(t)||L.isRemoveEvent(t)?c=this.createCommand({batch:!0}):(c=this.batchCommands[u],this.batchCommands.splice(u,1)),this.batchCommands.push(c),this.lastBatchIndex=this.batchCommands.length-1}}else c=this.createCommand({batch:!1});if(L.isAddEvent(t)||L.isRemoveEvent(t)){const p=c.data;return c.event=t,c.options=o,p.id=a.id,p.props=r.ObjectExt.cloneDeep(a.toJSON()),a.isEdge()?p.edge=!0:a.isNode()&&(p.node=!0),this.push(c,o)}if(L.isChangeEvent(t)){const p=e.key,b=c.data;return(!c.batch||!c.event)&&(c.event=t,c.options=o,b.key=p,b.prev==null&&(b.prev={}),b.prev[p]=r.ObjectExt.cloneDeep(a.previous(p)),l?c.modelChange=!0:b.id=a.id),b.next==null&&(b.next={}),b.next[p]=r.ObjectExt.cloneDeep(a.prop(p)),this.push(c,o)}const h=this.options.afterAddCommand;h&&r.FunctionExt.call(h,this,t,e,c),this.push(c,o)}initBatchCommand(t){this.freezed||(this.batchCommands?this.batchLevel+=1:(this.batchCommands=[this.createCommand({batch:!0})],this.batchLevel=0,this.lastBatchIndex=-1))}storeBatchCommand(t){if(!this.freezed)if(this.batchCommands&&this.batchLevel<=0){const e=this.filterBatchCommand(this.batchCommands);e.length>0&&(this.redoStack=[],this.undoStackPush(e),this.consolidateCommands(),this.notify("add",e,t)),this.batchCommands=null,this.lastBatchIndex=-1,this.batchLevel=0}else this.batchCommands&&this.batchLevel>0&&(this.batchLevel-=1)}filterBatchCommand(t){let e=t.slice();const i=[];for(;e.length>0;){const o=e.shift(),n=o.event,a=o.data.id;if(n!=null&&(a!=null||o.modelChange)){if(L.isAddEvent(n)){const l=e.findIndex(c=>L.isRemoveEvent(c.event)&&c.data.id===a);if(l>=0){e=e.filter((c,h)=>l<h||c.data.id!==a);continue}}else if(L.isRemoveEvent(n)){const l=e.findIndex(c=>L.isAddEvent(c.event)&&c.data.id===a);if(l>=0){e.splice(l,1);continue}}else if(L.isChangeEvent(n)){const l=o.data;if(r.ObjectExt.isEqual(l.prev,l.next))continue}i.push(o)}}return i}notify(t,e,i){const o=e==null?null:Array.isArray(e)?e:[e];this.emit(t,{cmds:o,options:i}),this.graph.trigger(`history:${t}`,{cmds:o,options:i}),this.emit("change",{cmds:o,options:i}),this.graph.trigger("history:change",{cmds:o,options:i})}push(t,e){this.redoStack=[],t.batch?(this.lastBatchIndex=Math.max(this.lastBatchIndex,0),this.emit("batch",{cmd:t,options:e})):(this.undoStackPush(t),this.consolidateCommands(),this.notify("add",t,e))}consolidateCommands(){var t;const e=this.undoStack[this.undoStack.length-1],i=this.undoStack[this.undoStack.length-2];if(!Array.isArray(e))return;const o=new Set(e.map(a=>a.event));if(o.size!==2||!o.has("cell:change:parent")||!o.has("cell:change:children")||!e.every(a=>{var l;return a.batch&&((l=a.options)===null||l===void 0?void 0:l.ui)})||!Array.isArray(i)||i.length!==1)return;const n=i[0];n.event!=="cell:change:position"||!(!((t=n.options)===null||t===void 0)&&t.ui)||(i.push(...e),this.undoStack.pop())}undoStackPush(t){if(this.stackSize===0){this.undoStack.push(t);return}this.undoStack.length>=this.stackSize&&this.undoStack.shift(),this.undoStack.push(t)}ensureUndefinedAttrs(t,e){let i=!1;return t!==null&&e!==null&&typeof t=="object"&&typeof e=="object"&&Object.keys(e).forEach(o=>{t[o]===void 0&&e[o]!==void 0?(t[o]=void 0,i=!0):typeof t[o]=="object"&&typeof e[o]=="object"&&(i=this.ensureUndefinedAttrs(t[o],e[o]))}),i}dispose(){this.validator.dispose(),this.clean(),this.stopListening(),this.off()}}ht([r.Basecoat.dispose()],q.prototype,"dispose",null);(function(s){class t extends r.Basecoat{constructor(i){super(),this.map={},this.command=i.history,this.cancelInvalid=i.cancelInvalid!==!1,this.command.on("add",this.onCommandAdded,this)}onCommandAdded({cmds:i}){return Array.isArray(i)?i.every(o=>this.isValidCommand(o)):this.isValidCommand(i)}isValidCommand(i){if(i.options&&i.options.validation===!1)return!0;const o=i.event&&this.map[i.event]||[];let n=null;return o.forEach(a=>{let l=0;const c=h=>{const p=a[l];l+=1;try{if(p)p(h,i,c);else{n=h;return}}catch(b){c(b)}};c(n)}),n?(this.cancelInvalid&&this.command.cancel(),this.emit("invalid",{err:n}),!1):!0}validate(i,...o){const n=Array.isArray(i)?i:i.split(/\s+/);return o.forEach(a=>{if(typeof a!="function")throw new Error(`${n.join(" ")} requires callback functions.`)}),n.forEach(a=>{this.map[a]==null&&(this.map[a]=[]),this.map[a].push(o)}),this}dispose(){this.command.off("add",this.onCommandAdded,this)}}ht([r.Basecoat.dispose()],t.prototype,"dispose",null),s.Validator=t})(q||(q={}));var L;(function(s){function t(a){return a==="cell:added"}s.isAddEvent=t;function e(a){return a==="cell:removed"}s.isRemoveEvent=e;function i(a){return a!=null&&a.startsWith("cell:change:")}s.isChangeEvent=i;function o(a){const l=["cell:added","cell:removed","cell:change:*"],c=["batch:start","batch:stop"],h=a.eventNames?a.eventNames.filter(p=>!(s.isChangeEvent(p)||l.includes(p)||c.includes(p))):l;return Object.assign(Object.assign({enabled:!0},a),{eventNames:h,applyOptionsList:a.applyOptionsList||["propertyPath"],revertOptionsList:a.revertOptionsList||["propertyPath"]})}s.getOptions=o;function n(a){const l=[];for(let c=0,h=a.length;c<h;c+=1){const p=a[c];let b=null;if(s.isAddEvent(p.event)){const u=p.data.id;for(let f=0;f<c;f+=1)if(a[f].data.id===u){b=f;break}}b!==null?l.splice(b,0,p):l.push(p)}return l}s.sortBatchCommands=n})(L||(L={}));var dt={exports:{}};(function(s){(function(t,e,i){if(!t)return;for(var o={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},n={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},a={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},l={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},c,h=1;h<20;++h)o[111+h]="f"+h;for(h=0;h<=9;++h)o[h+96]=h.toString();function p(d,g,y){if(d.addEventListener){d.addEventListener(g,y,!1);return}d.attachEvent("on"+g,y)}function b(d){if(d.type=="keypress"){var g=String.fromCharCode(d.which);return d.shiftKey||(g=g.toLowerCase()),g}return o[d.which]?o[d.which]:n[d.which]?n[d.which]:String.fromCharCode(d.which).toLowerCase()}function u(d,g){return d.sort().join(",")===g.sort().join(",")}function f(d){var g=[];return d.shiftKey&&g.push("shift"),d.altKey&&g.push("alt"),d.ctrlKey&&g.push("ctrl"),d.metaKey&&g.push("meta"),g}function w(d){if(d.preventDefault){d.preventDefault();return}d.returnValue=!1}function m(d){if(d.stopPropagation){d.stopPropagation();return}d.cancelBubble=!0}function x(d){return d=="shift"||d=="ctrl"||d=="alt"||d=="meta"}function I(){if(!c){c={};for(var d in o)d>95&&d<112||o.hasOwnProperty(d)&&(c[o[d]]=d)}return c}function E(d,g,y){return y||(y=I()[d]?"keydown":"keypress"),y=="keypress"&&g.length&&(y="keydown"),y}function O(d){return d==="+"?["+"]:(d=d.replace(/\+{2}/g,"+plus"),d.split("+"))}function S(d,g){var y,v,N,M=[];for(y=O(d),N=0;N<y.length;++N)v=y[N],l[v]&&(v=l[v]),g&&g!="keypress"&&a[v]&&(v=a[v],M.push("shift")),x(v)&&M.push(v);return g=E(v,M,g),{key:v,modifiers:M,action:g}}function k(d,g){return d===null||d===e?!1:d===g?!0:k(d.parentNode,g)}function D(d){var g=this;if(d=d||e,!(g instanceof D))return new D(d);g.target=d,g._callbacks={},g._directMap={};var y={},v,N=!1,M=!1,_=!1;function F(C){C=C||{};var G=!1,R;for(R in y){if(C[R]){G=!0;continue}y[R]=0}G||(_=!1)}function K(C,G,R,z,A,H){var P,T,Z=[],U=R.type;if(!g._callbacks[C])return[];for(U=="keyup"&&x(C)&&(G=[C]),P=0;P<g._callbacks[C].length;++P)if(T=g._callbacks[C][P],!(!z&&T.seq&&y[T.seq]!=T.level)&&U==T.action&&(U=="keypress"&&!R.metaKey&&!R.ctrlKey||u(G,T.modifiers))){var mt=!z&&T.combo==A,xt=z&&T.seq==z&&T.level==H;(mt||xt)&&g._callbacks[C].splice(P,1),Z.push(T)}return Z}function X(C,G,R,z){g.stopCallback(G,G.target||G.srcElement,R,z)||C(G,R)===!1&&(w(G),m(G))}g._handleKey=function(C,G,R){var z=K(C,G,R),A,H={},P=0,T=!1;for(A=0;A<z.length;++A)z[A].seq&&(P=Math.max(P,z[A].level));for(A=0;A<z.length;++A){if(z[A].seq){if(z[A].level!=P)continue;T=!0,H[z[A].seq]=1,X(z[A].callback,R,z[A].combo,z[A].seq);continue}T||X(z[A].callback,R,z[A].combo)}var Z=R.type=="keypress"&&M;R.type==_&&!x(C)&&!Z&&F(H),M=T&&R.type=="keydown"};function W(C){typeof C.which!="number"&&(C.which=C.keyCode);var G=b(C);if(!!G){if(C.type=="keyup"&&N===G){N=!1;return}g.handleKey(G,f(C),C)}}function rt(){clearTimeout(v),v=setTimeout(F,1e3)}function it(C,G,R,z){y[C]=0;function A(U){return function(){_=U,++y[C],rt()}}function H(U){X(R,U,C),z!=="keyup"&&(N=b(U)),setTimeout(F,10)}for(var P=0;P<G.length;++P){var T=P+1===G.length,Z=T?H:A(z||S(G[P+1]).action);ot(G[P],Z,z,C,P)}}function ot(C,G,R,z,A){g._directMap[C+":"+R]=G,C=C.replace(/\s+/g," ");var H=C.split(" "),P;if(H.length>1){it(C,H,G,R);return}P=S(C,R),g._callbacks[P.key]=g._callbacks[P.key]||[],K(P.key,P.modifiers,{type:P.action},z,C,A),g._callbacks[P.key][z?"unshift":"push"]({callback:G,modifiers:P.modifiers,action:P.action,seq:z,level:A,combo:C})}g._bindMultiple=function(C,G,R){for(var z=0;z<C.length;++z)ot(C[z],G,R)},p(d,"keypress",W),p(d,"keydown",W),p(d,"keyup",W)}D.prototype.bind=function(d,g,y){var v=this;return d=d instanceof Array?d:[d],v._bindMultiple.call(v,d,g,y),v},D.prototype.unbind=function(d,g){var y=this;return y.bind.call(y,d,function(){},g)},D.prototype.trigger=function(d,g){var y=this;return y._directMap[d+":"+g]&&y._directMap[d+":"+g]({},d),y},D.prototype.reset=function(){var d=this;return d._callbacks={},d._directMap={},d},D.prototype.stopCallback=function(d,g){var y=this;if((" "+g.className+" ").indexOf(" mousetrap ")>-1||k(g,y.target))return!1;if("composedPath"in d&&typeof d.composedPath=="function"){var v=d.composedPath()[0];v!==d.target&&(g=v)}return g.tagName=="INPUT"||g.tagName=="SELECT"||g.tagName=="TEXTAREA"||g.isContentEditable},D.prototype.handleKey=function(){var d=this;return d._handleKey.apply(d,arguments)},D.addKeycodes=function(d){for(var g in d)d.hasOwnProperty(g)&&(o[g]=d[g]);c=null},D.init=function(){var d=D(e);for(var g in d)g.charAt(0)!=="_"&&(D[g]=function(y){return function(){return d[y].apply(d,arguments)}}(g))},D.init(),t.Mousetrap=D,s.exports&&(s.exports=D),typeof i=="function"&&i.amd&&i(function(){return D})})(typeof window<"u"?window:null,typeof window<"u"?document:null)})(dt);const Et=dt.exports;var Dt=globalThis&&globalThis.__decorate||function(s,t,e,i){var o=arguments.length,n=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(s,t,e,i);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(n=(o<3?a(n):o>3?a(t,e,n):a(t,e))||n);return o>3&&n&&Object.defineProperty(t,e,n),n};class Q extends r.Disposable{get graph(){return this.options.graph}constructor(t){super(),this.options=t;const e=this.graph.getPlugin("scroller");this.container=e?e.container:this.graph.container,t.global?this.target=document:(this.target=this.container,this.disabled||this.target.setAttribute("tabindex","-1"),this.graph.on("cell:mouseup",this.focus,this),this.graph.on("blank:mouseup",this.focus,this)),this.mousetrap=Q.createMousetrap(this)}get disabled(){return this.options.enabled!==!0}enable(){this.disabled&&(this.options.enabled=!0,this.target instanceof HTMLElement&&this.target.setAttribute("tabindex","-1"))}disable(){this.disabled||(this.options.enabled=!1,this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))}on(t,e,i){this.mousetrap.bind(this.getKeys(t),e,i)}off(t,e){this.mousetrap.unbind(this.getKeys(t),e)}clear(){this.mousetrap.reset()}trigger(t,e){this.mousetrap.trigger(t,e)}focus(t){if(this.isInputEvent(t.e))return;this.target.focus({preventScroll:!0})}getKeys(t){return(Array.isArray(t)?t:[t]).map(e=>this.formatkey(e))}formatkey(t){const e=t.toLocaleLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command").replace("arrowup","up").replace("arrowright","right").replace("arrowdown","down").replace("arrowleft","left"),i=this.options.format;return i?r.FunctionExt.call(i,this.graph,e):e}isGraphEvent(t){const e=t.target,i=t.currentTarget;return e?e===this.target||i===this.target||e===document.body?!0:r.Dom.contains(this.container,e):!1}isInputEvent(t){var e;const i=t.target,o=(e=i==null?void 0:i.tagName)===null||e===void 0?void 0:e.toLowerCase();let n=["input","textarea"].includes(o);return r.Dom.attr(i,"contenteditable")==="true"&&(n=!0),n}isEnabledForEvent(t){const e=!this.disabled&&this.isGraphEvent(t),i=this.isInputEvent(t);if(e){if(i&&(t.key==="Backspace"||t.key==="Delete"))return!1;if(this.options.guard)return r.FunctionExt.call(this.options.guard,this.graph,t)}return e}dispose(){this.mousetrap.reset()}}Dt([r.Disposable.dispose()],Q.prototype,"dispose",null);(function(s){function t(e){const i=new Et(e.target),o=i.stopCallback;return i.stopCallback=(n,a,l)=>e.isEnabledForEvent(n)?o?o.call(i,n,a,l):!1:!0,i}s.createMousetrap=t})(Q||(Q={}));r.Graph.prototype.isKeyboardEnabled=function(){const s=this.getPlugin("keyboard");return s?s.isEnabled():!1};r.Graph.prototype.enableKeyboard=function(){const s=this.getPlugin("keyboard");return s&&s.enable(),this};r.Graph.prototype.disableKeyboard=function(){const s=this.getPlugin("keyboard");return s&&s.disable(),this};r.Graph.prototype.toggleKeyboard=function(s){const t=this.getPlugin("keyboard");return t&&t.toggleEnabled(s),this};r.Graph.prototype.bindKey=function(s,t,e){const i=this.getPlugin("keyboard");return i&&i.bindKey(s,t,e),this};r.Graph.prototype.unbindKey=function(s,t){const e=this.getPlugin("keyboard");return e&&e.unbindKey(s,t),this};r.Graph.prototype.clearKeys=function(){const s=this.getPlugin("keyboard");return s&&s.clear(),this};r.Graph.prototype.triggerKey=function(s,t){const e=this.getPlugin("keyboard");return e&&e.trigger(s,t),this};var Mt=globalThis&&globalThis.__decorate||function(s,t,e,i){var o=arguments.length,n=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(s,t,e,i);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(n=(o<3?a(n):o>3?a(t,e,n):a(t,e))||n);return o>3&&n&&Object.defineProperty(t,e,n),n};class pt extends r.Disposable{constructor(t={}){super(),this.name="keyboard",this.options=Object.assign({enabled:!0},t)}init(t){this.keyboardImpl=new Q(Object.assign(Object.assign({},this.options),{graph:t}))}isEnabled(){return!this.keyboardImpl.disabled}enable(){this.keyboardImpl.enable()}disable(){this.keyboardImpl.disable()}toggleEnabled(t){return t!=null?t!==this.isEnabled()&&(t?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}bindKey(t,e,i){return this.keyboardImpl.on(t,e,i),this}trigger(t,e){return this.keyboardImpl.trigger(t,e),this}clear(){return this.keyboardImpl.clear(),this}unbindKey(t,e){return this.keyboardImpl.off(t,e),this}dispose(){this.keyboardImpl.dispose()}}Mt([r.Disposable.dispose()],pt.prototype,"dispose",null);var Ot=globalThis&&globalThis.__decorate||function(s,t,e,i){var o=arguments.length,n=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(s,t,e,i);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(n=(o<3?a(n):o>3?a(t,e,n):a(t,e))||n);return o>3&&n&&Object.defineProperty(t,e,n),n};class ut extends r.View{get graph(){return this.options.graph}get boxClassName(){return this.prefixClassName(j.classNames.box)}get $boxes(){return r.Dom.children(this.container,this.boxClassName)}get handleOptions(){return this.options}constructor(t){super(),this.options=t,this.options.model&&(this.options.collection=this.options.model.collection),this.options.collection?this.collection=this.options.collection:(this.collection=new r.Collection([],{comparator:j.depthComparator}),this.options.collection=this.collection),this.boxCount=0,this.createContainer(),this.startListening()}startListening(){const t=this.graph,e=this.collection;this.delegateEvents({[`mousedown .${this.boxClassName}`]:"onSelectionBoxMouseDown",[`touchstart .${this.boxClassName}`]:"onSelectionBoxMouseDown"},!0),t.on("scale",this.onGraphTransformed,this),t.on("translate",this.onGraphTransformed,this),t.model.on("updated",this.onModelUpdated,this),e.on("added",this.onCellAdded,this),e.on("removed",this.onCellRemoved,this),e.on("reseted",this.onReseted,this),e.on("updated",this.onCollectionUpdated,this),e.on("node:change:position",this.onNodePositionChanged,this),e.on("cell:changed",this.onCellChanged,this)}stopListening(){const t=this.graph,e=this.collection;this.undelegateEvents(),t.off("scale",this.onGraphTransformed,this),t.off("translate",this.onGraphTransformed,this),t.model.off("updated",this.onModelUpdated,this),e.off("added",this.onCellAdded,this),e.off("removed",this.onCellRemoved,this),e.off("reseted",this.onReseted,this),e.off("updated",this.onCollectionUpdated,this),e.off("node:change:position",this.onNodePositionChanged,this),e.off("cell:changed",this.onCellChanged,this)}onRemove(){this.stopListening()}onGraphTransformed(){this.updateSelectionBoxes()}onCellChanged(){this.updateSelectionBoxes()}onNodePositionChanged({node:t,options:e}){const{showNodeSelectionBox:i,pointerEvents:o}=this.options,{ui:n,selection:a,translateBy:l,snapped:c}=e,h=(i!==!0||o&&this.getPointerEventsValue(o)==="none")&&!this.translating&&!a,p=n&&l&&t.id===l;if(h&&(p||c)){this.translating=!0;const b=t.position(),u=t.previous("position"),f=b.x-u.x,w=b.y-u.y;(f!==0||w!==0)&&this.translateSelectedNodes(f,w,t,e),this.translating=!1}}onModelUpdated({removed:t}){t&&t.length&&this.unselect(t)}isEmpty(){return this.length<=0}isSelected(t){return this.collection.has(t)}get length(){return this.collection.length}get cells(){return this.collection.toArray()}select(t,e={}){e.dryrun=!0;const i=this.filter(Array.isArray(t)?t:[t]);return this.collection.add(i,e),this}unselect(t,e={}){return e.dryrun=!0,this.collection.remove(Array.isArray(t)?t:[t],e),this}reset(t,e={}){if(t){if(e.batch){const h=this.filter(Array.isArray(t)?t:[t]);return this.collection.reset(h,Object.assign(Object.assign({},e),{ui:!0})),this}const i=this.cells,o=this.filter(Array.isArray(t)?t:[t]),n={},a={};i.forEach(h=>n[h.id]=h),o.forEach(h=>a[h.id]=h);const l=[],c=[];return o.forEach(h=>{n[h.id]||l.push(h)}),i.forEach(h=>{a[h.id]||c.push(h)}),c.length&&this.unselect(c,Object.assign(Object.assign({},e),{ui:!0})),l.length&&this.select(l,Object.assign(Object.assign({},e),{ui:!0})),c.length===0&&l.length===0&&this.updateContainer(),this}return this.clean(e)}clean(t={}){return this.length&&(t.batch===!1?this.unselect(this.cells,t):this.collection.reset([],Object.assign(Object.assign({},t),{ui:!0}))),this}setFilter(t){this.options.filter=t}setContent(t){this.options.content=t}startSelecting(t){t=this.normalizeEvent(t),this.clean();let e,i;const o=this.graph.container;if(t.offsetX!=null&&t.offsetY!=null&&o.contains(t.target))e=t.offsetX,i=t.offsetY;else{const n=r.Dom.offset(o),a=o.scrollLeft,l=o.scrollTop;e=t.clientX-n.left+window.pageXOffset+a,i=t.clientY-n.top+window.pageYOffset+l}r.Dom.css(this.container,{top:i,left:e,width:1,height:1}),this.setEventData(t,{action:"selecting",clientX:t.clientX,clientY:t.clientY,offsetX:e,offsetY:i,scrollerX:0,scrollerY:0,moving:!1}),this.delegateDocumentEvents(j.documentEvents,t.data)}filter(t){const e=this.options.filter;return t.filter(i=>Array.isArray(e)?e.some(o=>typeof o=="string"?i.shape===o:i.id===o.id):typeof e=="function"?r.FunctionExt.call(e,this.graph,i):!0)}stopSelecting(t){const e=this.graph,i=this.getEventData(t);switch(i.action){case"selecting":{let n=r.Dom.width(this.container),a=r.Dom.height(this.container);const l=r.Dom.offset(this.container),c=e.pageToLocal(l.left,l.top),h=e.transform.getScale();n/=h.sx,a/=h.sy;const p=new r.Rectangle(c.x,c.y,n,a),b=this.getCellViewsInArea(p).map(u=>u.cell);this.reset(b,{batch:!0}),this.hideRubberband();break}case"translating":{const n=e.snapToGrid(t.clientX,t.clientY);if(!this.options.following){const a=i;this.updateSelectedNodesPosition({dx:a.clientX-a.originX,dy:a.clientY-a.originY})}this.graph.model.stopBatch("move-selection"),this.notifyBoxEvent("box:mouseup",t,n.x,n.y);break}default:{this.clean();break}}}onMouseUp(t){this.getEventData(t).action&&(this.stopSelecting(t),this.undelegateDocumentEvents())}onSelectionBoxMouseDown(t){this.options.following||t.stopPropagation();const e=this.normalizeEvent(t);this.options.movable&&this.startTranslating(e);const i=this.getCellViewFromElem(e.target);this.setEventData(e,{activeView:i});const o=this.graph.snapToGrid(e.clientX,e.clientY);this.notifyBoxEvent("box:mousedown",e,o.x,o.y),this.delegateDocumentEvents(j.documentEvents,e.data)}startTranslating(t){this.graph.model.startBatch("move-selection");const e=this.graph.snapToGrid(t.clientX,t.clientY);this.setEventData(t,{action:"translating",clientX:e.x,clientY:e.y,originX:e.x,originY:e.y})}getRestrictArea(){const t=this.graph.options.translating.restrict,e=typeof t=="function"?r.FunctionExt.call(t,this.graph,null):t;return typeof e=="number"?this.graph.transform.getGraphArea().inflate(e):e===!0?this.graph.transform.getGraphArea():e||null}getSelectionOffset(t,e){let i=t.x-e.clientX,o=t.y-e.clientY;const n=this.getRestrictArea();if(n){const a=this.collection.toArray(),l=r.Cell.getCellsBBox(a,{deep:!0})||r.Rectangle.create(),c=n.x-l.x,h=n.y-l.y,p=n.x+n.width-(l.x+l.width),b=n.y+n.height-(l.y+l.height);if(i<c&&(i=c),o<h&&(o=h),p<i&&(i=p),b<o&&(o=b),!this.options.following){const u=t.x-e.originX,f=t.y-e.originY;i=u<=c||u>=p?0:i,o=f<=h||f>=b?0:o}}return{dx:i,dy:o}}updateElementPosition(t,e,i){const o=r.Dom.css(t,"left"),n=r.Dom.css(t,"top"),a=o?parseFloat(o):0,l=n?parseFloat(n):0;r.Dom.css(t,"left",a+e),r.Dom.css(t,"top",l+i)}updateSelectedNodesPosition(t){const{dx:e,dy:i}=t;if(e||i)if(this.translateSelectedNodes(e,i),this.boxesUpdated)this.collection.length>1&&this.updateSelectionBoxes();else{const o=this.graph.transform.getScale();for(let n=0,a=this.$boxes,l=a.length;n<l;n+=1)this.updateElementPosition(a[n],e*o.sx,i*o.sy);this.updateElementPosition(this.selectionContainer,e*o.sx,i*o.sy)}}autoScrollGraph(t,e){const i=this.graph.getPlugin("scroller");return i?i.autoScroll(t,e):{scrollerX:0,scrollerY:0}}adjustSelection(t){const e=this.normalizeEvent(t),i=this.getEventData(e);switch(i.action){case"selecting":{const n=i;n.moving!==!0&&(r.Dom.appendTo(this.container,this.graph.container),this.showRubberband(),n.moving=!0);const{scrollerX:a,scrollerY:l}=this.autoScrollGraph(e.clientX,e.clientY);n.scrollerX+=a,n.scrollerY+=l;const c=e.clientX-n.clientX+n.scrollerX,h=e.clientY-n.clientY+n.scrollerY,p=parseInt(r.Dom.css(this.container,"left")||"0",10),b=parseInt(r.Dom.css(this.container,"top")||"0",10);r.Dom.css(this.container,{left:c<0?n.offsetX+c:p,top:h<0?n.offsetY+h:b,width:Math.abs(c),height:Math.abs(h)});break}case"translating":{const n=this.graph.snapToGrid(e.clientX,e.clientY),a=i,l=this.getSelectionOffset(n,a);this.options.following?this.updateSelectedNodesPosition(l):this.updateContainerPosition(l),l.dx&&(a.clientX=n.x),l.dy&&(a.clientY=n.y),this.notifyBoxEvent("box:mousemove",t,n.x,n.y);break}}this.boxesUpdated=!1}translateSelectedNodes(t,e,i,o){const n={},a=[];if(i&&(n[i.id]=!0),this.collection.toArray().forEach(l=>{l.getDescendants({deep:!0}).forEach(c=>{n[c.id]=!0})}),o&&o.translateBy){const l=this.graph.getCellById(o.translateBy);l&&(n[l.id]=!0,l.getDescendants({deep:!0}).forEach(c=>{n[c.id]=!0}),a.push(l))}this.collection.toArray().forEach(l=>{if(!n[l.id]){const c=Object.assign(Object.assign({},o),{selection:this.cid,exclude:a});l.translate(t,e,c),this.graph.model.getConnectedEdges(l).forEach(h=>{n[h.id]||(h.translate(t,e,c),n[h.id]=!0)})}})}getCellViewsInArea(t){const e=this.graph,i={strict:this.options.strict};let o=[];return this.options.rubberNode&&(o=o.concat(e.model.getNodesInArea(t,i).map(n=>e.renderer.findViewByCell(n)).filter(n=>n!=null))),this.options.rubberEdge&&(o=o.concat(e.model.getEdgesInArea(t,i).map(n=>e.renderer.findViewByCell(n)).filter(n=>n!=null))),o}notifyBoxEvent(t,e,i,o){const a=this.getEventData(e).activeView;this.trigger(t,{e,view:a,x:i,y:o,cell:a.cell})}getSelectedClassName(t){return this.prefixClassName(`${t.isNode()?"node":"edge"}-selected`)}addCellSelectedClassName(t){const e=this.graph.renderer.findViewByCell(t);e&&e.addClass(this.getSelectedClassName(t))}removeCellUnSelectedClassName(t){const e=this.graph.renderer.findViewByCell(t);e&&e.removeClass(this.getSelectedClassName(t))}destroySelectionBox(t){this.removeCellUnSelectedClassName(t),this.canShowSelectionBox(t)&&(r.Dom.remove(this.container.querySelector(`[data-cell-id="${t.id}"]`)),this.$boxes.length===0&&this.hide(),this.boxCount=Math.max(0,this.boxCount-1))}destroyAllSelectionBoxes(t){t.forEach(e=>this.removeCellUnSelectedClassName(e)),this.hide(),r.Dom.remove(this.$boxes),this.boxCount=0}hide(){r.Dom.removeClass(this.container,this.prefixClassName(j.classNames.rubberband)),r.Dom.removeClass(this.container,this.prefixClassName(j.classNames.selected))}showRubberband(){r.Dom.addClass(this.container,this.prefixClassName(j.classNames.rubberband))}hideRubberband(){r.Dom.removeClass(this.container,this.prefixClassName(j.classNames.rubberband))}showSelected(){r.Dom.removeAttribute(this.container,"style"),r.Dom.addClass(this.container,this.prefixClassName(j.classNames.selected))}createContainer(){this.container=document.createElement("div"),r.Dom.addClass(this.container,this.prefixClassName(j.classNames.root)),this.options.className&&r.Dom.addClass(this.container,this.options.className),this.selectionContainer=document.createElement("div"),r.Dom.addClass(this.selectionContainer,this.prefixClassName(j.classNames.inner)),this.selectionContent=document.createElement("div"),r.Dom.addClass(this.selectionContent,this.prefixClassName(j.classNames.content)),r.Dom.append(this.selectionContainer,this.selectionContent),r.Dom.attr(this.selectionContainer,"data-selection-length",this.collection.length),r.Dom.prepend(this.container,this.selectionContainer)}updateContainerPosition(t){(t.dx||t.dy)&&this.updateElementPosition(this.selectionContainer,t.dx,t.dy)}updateContainer(){const t={x:1/0,y:1/0},e={x:0,y:0};this.collection.toArray().filter(n=>this.canShowSelectionBox(n)).forEach(n=>{const a=this.graph.renderer.findViewByCell(n);if(a){const l=a.getBBox({useCellGeometry:!0});t.x=Math.min(t.x,l.x),t.y=Math.min(t.y,l.y),e.x=Math.max(e.x,l.x+l.width),e.y=Math.max(e.y,l.y+l.height)}}),r.Dom.css(this.selectionContainer,{position:"absolute",pointerEvents:"none",left:t.x,top:t.y,width:e.x-t.x,height:e.y-t.y}),r.Dom.attr(this.selectionContainer,"data-selection-length",this.collection.length);const o=this.options.content;if(o)if(typeof o=="function"){const n=r.FunctionExt.call(o,this.graph,this,this.selectionContent);n&&(this.selectionContent.innerHTML=n)}else this.selectionContent.innerHTML=o;this.collection.length>0&&!this.container.parentNode?r.Dom.appendTo(this.container,this.graph.container):this.collection.length<=0&&this.container.parentNode&&this.container.parentNode.removeChild(this.container)}canShowSelectionBox(t){return t.isNode()&&this.options.showNodeSelectionBox===!0||t.isEdge()&&this.options.showEdgeSelectionBox===!0}getPointerEventsValue(t){return typeof t=="string"?t:t(this.cells)}createSelectionBox(t){if(this.addCellSelectedClassName(t),this.canShowSelectionBox(t)){const e=this.graph.renderer.findViewByCell(t);if(e){const i=e.getBBox({useCellGeometry:!0}),o=this.boxClassName,n=document.createElement("div"),a=this.options.pointerEvents;r.Dom.addClass(n,o),r.Dom.addClass(n,`${o}-${t.isNode()?"node":"edge"}`),r.Dom.attr(n,"data-cell-id",t.id),r.Dom.css(n,{position:"absolute",left:i.x,top:i.y,width:i.width,height:i.height,pointerEvents:a?this.getPointerEventsValue(a):"auto"}),r.Dom.appendTo(n,this.container),this.showSelected(),this.boxCount+=1}}}updateSelectionBoxes(){this.collection.length>0&&(this.boxesUpdated=!0,this.confirmUpdate())}confirmUpdate(){if(this.boxCount){this.hide();for(let t=0,e=this.$boxes,i=e.length;t<i;t+=1){const o=e[t],n=r.Dom.attr(o,"data-cell-id");r.Dom.remove(o),this.boxCount-=1;const a=this.collection.get(n);a&&this.createSelectionBox(a)}this.updateContainer()}return 0}getCellViewFromElem(t){const e=t.getAttribute("data-cell-id");if(e){const i=this.collection.get(e);if(i)return this.graph.renderer.findViewByCell(i)}return null}onCellRemoved({cell:t}){this.destroySelectionBox(t),this.updateContainer()}onReseted({previous:t,current:e}){this.destroyAllSelectionBoxes(t),e.forEach(i=>{this.listenCellRemoveEvent(i),this.createSelectionBox(i)}),this.updateContainer()}onCellAdded({cell:t}){this.listenCellRemoveEvent(t),this.createSelectionBox(t),this.updateContainer()}listenCellRemoveEvent(t){t.off("removed",this.onCellRemoved,this),t.on("removed",this.onCellRemoved,this)}onCollectionUpdated({added:t,removed:e,options:i}){t.forEach(n=>{this.trigger("cell:selected",{cell:n,options:i}),n.isNode()?this.trigger("node:selected",{cell:n,options:i,node:n}):n.isEdge()&&this.trigger("edge:selected",{cell:n,options:i,edge:n})}),e.forEach(n=>{this.trigger("cell:unselected",{cell:n,options:i}),n.isNode()?this.trigger("node:unselected",{cell:n,options:i,node:n}):n.isEdge()&&this.trigger("edge:unselected",{cell:n,options:i,edge:n})});const o={added:t,removed:e,options:i,selected:this.cells.filter(n=>!!this.graph.getCellById(n.id))};this.trigger("selection:changed",o)}dispose(){this.clean(),this.remove(),this.off()}}Ot([r.View.dispose()],ut.prototype,"dispose",null);var j;(function(s){const t="widget-selection";s.classNames={root:t,inner:`${t}-inner`,box:`${t}-box`,content:`${t}-content`,rubberband:`${t}-rubberband`,selected:`${t}-selected`},s.documentEvents={mousemove:"adjustSelection",touchmove:"adjustSelection",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"};function e(i){return i.getAncestors().length}s.depthComparator=e})(j||(j={}));const Nt=`.x6-widget-selection {
  position: absolute;
  top: 0;
  left: 0;
  display: none;
  width: 0;
  height: 0;
  touch-action: none;
}
.x6-widget-selection-rubberband {
  display: block;
  overflow: visible;
  opacity: 0.3;
}
.x6-widget-selection-selected {
  display: block;
}
.x6-widget-selection-box {
  cursor: move;
}
.x6-widget-selection-inner[data-selection-length='0'],
.x6-widget-selection-inner[data-selection-length='1'] {
  display: none;
}
.x6-widget-selection-content {
  position: absolute;
  top: 100%;
  right: -20px;
  left: -20px;
  margin-top: 30px;
  padding: 6px;
  line-height: 14px;
  text-align: center;
  border-radius: 6px;
}
.x6-widget-selection-content:empty {
  display: none;
}
.x6-widget-selection-rubberband {
  background-color: #3498db;
  border: 2px solid #2980b9;
}
.x6-widget-selection-box {
  box-sizing: content-box !important;
  margin-top: -4px;
  margin-left: -4px;
  padding-right: 4px;
  padding-bottom: 4px;
  border: 2px dashed #feb663;
  box-shadow: 2px 2px 5px #d3d3d3;
}
.x6-widget-selection-inner {
  box-sizing: content-box !important;
  margin-top: -8px;
  margin-left: -8px;
  padding-right: 12px;
  padding-bottom: 12px;
  border: 2px solid #feb663;
  box-shadow: 2px 2px 5px #d3d3d3;
}
.x6-widget-selection-content {
  color: #fff;
  font-size: 10px;
  background-color: #6a6b8a;
}
`;r.Graph.prototype.isSelectionEnabled=function(){const s=this.getPlugin("selection");return s?s.isEnabled():!1};r.Graph.prototype.enableSelection=function(){const s=this.getPlugin("selection");return s&&s.enable(),this};r.Graph.prototype.disableSelection=function(){const s=this.getPlugin("selection");return s&&s.disable(),this};r.Graph.prototype.toggleSelection=function(s){const t=this.getPlugin("selection");return t&&t.toggleEnabled(s),this};r.Graph.prototype.isMultipleSelection=function(){const s=this.getPlugin("selection");return s?s.isMultipleSelection():!1};r.Graph.prototype.enableMultipleSelection=function(){const s=this.getPlugin("selection");return s&&s.enableMultipleSelection(),this};r.Graph.prototype.disableMultipleSelection=function(){const s=this.getPlugin("selection");return s&&s.disableMultipleSelection(),this};r.Graph.prototype.toggleMultipleSelection=function(s){const t=this.getPlugin("selection");return t&&t.toggleMultipleSelection(s),this};r.Graph.prototype.isSelectionMovable=function(){const s=this.getPlugin("selection");return s?s.isSelectionMovable():!1};r.Graph.prototype.enableSelectionMovable=function(){const s=this.getPlugin("selection");return s&&s.enableSelectionMovable(),this};r.Graph.prototype.disableSelectionMovable=function(){const s=this.getPlugin("selection");return s&&s.disableSelectionMovable(),this};r.Graph.prototype.toggleSelectionMovable=function(s){const t=this.getPlugin("selection");return t&&t.toggleSelectionMovable(s),this};r.Graph.prototype.isRubberbandEnabled=function(){const s=this.getPlugin("selection");return s?s.isRubberbandEnabled():!1};r.Graph.prototype.enableRubberband=function(){const s=this.getPlugin("selection");return s&&s.enableRubberband(),this};r.Graph.prototype.disableRubberband=function(){const s=this.getPlugin("selection");return s&&s.disableRubberband(),this};r.Graph.prototype.toggleRubberband=function(s){const t=this.getPlugin("selection");return t&&t.toggleRubberband(s),this};r.Graph.prototype.isStrictRubberband=function(){const s=this.getPlugin("selection");return s?s.isStrictRubberband():!1};r.Graph.prototype.enableStrictRubberband=function(){const s=this.getPlugin("selection");return s&&s.enableStrictRubberband(),this};r.Graph.prototype.disableStrictRubberband=function(){const s=this.getPlugin("selection");return s&&s.disableStrictRubberband(),this};r.Graph.prototype.toggleStrictRubberband=function(s){const t=this.getPlugin("selection");return t&&t.toggleStrictRubberband(s),this};r.Graph.prototype.setRubberbandModifiers=function(s){const t=this.getPlugin("selection");return t&&t.setRubberbandModifiers(s),this};r.Graph.prototype.setSelectionFilter=function(s){const t=this.getPlugin("selection");return t&&t.setSelectionFilter(s),this};r.Graph.prototype.setSelectionDisplayContent=function(s){const t=this.getPlugin("selection");return t&&t.setSelectionDisplayContent(s),this};r.Graph.prototype.isSelectionEmpty=function(){const s=this.getPlugin("selection");return s?s.isEmpty():!0};r.Graph.prototype.cleanSelection=function(s){const t=this.getPlugin("selection");return t&&t.clean(s),this};r.Graph.prototype.resetSelection=function(s,t){const e=this.getPlugin("selection");return e&&e.reset(s,t),this};r.Graph.prototype.getSelectedCells=function(){const s=this.getPlugin("selection");return s?s.getSelectedCells():[]};r.Graph.prototype.getSelectedCellCount=function(){const s=this.getPlugin("selection");return s?s.getSelectedCellCount():0};r.Graph.prototype.isSelected=function(s){const t=this.getPlugin("selection");return t?t.isSelected(s):!1};r.Graph.prototype.select=function(s,t){const e=this.getPlugin("selection");return e&&e.select(s,t),this};r.Graph.prototype.unselect=function(s,t){const e=this.getPlugin("selection");return e&&e.unselect(s,t),this};var zt=globalThis&&globalThis.__decorate||function(s,t,e,i){var o=arguments.length,n=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(s,t,e,i);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(n=(o<3?a(n):o>3?a(t,e,n):a(t,e))||n);return o>3&&n&&Object.defineProperty(t,e,n),n};class tt extends r.Basecoat{get rubberbandDisabled(){return this.options.enabled!==!0||this.options.rubberband!==!0}get disabled(){return this.options.enabled!==!0}get length(){return this.selectionImpl.length}get cells(){return this.selectionImpl.cells}constructor(t={}){super(),this.name="selection",this.movedMap=new WeakMap,this.unselectMap=new WeakMap,this.options=Object.assign(Object.assign({enabled:!0},tt.defaultOptions),t),r.CssLoader.ensure(this.name,Nt)}init(t){this.graph=t,this.selectionImpl=new ut(Object.assign(Object.assign({},this.options),{graph:t})),this.setup(),this.startListening()}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(t){return t!=null?t!==this.isEnabled()&&(t?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}isMultipleSelection(){return this.isMultiple()}enableMultipleSelection(){return this.enableMultiple(),this}disableMultipleSelection(){return this.disableMultiple(),this}toggleMultipleSelection(t){return t!=null?t!==this.isMultipleSelection()&&(t?this.enableMultipleSelection():this.disableMultipleSelection()):this.isMultipleSelection()?this.disableMultipleSelection():this.enableMultipleSelection(),this}isSelectionMovable(){return this.options.movable!==!1}enableSelectionMovable(){return this.selectionImpl.options.movable=!0,this}disableSelectionMovable(){return this.selectionImpl.options.movable=!1,this}toggleSelectionMovable(t){return t!=null?t!==this.isSelectionMovable()&&(t?this.enableSelectionMovable():this.disableSelectionMovable()):this.isSelectionMovable()?this.disableSelectionMovable():this.enableSelectionMovable(),this}isRubberbandEnabled(){return!this.rubberbandDisabled}enableRubberband(){return this.rubberbandDisabled&&(this.options.rubberband=!0),this}disableRubberband(){return this.rubberbandDisabled||(this.options.rubberband=!1),this}toggleRubberband(t){return t!=null?t!==this.isRubberbandEnabled()&&(t?this.enableRubberband():this.disableRubberband()):this.isRubberbandEnabled()?this.disableRubberband():this.enableRubberband(),this}isStrictRubberband(){return this.selectionImpl.options.strict===!0}enableStrictRubberband(){return this.selectionImpl.options.strict=!0,this}disableStrictRubberband(){return this.selectionImpl.options.strict=!1,this}toggleStrictRubberband(t){return t!=null?t!==this.isStrictRubberband()&&(t?this.enableStrictRubberband():this.disableStrictRubberband()):this.isStrictRubberband()?this.disableStrictRubberband():this.enableStrictRubberband(),this}setRubberbandModifiers(t){this.setModifiers(t)}setSelectionFilter(t){return this.setFilter(t),this}setSelectionDisplayContent(t){return this.setContent(t),this}isEmpty(){return this.length<=0}clean(t={}){return this.selectionImpl.clean(t),this}reset(t,e={}){return this.selectionImpl.reset(t?this.getCells(t):[],e),this}getSelectedCells(){return this.cells}getSelectedCellCount(){return this.length}isSelected(t){return this.selectionImpl.isSelected(t)}select(t,e={}){const i=this.getCells(t);return i.length&&(this.isMultiple()?this.selectionImpl.select(i,e):this.reset(i.slice(0,1),e)),this}unselect(t,e={}){return this.selectionImpl.unselect(this.getCells(t),e),this}setup(){this.selectionImpl.on("*",(t,e)=>{this.trigger(t,e),this.graph.trigger(t,e)})}startListening(){this.graph.on("blank:mousedown",this.onBlankMouseDown,this),this.graph.on("blank:click",this.onBlankClick,this),this.graph.on("cell:mousemove",this.onCellMouseMove,this),this.graph.on("cell:mouseup",this.onCellMouseUp,this),this.selectionImpl.on("box:mousedown",this.onBoxMouseDown,this)}stopListening(){this.graph.off("blank:mousedown",this.onBlankMouseDown,this),this.graph.off("blank:click",this.onBlankClick,this),this.graph.off("cell:mousemove",this.onCellMouseMove,this),this.graph.off("cell:mouseup",this.onCellMouseUp,this),this.selectionImpl.off("box:mousedown",this.onBoxMouseDown,this)}onBlankMouseDown({e:t}){if(!this.allowBlankMouseDown(t))return;const e=this.graph.panning.allowPanning(t,!0),i=this.graph.getPlugin("scroller"),o=i&&i.allowPanning(t,!0);(this.allowRubberband(t,!0)||this.allowRubberband(t)&&!o&&!e)&&this.startRubberband(t)}allowBlankMouseDown(t){const e=this.options.eventTypes;return(e==null?void 0:e.includes("leftMouseDown"))&&t.button===0||(e==null?void 0:e.includes("mouseWheelDown"))&&t.button===1}onBlankClick(){this.clean()}allowRubberband(t,e){return!this.rubberbandDisabled&&r.ModifierKey.isMatch(t,this.options.modifiers,e)}allowMultipleSelection(t){return this.isMultiple()&&r.ModifierKey.isMatch(t,this.options.multipleSelectionModifiers)}onCellMouseMove({cell:t}){this.movedMap.set(t,!0)}onCellMouseUp({e:t,cell:e}){const i=this.options;let o=this.disabled;!o&&this.movedMap.has(e)&&(o=i.selectCellOnMoved===!1,o||(o=i.selectNodeOnMoved===!1&&e.isNode()),o||(o=i.selectEdgeOnMoved===!1&&e.isEdge())),o||(this.allowMultipleSelection(t)?this.unselectMap.has(e)?this.unselectMap.delete(e):this.isSelected(e)?this.unselect(e):this.select(e):this.reset(e)),this.movedMap.delete(e)}onBoxMouseDown({e:t,cell:e}){this.disabled||this.allowMultipleSelection(t)&&(this.unselect(e),this.unselectMap.set(e,!0))}getCells(t){return(Array.isArray(t)?t:[t]).map(e=>typeof e=="string"?this.graph.getCellById(e):e).filter(e=>e!=null)}startRubberband(t){return this.rubberbandDisabled||this.selectionImpl.startSelecting(t),this}isMultiple(){return this.options.multiple!==!1}enableMultiple(){return this.options.multiple=!0,this}disableMultiple(){return this.options.multiple=!1,this}setModifiers(t){return this.options.modifiers=t,this}setContent(t){return this.selectionImpl.setContent(t),this}setFilter(t){return this.selectionImpl.setFilter(t),this}dispose(){this.stopListening(),this.off(),this.selectionImpl.dispose(),r.CssLoader.clean(this.name)}}zt([r.Basecoat.dispose()],tt.prototype,"dispose",null);(function(s){s.defaultOptions={rubberband:!1,rubberNode:!0,rubberEdge:!1,pointerEvents:"auto",multiple:!0,multipleSelectionModifiers:["ctrl","meta"],movable:!0,strict:!1,selectCellOnMoved:!1,selectNodeOnMoved:!1,selectEdgeOnMoved:!1,following:!0,content:null,eventTypes:["leftMouseDown","mouseWheelDown"]}})(tt||(tt={}));var Gt=globalThis&&globalThis.__decorate||function(s,t,e,i){var o=arguments.length,n=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(s,t,e,i);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(n=(o<3?a(n):o>3?a(t,e,n):a(t,e))||n);return o>3&&n&&Object.defineProperty(t,e,n),n},kt=globalThis&&globalThis.__rest||function(s,t){var e={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,i=Object.getOwnPropertySymbols(s);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(s,i[o])&&(e[i[o]]=s[i[o]]);return e};class gt extends r.View{get model(){return this.graph.model}get containerClassName(){return this.prefixClassName("widget-snapline")}get verticalClassName(){return`${this.containerClassName}-vertical`}get horizontalClassName(){return`${this.containerClassName}-horizontal`}constructor(t){super();const{graph:e}=t,i=kt(t,["graph"]);this.graph=e,this.options=Object.assign({},i),this.offset={x:0,y:0},this.render(),this.disabled||this.startListening()}get disabled(){return this.options.enabled!==!0}enable(){this.disabled&&(this.options.enabled=!0,this.startListening())}disable(){this.disabled||(this.options.enabled=!1,this.stopListening())}setFilter(t){this.options.filter=t}render(){const t=this.containerWrapper=new r.Vector("svg"),e=this.horizontal=new r.Vector("line"),i=this.vertical=new r.Vector("line");t.addClass(this.containerClassName),e.addClass(this.horizontalClassName),i.addClass(this.verticalClassName),t.setAttribute("width","100%"),t.setAttribute("height","100%"),e.setAttribute("display","none"),i.setAttribute("display","none"),t.append([e,i]),this.options.className&&t.addClass(this.options.className),this.container=this.containerWrapper.node}startListening(){this.stopListening(),this.graph.on("node:mousedown",this.captureCursorOffset,this),this.graph.on("node:mousemove",this.snapOnMoving,this),this.model.on("batch:stop",this.onBatchStop,this),this.delegateDocumentEvents({mouseup:"hide",touchend:"hide"})}stopListening(){this.graph.off("node:mousedown",this.captureCursorOffset,this),this.graph.off("node:mousemove",this.snapOnMoving,this),this.model.off("batch:stop",this.onBatchStop,this),this.undelegateDocumentEvents()}onBatchStop({name:t,data:e}){t==="resize"&&this.snapOnResizing(e.cell,e)}captureCursorOffset({view:t,x:e,y:i}){const o=t.getDelegatedView();if(o&&this.isNodeMovable(o)){const n=t.cell.getPosition();this.offset={x:e-n.x,y:i-n.y}}}isNodeMovable(t){return t&&t.cell.isNode()&&t.can("nodeMovable")}getRestrictArea(t){const e=this.graph.options.translating.restrict,i=typeof e=="function"?r.FunctionExt.call(e,this.graph,t):e;return typeof i=="number"?this.graph.transform.getGraphArea().inflate(i):i===!0?this.graph.transform.getGraphArea():i||null}snapOnResizing(t,e){if(this.options.resizing&&!e.snapped&&e.ui&&e.direction&&e.trueDirection){const i=this.graph.renderer.findViewByCell(t);if(i&&i.cell.isNode()){const o=t.getBBox(),n=o.bbox(t.getAngle()),a=n.getTopLeft(),l=n.getBottomRight(),c=r.Angle.normalize(t.getAngle()),h=this.options.tolerance||0;let p,b,u,f,w,m;const x={vertical:0,horizontal:0},I=e.direction,E=e.trueDirection,O=e.relativeDirection;E.indexOf("right")!==-1?x.vertical=l.x:x.vertical=a.x,E.indexOf("bottom")!==-1?x.horizontal=l.y:x.horizontal=a.y,this.model.getNodes().some(M=>{if(this.isIgnored(t,M))return!1;const _=M.getBBox().bbox(M.getAngle()),F=_.getTopLeft(),K=_.getBottomRight(),X={vertical:[F.x,K.x],horizontal:[F.y,K.y]},W={};return Object.keys(X).forEach(rt=>{const it=rt,ot=X[it].map(C=>({position:C,distance:Math.abs(C-x[it])})).filter(C=>C.distance<=h);W[it]=r.ArrayExt.sortBy(ot,C=>C.distance)}),p==null&&W.vertical.length>0&&(p=W.vertical[0].position,b=Math.min(n.y,_.y),u=Math.max(l.y,K.y)-b),f==null&&W.horizontal.length>0&&(f=W.horizontal[0].position,w=Math.min(n.x,_.x),m=Math.max(l.x,K.x)-w),p!=null&&f!=null}),this.hide();let S=0,k=0;(f!=null||p!=null)&&(p!=null&&(S=E.indexOf("right")!==-1?p-l.x:a.x-p),f!=null&&(k=E.indexOf("bottom")!==-1?f-l.y:a.y-f));let D=0,d=0;if(c%90===0)c===90||c===270?(D=k,d=S):(D=S,d=k);else{const M=c>=0&&c<90?1:c>=90&&c<180?4:c>=180&&c<270?3:2;f!=null&&p!=null&&(S<k?(k=0,f=void 0):(S=0,p=void 0));const _=r.Angle.toRad(c%90);S&&(D=M===3?S/Math.cos(_):S/Math.sin(_)),k&&(d=M===3?k/Math.cos(_):k/Math.sin(_));const F=M===1||M===3;switch(O){case"top":case"bottom":d=k?k/(F?Math.cos(_):Math.sin(_)):S/(F?Math.sin(_):Math.cos(_));break;case"left":case"right":D=S?S/(F?Math.cos(_):Math.sin(_)):k/(F?Math.sin(_):Math.cos(_));break}}switch(O){case"top":case"bottom":D=0;break;case"left":case"right":d=0;break}const g=this.graph.getGridSize();let y=Math.max(o.width+D,g),v=Math.max(o.height+d,g);e.minWidth&&e.minWidth>g&&(y=Math.max(y,e.minWidth)),e.minHeight&&e.minHeight>g&&(v=Math.max(v,e.minHeight)),e.maxWidth&&(y=Math.min(y,e.maxWidth)),e.maxHeight&&(v=Math.min(v,e.maxHeight)),e.preserveAspectRatio&&(d<D?v=y*(o.height/o.width):y=v*(o.width/o.height)),(y!==o.width||v!==o.height)&&(t.resize(y,v,{direction:I,relativeDirection:O,trueDirection:E,snapped:!0,snaplines:this.cid,restrict:this.getRestrictArea(i)}),u&&(u+=v-o.height),m&&(m+=y-o.width));const N=t.getBBox().bbox(c);p&&Math.abs(N.x-p)>1&&Math.abs(N.width+N.x-p)>1&&(p=void 0),f&&Math.abs(N.y-f)>1&&Math.abs(N.height+N.y-f)>1&&(f=void 0),this.update({verticalLeft:p,verticalTop:b,verticalHeight:u,horizontalTop:f,horizontalLeft:w,horizontalWidth:m})}}}snapOnMoving({view:t,e,x:i,y:o}){const n=t.getEventData(e).delegatedView||t;if(!this.isNodeMovable(n))return;const a=n.cell,l=a.getSize(),c=a.getPosition(),h=new r.Rectangle(i-this.offset.x,o-this.offset.y,l.width,l.height),p=a.getAngle(),b=h.getCenter(),u=h.bbox(p),f=u.getTopLeft(),w=u.getBottomRight(),m=this.options.tolerance||0;let x,I,E,O,S,k,D=0,d=0;if(this.model.getNodes().some(g=>{if(this.isIgnored(a,g))return!1;const y=g.getBBox().bbox(g.getAngle()),v=y.getCenter(),N=y.getTopLeft(),M=y.getBottomRight();return x==null&&(Math.abs(v.x-b.x)<m?(x=v.x,D=.5):Math.abs(N.x-f.x)<m?(x=N.x,D=0):Math.abs(N.x-w.x)<m?(x=N.x,D=1):Math.abs(M.x-w.x)<m?(x=M.x,D=1):Math.abs(M.x-f.x)<m&&(x=M.x),x!=null&&(I=Math.min(u.y,y.y),E=Math.max(w.y,M.y)-I)),O==null&&(Math.abs(v.y-b.y)<m?(O=v.y,d=.5):Math.abs(N.y-f.y)<m?O=N.y:Math.abs(N.y-w.y)<m?(O=N.y,d=1):Math.abs(M.y-w.y)<m?(O=M.y,d=1):Math.abs(M.y-f.y)<m&&(O=M.y),O!=null&&(S=Math.min(u.x,y.x),k=Math.max(w.x,M.x)-S)),x!=null&&O!=null}),this.hide(),O!=null||x!=null){O!=null&&(u.y=O-d*u.height),x!=null&&(u.x=x-D*u.width);const g=u.getCenter(),y=g.x-h.width/2,v=g.y-h.height/2,N=y-c.x,M=v-c.y;(N!==0||M!==0)&&(a.translate(N,M,{snapped:!0,restrict:this.getRestrictArea(n)}),k&&(k+=N),E&&(E+=M)),this.update({verticalLeft:x,verticalTop:I,verticalHeight:E,horizontalTop:O,horizontalLeft:S,horizontalWidth:k})}}isIgnored(t,e){return e.id===t.id||e.isDescendantOf(t)||!this.filter(e)}filter(t){const e=this.options.filter;return Array.isArray(e)?e.some(i=>typeof i=="string"?t.shape===i:t.id===i.id):typeof e=="function"?r.FunctionExt.call(e,this.graph,t):!0}update(t){if(t.horizontalTop){const e=this.graph.localToGraph(new r.Point(t.horizontalLeft,t.horizontalTop)),i=this.graph.localToGraph(new r.Point(t.horizontalLeft+t.horizontalWidth,t.horizontalTop));this.horizontal.setAttributes({x1:this.options.sharp?`${e.x}`:"0",y1:`${e.y}`,x2:this.options.sharp?`${i.x}`:"100%",y2:`${i.y}`,display:"inherit"})}else this.horizontal.setAttribute("display","none");if(t.verticalLeft){const e=this.graph.localToGraph(new r.Point(t.verticalLeft,t.verticalTop)),i=this.graph.localToGraph(new r.Point(t.verticalLeft,t.verticalTop+t.verticalHeight));this.vertical.setAttributes({x1:`${e.x}`,y1:this.options.sharp?`${e.y}`:"0",x2:`${i.x}`,y2:this.options.sharp?`${i.y}`:"100%",display:"inherit"})}else this.vertical.setAttribute("display","none");this.show()}resetTimer(){this.timer&&(clearTimeout(this.timer),this.timer=null)}show(){return this.resetTimer(),this.container.parentNode==null&&this.graph.container.appendChild(this.container),this}hide(){this.resetTimer(),this.vertical.setAttribute("display","none"),this.horizontal.setAttribute("display","none");const t=this.options.clean,e=typeof t=="number"?t:t!==!1?3e3:0;return e>0&&(this.timer=window.setTimeout(()=>{this.container.parentNode!==null&&this.unmount()},e)),this}onRemove(){this.stopListening(),this.hide()}dispose(){this.remove()}}Gt([r.View.dispose()],gt.prototype,"dispose",null);const Pt=`.x6-widget-snapline {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  pointer-events: none;
}
.x6-widget-snapline-vertical,
.x6-widget-snapline-horizontal {
  stroke: #2ecc71;
  stroke-width: 1px;
}
`;r.Graph.prototype.isSnaplineEnabled=function(){const s=this.getPlugin("snapline");return s?s.isEnabled():!1};r.Graph.prototype.enableSnapline=function(){const s=this.getPlugin("snapline");return s&&s.enable(),this};r.Graph.prototype.disableSnapline=function(){const s=this.getPlugin("snapline");return s&&s.disable(),this};r.Graph.prototype.toggleSnapline=function(){const s=this.getPlugin("snapline");return s&&s.toggleEnabled(),this};r.Graph.prototype.hideSnapline=function(){const s=this.getPlugin("snapline");return s&&s.hide(),this};r.Graph.prototype.setSnaplineFilter=function(s){const t=this.getPlugin("snapline");return t&&t.setFilter(s),this};r.Graph.prototype.isSnaplineOnResizingEnabled=function(){const s=this.getPlugin("snapline");return s?s.isOnResizingEnabled():!1};r.Graph.prototype.enableSnaplineOnResizing=function(){const s=this.getPlugin("snapline");return s&&s.enableOnResizing(),this};r.Graph.prototype.disableSnaplineOnResizing=function(){const s=this.getPlugin("snapline");return s&&s.disableOnResizing(),this};r.Graph.prototype.toggleSnaplineOnResizing=function(s){const t=this.getPlugin("snapline");return t&&t.toggleOnResizing(s),this};r.Graph.prototype.isSharpSnapline=function(){const s=this.getPlugin("snapline");return s?s.isSharp():!1};r.Graph.prototype.enableSharpSnapline=function(){const s=this.getPlugin("snapline");return s&&s.enableSharp(),this};r.Graph.prototype.disableSharpSnapline=function(){const s=this.getPlugin("snapline");return s&&s.disableSharp(),this};r.Graph.prototype.toggleSharpSnapline=function(s){const t=this.getPlugin("snapline");return t&&t.toggleSharp(s),this};r.Graph.prototype.getSnaplineTolerance=function(){const s=this.getPlugin("snapline");if(s)return s.getTolerance()};r.Graph.prototype.setSnaplineTolerance=function(s){const t=this.getPlugin("snapline");return t&&t.setTolerance(s),this};var Rt=globalThis&&globalThis.__decorate||function(s,t,e,i){var o=arguments.length,n=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(s,t,e,i);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(n=(o<3?a(n):o>3?a(t,e,n):a(t,e))||n);return o>3&&n&&Object.defineProperty(t,e,n),n};class ft extends r.Disposable{constructor(t={}){super(),this.name="snapline",this.options=Object.assign({enabled:!0,tolerance:10},t),r.CssLoader.ensure(this.name,Pt)}init(t){this.snaplineImpl=new gt(Object.assign(Object.assign({},this.options),{graph:t}))}isEnabled(){return!this.snaplineImpl.disabled}enable(){this.snaplineImpl.enable()}disable(){this.snaplineImpl.disable()}toggleEnabled(t){if(t!=null)t!==this.isEnabled()&&(t?this.enable():this.disable());else return this.isEnabled()?this.disable():this.enable(),this}hide(){return this.snaplineImpl.hide(),this}setFilter(t){return this.snaplineImpl.setFilter(t),this}isOnResizingEnabled(){return this.snaplineImpl.options.resizing===!0}enableOnResizing(){return this.snaplineImpl.options.resizing=!0,this}disableOnResizing(){return this.snaplineImpl.options.resizing=!1,this}toggleOnResizing(t){return t!=null?t!==this.isOnResizingEnabled()&&(t?this.enableOnResizing():this.disableOnResizing()):this.isOnResizingEnabled()?this.disableOnResizing():this.enableOnResizing(),this}isSharp(){return this.snaplineImpl.options.sharp===!0}enableSharp(){return this.snaplineImpl.options.sharp=!0,this}disableSharp(){return this.snaplineImpl.options.sharp=!1,this}toggleSharp(t){return t!=null?t!==this.isSharp()&&(t?this.enableSharp():this.disableSharp()):this.isSharp()?this.disableSharp():this.enableSharp(),this}getTolerance(){return this.snaplineImpl.options.tolerance}setTolerance(t){return this.snaplineImpl.options.tolerance=t,this}captureCursorOffset(t){this.snaplineImpl.captureCursorOffset(t)}snapOnMoving(t){this.snaplineImpl.snapOnMoving(t)}dispose(){this.snaplineImpl.dispose(),r.CssLoader.clean(this.name)}}Rt([r.Disposable.dispose()],ft.prototype,"dispose",null);const _t=`.x6-widget-dnd {
  position: absolute;
  top: -10000px;
  left: -10000px;
  z-index: 999999;
  display: none;
  cursor: move;
  opacity: 0.7;
  pointer-events: 'cursor';
}
.x6-widget-dnd.dragging {
  display: inline-block;
}
.x6-widget-dnd.dragging * {
  pointer-events: none !important;
}
.x6-widget-dnd .x6-graph {
  background: transparent;
  box-shadow: none;
}
`;var It=globalThis&&globalThis.__decorate||function(s,t,e,i){var o=arguments.length,n=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(s,t,e,i);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(n=(o<3?a(n):o>3?a(t,e,n):a(t,e))||n);return o>3&&n&&Object.defineProperty(t,e,n),n};class J extends r.View{get targetScroller(){return this.options.target.getPlugin("scroller")}get targetGraph(){return this.options.target}get targetModel(){return this.targetGraph.model}get snapline(){return this.options.target.getPlugin("snapline")}constructor(t){super(),this.name="dnd",this.options=Object.assign(Object.assign({},J.defaults),t),this.init()}init(){r.CssLoader.ensure(this.name,_t),this.container=document.createElement("div"),r.Dom.addClass(this.container,this.prefixClassName("widget-dnd")),this.draggingGraph=new r.Graph(Object.assign(Object.assign({},this.options.delegateGraphOptions),{container:document.createElement("div"),width:1,height:1,async:!1})),r.Dom.append(this.container,this.draggingGraph.container)}start(t,e){const i=e;i.preventDefault(),this.targetModel.startBatch("dnd"),r.Dom.addClass(this.container,"dragging"),r.Dom.appendTo(this.container,this.options.draggingContainer||document.body),this.sourceNode=t,this.prepareDragging(t,i.clientX,i.clientY);const o=this.updateNodePosition(i.clientX,i.clientY);this.isSnaplineEnabled()&&(this.snapline.captureCursorOffset({e:i,node:t,cell:t,view:this.draggingView,x:o.x,y:o.y}),this.draggingNode.on("change:position",this.snap,this)),this.delegateDocumentEvents(J.documentEvents,i.data)}isSnaplineEnabled(){return this.snapline&&this.snapline.isEnabled()}prepareDragging(t,e,i){const o=this.draggingGraph,n=o.model,a=this.options.getDragNode(t,{sourceNode:t,draggingGraph:o,targetGraph:this.targetGraph});a.position(0,0);let l=5;if(this.isSnaplineEnabled()&&(l+=this.snapline.options.tolerance||0),this.isSnaplineEnabled()||this.options.scaled){const p=this.targetGraph.transform.getScale();o.scale(p.sx,p.sy),l*=Math.max(p.sx,p.sy)}else o.scale(1,1);this.clearDragging(),n.resetCells([a]);const c=o.findViewByCell(a);c.undelegateEvents(),c.cell.off("changed"),o.fitToContent({padding:l,allowNewOrigin:"any",useCellGeometry:!1});const h=c.getBBox();this.geometryBBox=c.getBBox({useCellGeometry:!0}),this.delta=this.geometryBBox.getTopLeft().diff(h.getTopLeft()),this.draggingNode=a,this.draggingView=c,this.draggingBBox=a.getBBox(),this.padding=l,this.originOffset=this.updateGraphPosition(e,i)}updateGraphPosition(t,e){const i=document.body.scrollTop||document.documentElement.scrollTop,o=document.body.scrollLeft||document.documentElement.scrollLeft,n=this.delta,a=this.geometryBBox,l=this.padding||5,c={left:t-n.x-a.width/2-l+o,top:e-n.y-a.height/2-l+i};return this.draggingGraph&&r.Dom.css(this.container,{left:`${c.left}px`,top:`${c.top}px`}),c}updateNodePosition(t,e){const i=this.targetGraph.clientToLocal(t,e),o=this.draggingBBox;return i.x-=o.width/2,i.y-=o.height/2,this.draggingNode.position(i.x,i.y),i}snap({cell:t,current:e,options:i}){const o=t;if(i.snapped){const n=this.draggingBBox;o.position(n.x+i.tx,n.y+i.ty,{silent:!0}),this.draggingView.translate(),o.position(e.x,e.y,{silent:!0}),this.snapOffset={x:i.tx,y:i.ty}}else this.snapOffset=null}onDragging(t){const e=this.draggingView;if(e){t.preventDefault();const i=this.normalizeEvent(t),o=i.clientX,n=i.clientY;this.updateGraphPosition(o,n);const a=this.updateNodePosition(o,n),l=this.targetGraph.options.embedding.enabled,c=(l||this.isSnaplineEnabled())&&this.isInsideValidArea({x:o,y:n});if(l){e.setEventData(i,{graph:this.targetGraph,candidateEmbedView:this.candidateEmbedView});const h=e.getEventData(i);c?e.processEmbedding(i,h):e.clearEmbedding(h),this.candidateEmbedView=h.candidateEmbedView}this.isSnaplineEnabled()&&(c?this.snapline.snapOnMoving({e:i,view:e,x:a.x,y:a.y}):this.snapline.hide())}}onDragEnd(t){const e=this.draggingNode;if(e){const i=this.normalizeEvent(t),o=this.draggingView,n=this.draggingBBox,a=this.snapOffset;let l=n.x,c=n.y;a&&(l+=a.x,c+=a.y),e.position(l,c,{silent:!0});const h=this.drop(e,{x:i.clientX,y:i.clientY}),p=b=>{b?(this.onDropped(e),this.targetGraph.options.embedding.enabled&&o&&(o.setEventData(i,{cell:b,graph:this.targetGraph,candidateEmbedView:this.candidateEmbedView}),o.finalizeEmbedding(i,o.getEventData(i)))):this.onDropInvalid(),this.candidateEmbedView=null,this.targetModel.stopBatch("dnd")};r.FunctionExt.isAsync(h)?(this.undelegateDocumentEvents(),h.then(p)):p(h)}}clearDragging(){this.draggingNode&&(this.sourceNode=null,this.draggingNode.remove(),this.draggingNode=null,this.draggingView=null,this.delta=null,this.padding=null,this.snapOffset=null,this.originOffset=null,this.undelegateDocumentEvents())}onDropped(t){this.draggingNode===t&&(this.clearDragging(),r.Dom.removeClass(this.container,"dragging"),r.Dom.remove(this.container))}onDropInvalid(){const t=this.draggingNode;t&&this.onDropped(t)}isInsideValidArea(t){let e,i=null;const o=this.targetGraph,n=this.targetScroller;this.options.dndContainer&&(i=this.getDropArea(this.options.dndContainer));const a=i&&i.containsPoint(t);if(n)if(n.options.autoResize)e=this.getDropArea(n.container);else{const l=this.getDropArea(n.container);e=this.getDropArea(o.container).intersectsWithRect(l)}else e=this.getDropArea(o.container);return!a&&e&&e.containsPoint(t)}getDropArea(t){const e=r.Dom.offset(t),i=document.body.scrollTop||document.documentElement.scrollTop,o=document.body.scrollLeft||document.documentElement.scrollLeft;return r.Rectangle.create({x:e.left+parseInt(r.Dom.css(t,"border-left-width"),10)-o,y:e.top+parseInt(r.Dom.css(t,"border-top-width"),10)-i,width:t.clientWidth,height:t.clientHeight})}drop(t,e){if(this.isInsideValidArea(e)){const i=this.targetGraph,o=i.model,n=i.clientToLocal(e),a=this.sourceNode,l=this.options.getDropNode(t,{sourceNode:a,draggingNode:t,targetGraph:this.targetGraph,draggingGraph:this.draggingGraph}),c=l.getBBox();n.x+=c.x-c.width/2,n.y+=c.y-c.height/2;const h=this.snapOffset?1:i.getGridSize();l.position(r.GeometryUtil.snapToGrid(n.x,h),r.GeometryUtil.snapToGrid(n.y,h)),l.removeZIndex();const p=this.options.validateNode,b=p?p(l,{sourceNode:a,draggingNode:t,droppingNode:l,targetGraph:i,draggingGraph:this.draggingGraph}):!0;return typeof b=="boolean"?b?(o.addCell(l,{stencil:this.cid}),l):null:r.FunctionExt.toDeferredBoolean(b).then(u=>u?(o.addCell(l,{stencil:this.cid}),l):null)}return null}onRemove(){this.draggingGraph&&(this.draggingGraph.view.remove(),this.draggingGraph.dispose())}dispose(){this.remove(),r.CssLoader.clean(this.name)}}It([r.View.dispose()],J.prototype,"dispose",null);(function(s){s.defaults={getDragNode:t=>t.clone(),getDropNode:t=>t.clone()},s.documentEvents={mousemove:"onDragging",touchmove:"onDragging",mouseup:"onDragEnd",touchend:"onDragEnd",touchcancel:"onDragEnd"}})(J||(J={}));function At(s,t={}){const e=r.Model.isModel(s)?s:new r.Model().resetCells(s,{sort:!1,dryrun:!0}),i=e.getNodes(),o=t.columns||1,n=Math.ceil(i.length/o),a=t.dx||0,l=t.dy||0,c=t.center!==!1,h=t.resizeToFit===!0,p=t.marginX||0,b=t.marginY||0,u=[];let f=t.columnWidth;if(f==="compact")for(let E=0;E<o;E+=1){const O=V.getNodesInColumn(i,E,o);u.push(V.getMaxDim(O,"width")+a)}else{(f==null||f==="auto")&&(f=V.getMaxDim(i,"width")+a);for(let E=0;E<o;E+=1)u.push(f)}const w=V.accumulate(u,p),m=[];let x=t.rowHeight;if(x==="compact")for(let E=0;E<n;E+=1){const O=V.getNodesInRow(i,E,o);m.push(V.getMaxDim(O,"height")+l)}else{(x==null||x==="auto")&&(x=V.getMaxDim(i,"height")+l);for(let E=0;E<n;E+=1)m.push(x)}const I=V.accumulate(m,b);e.startBatch("layout"),i.forEach((E,O)=>{const S=O%o,k=Math.floor(O/o),D=u[S],d=m[k];let g=0,y=0,v=E.getSize();if(h){let N=D-2*a,M=d-2*l;const _=v.height*(v.width?N/v.width:1),F=v.width*(v.height?M/v.height:1);d<_?N=F:M=_,v={width:N,height:M},E.setSize(v,t)}c&&(g=(D-v.width)/2,y=(d-v.height)/2),E.position(w[S]+a+g,I[k]+l+y,t)}),e.stopBatch("layout")}var V;(function(s){function t(n,a){return n.reduce((l,c)=>Math.max(c==null?void 0:c.getSize()[a],l),0)}s.getMaxDim=t;function e(n,a,l){const c=[];for(let h=l*a,p=h+l;h<p;h+=1)n[h]&&c.push(n[h]);return c}s.getNodesInRow=e;function i(n,a,l){const c=[];for(let h=a,p=n.length;h<p;h+=l)n[h]&&c.push(n[h]);return c}s.getNodesInColumn=i;function o(n,a){return n.reduce((l,c,h)=>(l.push(l[h]+c),l),[a||0])}s.accumulate=o})(V||(V={}));const Lt=`.x6-widget-dnd {
  position: absolute;
  top: -10000px;
  left: -10000px;
  z-index: 999999;
  display: none;
  cursor: move;
  opacity: 0.7;
  pointer-events: 'cursor';
}
.x6-widget-dnd.dragging {
  display: inline-block;
}
.x6-widget-dnd.dragging * {
  pointer-events: none !important;
}
.x6-widget-dnd .x6-graph {
  background: transparent;
  box-shadow: none;
}
.x6-widget-stencil {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.x6-widget-stencil::after {
  position: absolute;
  top: 0;
  display: block;
  width: 100%;
  height: 20px;
  padding: 8px 0;
  line-height: 20px;
  text-align: center;
  opacity: 0;
  transition: top 0.1s linear, opacity 0.1s linear;
  content: ' ';
  pointer-events: none;
}
.x6-widget-stencil-content {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  height: auto;
  overflow-x: hidden;
  overflow-y: auto;
}
.x6-widget-stencil .x6-node [magnet]:not([magnet='passive']) {
  pointer-events: none;
}
.x6-widget-stencil-group {
  padding: 0;
  padding-bottom: 8px;
  overflow: hidden;
  user-select: none;
}
.x6-widget-stencil-group.collapsed {
  height: auto;
  padding-bottom: 0;
}
.x6-widget-stencil-group-title {
  position: relative;
  margin-top: 0;
  margin-bottom: 0;
  padding: 4px;
  cursor: pointer;
}
.x6-widget-stencil-title,
.x6-widget-stencil-group > .x6-widget-stencil-group-title {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  user-select: none;
}
.x6-widget-stencil .unmatched {
  opacity: 0.3;
}
.x6-widget-stencil .x6-node.unmatched {
  display: none;
}
.x6-widget-stencil-group.unmatched {
  display: none;
}
.x6-widget-stencil-search-text {
  position: relative;
  z-index: 1;
  box-sizing: border-box;
  width: 100%;
  height: 30px;
  max-height: 30px;
  line-height: 30px;
  outline: 0;
}
.x6-widget-stencil.not-found::after {
  opacity: 1;
  content: attr(data-not-found-text);
}
.x6-widget-stencil.not-found.searchable::after {
  top: 30px;
}
.x6-widget-stencil.not-found.searchable.collapsable::after {
  top: 50px;
}
.x6-widget-stencil {
  color: #333;
  background: #f5f5f5;
}
.x6-widget-stencil-content {
  position: absolute;
}
.x6-widget-stencil.collapsable > .x6-widget-stencil-content {
  top: 32px;
}
.x6-widget-stencil.searchable > .x6-widget-stencil-content {
  top: 80px;
}
.x6-widget-stencil.not-found::after {
  position: absolute;
}
.x6-widget-stencil.not-found.searchable.collapsable::after {
  top: 80px;
}
.x6-widget-stencil.not-found.searchable::after {
  top: 60px;
}
.x6-widget-stencil-group {
  height: auto;
  margin-bottom: 1px;
  padding: 0;
  transition: none;
}
.x6-widget-stencil-group .x6-graph {
  background: transparent;
  box-shadow: none;
}
.x6-widget-stencil-group.collapsed {
  height: auto;
  max-height: 31px;
}
.x6-widget-stencil-title,
.x6-widget-stencil-group > .x6-widget-stencil-group-title {
  position: relative;
  left: 0;
  box-sizing: border-box;
  width: 100%;
  height: 32px;
  padding: 0 5px 0 8px;
  color: #666;
  font-weight: 700;
  font-size: 12px;
  line-height: 32px;
  cursor: default;
  transition: all 0.3;
}
.x6-widget-stencil-title:hover,
.x6-widget-stencil-group > .x6-widget-stencil-group-title:hover {
  color: #444;
}
.x6-widget-stencil-title {
  background: #e9e9e9;
}
.x6-widget-stencil-group > .x6-widget-stencil-group-title {
  background: #ededed;
}
.x6-widget-stencil.collapsable > .x6-widget-stencil-title,
.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title {
  padding-left: 32px;
  cursor: pointer;
}
.x6-widget-stencil.collapsable > .x6-widget-stencil-title::before,
.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title::before {
  position: absolute;
  top: 6px;
  left: 8px;
  display: block;
  width: 18px;
  height: 18px;
  margin: 0;
  padding: 0;
  background-color: transparent;
  background-repeat: no-repeat;
  background-position: 0 0;
  border: none;
  content: ' ';
}
.x6-widget-stencil.collapsable > .x6-widget-stencil-title::before,
.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title::before {
  background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iIzAwMCIgZmlsbC1ydWxlPSJub256ZXJvIj48cGF0aCBkPSJNOS4zNzUuNUM0LjY4Ny41Ljg3NSA0LjMxMy44NzUgOWMwIDQuNjg4IDMuODEyIDguNSA4LjUgOC41IDQuNjg3IDAgOC41LTMuODEyIDguNS04LjUgMC00LjY4Ny0zLjgxMy04LjUtOC41LTguNXptMCAxNS44ODZDNS4zMDMgMTYuMzg2IDEuOTkgMTMuMDcyIDEuOTkgOXMzLjMxMi03LjM4NSA3LjM4NS03LjM4NVMxNi43NiA0LjkyOCAxNi43NiA5YzAgNC4wNzItMy4zMTMgNy4zODYtNy4zODUgNy4zODZ6Ii8+PHBhdGggZD0iTTEyLjc1MyA4LjQ0M0g1Ljk5N2EuNTU4LjU1OCAwIDAwMCAxLjExNmg2Ljc1NmEuNTU4LjU1OCAwIDAwMC0xLjExNnoiLz48L2c+PC9zdmc+');
  opacity: 0.4;
  transition: all 0.3s;
}
.x6-widget-stencil.collapsable > .x6-widget-stencil-title:hover::before,
.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title:hover::before {
  opacity: 0.6;
}
.x6-widget-stencil.collapsable.collapsed > .x6-widget-stencil-title::before,
.x6-widget-stencil-group.collapsable.collapsed > .x6-widget-stencil-group-title::before {
  background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iIzAwMCIgZmlsbC1ydWxlPSJub256ZXJvIj48cGF0aCBkPSJNOS4zNzUuNUM0LjY4Ny41Ljg3NSA0LjMxMy44NzUgOWMwIDQuNjg4IDMuODEyIDguNSA4LjUgOC41IDQuNjg3IDAgOC41LTMuODEyIDguNS04LjUgMC00LjY4Ny0zLjgxMy04LjUtOC41LTguNXptMCAxNS44ODZDNS4zMDMgMTYuMzg2IDEuOTkgMTMuMDcyIDEuOTkgOXMzLjMxMi03LjM4NSA3LjM4NS03LjM4NVMxNi43NiA0LjkyOCAxNi43NiA5YzAgNC4wNzItMy4zMTMgNy4zODYtNy4zODUgNy4zODZ6Ii8+PHBhdGggZD0iTTEyLjc1MyA4LjQ0M0g1Ljk5N2EuNTU4LjU1OCAwIDAwMCAxLjExNmg2Ljc1NmEuNTU4LjU1OCAwIDAwMC0xLjExNnoiLz48cGF0aCBkPSJNOC44MTcgNS42MjN2Ni43NTZhLjU1OC41NTggMCAwMDEuMTE2IDBWNS42MjNhLjU1OC41NTggMCAxMC0xLjExNiAweiIvPjwvZz48L3N2Zz4=');
  opacity: 0.4;
}
.x6-widget-stencil.collapsable.collapsed > .x6-widget-stencil-title:hover::before,
.x6-widget-stencil-group.collapsable.collapsed > .x6-widget-stencil-group-title:hover::before {
  opacity: 0.6;
}
.x6-widget-stencil input[type='search'] {
  appearance: textfield;
}
.x6-widget-stencil input[type='search']::-webkit-search-cancel-button,
.x6-widget-stencil input[type='search']::-webkit-search-decoration {
  appearance: none;
}
.x6-widget-stencil-search-text {
  display: block;
  width: 90%;
  margin: 8px 5%;
  padding-left: 8px;
  color: #333;
  background: #fff;
  border: 1px solid #e9e9e9;
  border-radius: 12px;
  outline: 0;
}
.x6-widget-stencil-search-text:focus {
  outline: 0;
}
.x6-widget-stencil::after {
  color: #808080;
  font-weight: 600;
  font-size: 12px;
  background: 0 0;
}
`;var Bt=globalThis&&globalThis.__decorate||function(s,t,e,i){var o=arguments.length,n=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(s,t,e,i);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(n=(o<3?a(n):o>3?a(t,e,n):a(t,e))||n);return o>3&&n&&Object.defineProperty(t,e,n),n};class et extends r.View{get targetScroller(){return this.options.target.getPlugin("scroller")}get targetGraph(){return this.options.target}get targetModel(){return this.targetGraph.model}constructor(t={}){super(),this.name="stencil",r.CssLoader.ensure(this.name,Lt),this.graphs={},this.groups={},this.options=Object.assign(Object.assign({},et.defaultOptions),t),this.init()}init(){this.dnd=new J(this.options),this.onSearch=r.FunctionExt.debounce(this.onSearch,200),this.initContainer(),this.initSearch(),this.initContent(),this.initGroups(),this.setTitle(),this.startListening()}load(t,e){return Array.isArray(t)?this.loadGroup(t,e):this.options.groups&&Object.keys(this.options.groups).forEach(i=>{t[i]&&this.loadGroup(t[i],i)}),this}unload(t,e){return Array.isArray(t)?this.loadGroup(t,e,!0):this.options.groups&&Object.keys(this.options.groups).forEach(i=>{t[i]&&this.loadGroup(t[i],i,!0)}),this}toggleGroup(t){return this.isGroupCollapsed(t)?this.expandGroup(t):this.collapseGroup(t),this}collapseGroup(t){if(this.isGroupCollapsable(t)){const e=this.groups[t];e&&!this.isGroupCollapsed(t)&&(this.trigger("group:collapse",{name:t}),r.Dom.addClass(e,"collapsed"))}return this}expandGroup(t){if(this.isGroupCollapsable(t)){const e=this.groups[t];e&&this.isGroupCollapsed(t)&&(this.trigger("group:expand",{name:t}),r.Dom.removeClass(e,"collapsed"))}return this}isGroupCollapsable(t){const e=this.groups[t];return r.Dom.hasClass(e,"collapsable")}isGroupCollapsed(t){const e=this.groups[t];return e&&r.Dom.hasClass(e,"collapsed")}collapseGroups(){return Object.keys(this.groups).forEach(t=>this.collapseGroup(t)),this}expandGroups(){return Object.keys(this.groups).forEach(t=>this.expandGroup(t)),this}resizeGroup(t,e){const i=this.graphs[t];return i&&i.resize(e.width,e.height),this}addGroup(t){const e=Array.isArray(t)?t:[t];this.options.groups?this.options.groups.push(...e):this.options.groups=e,e.forEach(i=>this.initGroup(i))}removeGroup(t){const e=Array.isArray(t)?t:[t];this.options.groups&&(this.options.groups=this.options.groups.filter(i=>!e.includes(i.name)),e.forEach(i=>{const o=this.graphs[i];this.unregisterGraphEvents(o),o.dispose(),delete this.graphs[i];const n=this.groups[i];r.Dom.remove(n),delete this.groups[i]}))}initContainer(){this.container=document.createElement("div"),r.Dom.addClass(this.container,this.prefixClassName($.base)),r.Dom.attr(this.container,"data-not-found-text",this.options.notFoundText||"No matches found")}initContent(){this.content=document.createElement("div"),r.Dom.addClass(this.content,this.prefixClassName($.content)),r.Dom.appendTo(this.content,this.container)}initSearch(){this.options.search&&(r.Dom.addClass(this.container,"searchable"),r.Dom.append(this.container,this.renderSearch()))}initGroup(t){const e=this.options.stencilGraphOptions||{},i=document.createElement("div");r.Dom.addClass(i,this.prefixClassName($.group)),r.Dom.attr(i,"data-name",t.name),(t.collapsable==null&&this.options.collapsable||t.collapsable!==!1)&&r.Dom.addClass(i,"collapsable"),r.Dom.toggleClass(i,"collapsed",t.collapsed===!0);const o=document.createElement("h3");r.Dom.addClass(o,this.prefixClassName($.groupTitle)),o.innerHTML=t.title||t.name;const n=document.createElement("div");r.Dom.addClass(n,this.prefixClassName($.groupContent));const a=t.graphOptions,l=new r.Graph(Object.assign(Object.assign(Object.assign({},e),a),{container:document.createElement("div"),model:e.model||new r.Model,width:t.graphWidth||this.options.stencilGraphWidth,height:t.graphHeight||this.options.stencilGraphHeight,interacting:!1,preventDefaultBlankAction:!1}));this.registerGraphEvents(l),r.Dom.append(n,l.container),r.Dom.append(i,[o,n]),r.Dom.appendTo(i,this.content),this.groups[t.name]=i,this.graphs[t.name]=l}initGroups(){if(this.clearGroups(),this.setCollapsableState(),this.options.groups&&this.options.groups.length)this.options.groups.forEach(t=>{this.initGroup(t)});else{const t=this.options.stencilGraphOptions||{},e=new r.Graph(Object.assign(Object.assign({},t),{container:document.createElement("div"),model:t.model||new r.Model,width:this.options.stencilGraphWidth,height:this.options.stencilGraphHeight,interacting:!1,preventDefaultBlankAction:!1}));r.Dom.append(this.content,e.container),this.graphs[nt.defaultGroupName]=e}}setCollapsableState(){this.options.collapsable=this.options.collapsable&&this.options.groups&&this.options.groups.some(t=>t.collapsable!==!1),this.options.collapsable?(r.Dom.addClass(this.container,"collapsable"),this.options.groups&&this.options.groups.every(e=>e.collapsed||e.collapsable===!1)?r.Dom.addClass(this.container,"collapsed"):r.Dom.removeClass(this.container,"collapsed")):r.Dom.removeClass(this.container,"collapsable")}setTitle(){const t=document.createElement("div");r.Dom.addClass(t,this.prefixClassName($.title)),t.innerHTML=this.options.title,r.Dom.appendTo(t,this.container)}renderSearch(){const t=document.createElement("div");r.Dom.addClass(t,this.prefixClassName($.search));const e=document.createElement("input");return r.Dom.attr(e,{type:"search",placeholder:this.options.placeholder||"Search"}),r.Dom.addClass(e,this.prefixClassName($.searchText)),r.Dom.append(t,e),t}startListening(){const t=this.prefixClassName($.title),e=this.prefixClassName($.searchText),i=this.prefixClassName($.groupTitle);this.delegateEvents({[`click .${t}`]:"onTitleClick",[`touchstart .${t}`]:"onTitleClick",[`click .${i}`]:"onGroupTitleClick",[`touchstart .${i}`]:"onGroupTitleClick",[`input .${e}`]:"onSearch",[`focusin .${e}`]:"onSearchFocusIn",[`focusout .${e}`]:"onSearchFocusOut"})}stopListening(){this.undelegateEvents()}registerGraphEvents(t){t.on("cell:mousedown",this.onDragStart,this)}unregisterGraphEvents(t){t.off("cell:mousedown",this.onDragStart,this)}loadGroup(t,e,i){const o=this.getModel(e);if(o){const c=t.map(h=>r.Node.isNode(h)?h:r.Node.create(h));i===!0?o.removeCells(c):o.resetCells(c)}const n=this.getGroup(e);let a=this.options.stencilGraphHeight;n&&n.graphHeight!=null&&(a=n.graphHeight);const l=n&&n.layout||this.options.layout;if(l&&o&&r.FunctionExt.call(l,this,o,n),!a){const c=this.getGraph(e);c.fitToContent({minWidth:c.options.width,gridHeight:1,padding:n&&n.graphPadding||this.options.stencilGraphPadding||10})}return this}onDragStart(t){const{e,node:i}=t,o=this.getGroupByNode(i);o&&o.nodeMovable===!1||this.dnd.start(i,e)}filter(t,e){const i=Object.keys(this.graphs).reduce((o,n)=>{const a=this.graphs[n],l=n===nt.defaultGroupName?null:n,c=a.model.getNodes().filter(u=>{let f=!1;typeof e=="function"?f=r.FunctionExt.call(e,this,u,t,l,this):typeof e=="boolean"?f=e:f=this.isCellMatched(u,t,e,t.toLowerCase()!==t);const w=a.renderer.findViewByCell(u);return w&&r.Dom.toggleClass(w.container,"unmatched",!f),f}),h=c.length>0,p=this.options,b=new r.Model;return b.resetCells(c),p.layout&&r.FunctionExt.call(p.layout,this,b,this.getGroup(n)),this.groups[n]&&r.Dom.toggleClass(this.groups[n],"unmatched",!h),a.fitToContent({gridWidth:1,gridHeight:1,padding:p.stencilGraphPadding||10}),o||h},!1);r.Dom.toggleClass(this.container,"not-found",!i)}isCellMatched(t,e,i,o){return e&&i?Object.keys(i).some(n=>{if(n==="*"||t.shape===n){const a=i[n];return typeof a=="boolean"?a:(Array.isArray(a)?a:[a]).some(c=>{let h=t.getPropByPath(c);return h!=null?(h=`${h}`,o||(h=h.toLowerCase()),h.indexOf(e)>=0):!1})}return!1}):!0}onSearch(t){this.filter(t.target.value,this.options.search)}onSearchFocusIn(){r.Dom.addClass(this.container,"is-focused")}onSearchFocusOut(){r.Dom.removeClass(this.container,"is-focused")}onTitleClick(){this.options.collapsable&&(r.Dom.toggleClass(this.container,"collapsed"),r.Dom.hasClass(this.container,"collapsed")?this.collapseGroups():this.expandGroups())}onGroupTitleClick(t){const e=t.target.closest(`.${this.prefixClassName($.group)}`);e&&this.toggleGroup(r.Dom.attr(e,"data-name")||"");const i=Object.keys(this.groups).every(o=>{const n=this.getGroup(o),a=this.groups[o];return n&&n.collapsable===!1||r.Dom.hasClass(a,"collapsed")});r.Dom.toggleClass(this.container,"collapsed",i)}getModel(t){const e=this.getGraph(t);return e?e.model:null}getGraph(t){return this.graphs[t||nt.defaultGroupName]}getGroup(t){const e=this.options.groups;return t!=null&&e&&e.length?e.find(i=>i.name===t):null}getGroupByNode(t){const e=this.options.groups;return e?e.find(i=>{const o=this.getModel(i.name);return o?o.has(t.id):!1}):null}clearGroups(){Object.keys(this.graphs).forEach(t=>{const e=this.graphs[t];this.unregisterGraphEvents(e),e.dispose()}),Object.keys(this.groups).forEach(t=>{const e=this.groups[t];r.Dom.remove(e)}),this.graphs={},this.groups={}}onRemove(){this.clearGroups(),this.dnd.remove(),this.stopListening(),this.undelegateDocumentEvents()}dispose(){this.remove(),r.CssLoader.clean(this.name)}}Bt([r.View.dispose()],et.prototype,"dispose",null);(function(s){s.defaultOptions=Object.assign({stencilGraphWidth:200,stencilGraphHeight:800,title:"Stencil",collapsable:!1,placeholder:"Search",notFoundText:"No matches found",layout(t,e){const i={columnWidth:this.options.stencilGraphWidth/2-10,columns:2,rowHeight:80,resizeToFit:!1,dx:10,dy:10};At(t,Object.assign(Object.assign(Object.assign({},i),this.options.layoutOptions),e?e.layoutOptions:{}))}},J.defaults)})(et||(et={}));var $;(function(s){s.base="widget-stencil",s.title=`${s.base}-title`,s.search=`${s.base}-search`,s.searchText=`${s.search}-text`,s.content=`${s.base}-content`,s.group=`${s.base}-group`,s.groupTitle=`${s.group}-title`,s.groupContent=`${s.group}-content`})($||($={}));var nt;(function(s){s.defaultGroupName="__default__"})(nt||(nt={}));var Tt=globalThis&&globalThis.__decorate||function(s,t,e,i){var o=arguments.length,n=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(s,t,e,i);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(n=(o<3?a(n):o>3?a(t,e,n):a(t,e))||n);return o>3&&n&&Object.defineProperty(t,e,n),n};class bt extends r.View{get model(){return this.graph.model}get view(){return this.graph.renderer.findViewByCell(this.node)}get containerClassName(){return this.prefixClassName("widget-transform")}get resizeClassName(){return`${this.containerClassName}-resize`}get rotateClassName(){return`${this.containerClassName}-rotate`}constructor(t,e,i){super(),this.node=e,this.graph=i,this.options=Object.assign(Object.assign({},B.defaultOptions),t),this.render(),this.startListening()}startListening(){this.delegateEvents({[`mousedown .${this.resizeClassName}`]:"startResizing",[`touchstart .${this.resizeClassName}`]:"startResizing",[`mousedown .${this.rotateClassName}`]:"startRotating",[`touchstart .${this.rotateClassName}`]:"startRotating"}),this.model.on("*",this.update,this),this.graph.on("scale",this.update,this),this.graph.on("translate",this.update,this),this.node.on("removed",this.remove,this),this.model.on("reseted",this.remove,this),this.view.on("cell:knob:mousedown",this.onKnobMouseDown,this),this.view.on("cell:knob:mouseup",this.onKnobMouseUp,this)}stopListening(){this.undelegateEvents(),this.model.off("*",this.update,this),this.graph.off("scale",this.update,this),this.graph.off("translate",this.update,this),this.node.off("removed",this.remove,this),this.model.off("reseted",this.remove,this),this.view.off("cell:knob:mousedown",this.onKnobMouseDown,this),this.view.off("cell:knob:mouseup",this.onKnobMouseUp,this)}renderHandles(){this.container=document.createElement("div");const t=document.createElement("div");r.Dom.attr(t,"draggable","false");const e=t.cloneNode(!0);r.Dom.addClass(e,this.rotateClassName);const i=B.POSITIONS.map(o=>{const n=t.cloneNode(!0);return r.Dom.addClass(n,this.resizeClassName),r.Dom.attr(n,"data-position",o),n});this.empty(),r.Dom.append(this.container,[...i,e])}render(){return this.renderHandles(),this.view&&this.view.addClass(B.NODE_CLS),r.Dom.addClass(this.container,this.containerClassName),r.Dom.toggleClass(this.container,"no-orth-resize",this.options.preserveAspectRatio||!this.options.orthogonalResizing),r.Dom.toggleClass(this.container,"no-resize",!this.options.resizable),r.Dom.toggleClass(this.container,"no-rotate",!this.options.rotatable),this.options.className&&r.Dom.addClass(this.container,this.options.className),this.graph.container.appendChild(this.container),this.update()}update(){const t=this.graph.matrix(),e=this.node.getBBox();e.x*=t.a,e.x+=t.e,e.y*=t.d,e.y+=t.f,e.width*=t.a,e.height*=t.d;const i=r.Angle.normalize(this.node.getAngle()),o=i!==0?`rotate(${i}deg)`:"";return r.Dom.css(this.container,{transform:o,width:e.width,height:e.height,left:e.x,top:e.y}),this.updateResizerDirections(),this}remove(){return this.view&&this.view.removeClass(B.NODE_CLS),super.remove()}onKnobMouseDown(){this.startHandle()}onKnobMouseUp(){this.stopHandle()}updateResizerDirections(){const t=r.Angle.normalize(this.node.getAngle()),e=Math.floor(t*(B.DIRECTIONS.length/360));if(e!==this.prevShift){const i=B.DIRECTIONS.slice(e).concat(B.DIRECTIONS.slice(0,e)),o=a=>`${this.containerClassName}-cursor-${a}`;this.container.querySelectorAll(`.${this.resizeClassName}`).forEach((a,l)=>{r.Dom.removeClass(a,B.DIRECTIONS.map(c=>o(c)).join(" ")),r.Dom.addClass(a,o(i[l]))}),this.prevShift=e}}getTrueDirection(t){const e=r.Angle.normalize(this.node.getAngle());let i=B.POSITIONS.indexOf(t);return i+=Math.floor(e*(B.POSITIONS.length/360)),i%=B.POSITIONS.length,B.POSITIONS[i]}toValidResizeDirection(t){return{top:"top-left",bottom:"bottom-right",left:"bottom-left",right:"top-right"}[t]||t}startResizing(t){t.stopPropagation(),this.model.startBatch("resize",{cid:this.cid});const e=r.Dom.attr(t.target,"data-position");this.prepareResizing(t,e),this.startAction(t)}prepareResizing(t,e){const i=this.getTrueDirection(e);let o=0,n=0;e.split("-").forEach(h=>{o={left:-1,right:1}[h]||o,n={top:-1,bottom:1}[h]||n});const a=this.toValidResizeDirection(e),l={"top-right":"bottomLeft","top-left":"bottomRight","bottom-left":"topRight","bottom-right":"topLeft"}[a],c=r.Angle.normalize(this.node.getAngle());this.setEventData(t,{selector:l,direction:a,trueDirection:i,relativeDirection:e,angle:c,resizeX:o,resizeY:n,action:"resizing"})}startRotating(t){t.stopPropagation(),this.model.startBatch("rotate",{cid:this.cid});const e=this.node.getBBox().getCenter(),i=this.normalizeEvent(t),o=this.graph.snapToGrid(i.clientX,i.clientY);this.setEventData(t,{center:e,action:"rotating",angle:r.Angle.normalize(this.node.getAngle()),start:r.Point.create(o).theta(e)}),this.startAction(t)}onMouseMove(t){const e=this.graph.findViewByCell(this.node);let i=this.getEventData(t);if(i.action){const o=this.normalizeEvent(t);let n=o.clientX,a=o.clientY;const l=this.graph.getPlugin("scroller"),c=this.options.restrictedResizing;if(c===!0||typeof c=="number"){const f=c===!0?0:c,w=l?Math.max(f,8):f,m=this.graph.container.getBoundingClientRect();n=r.NumberExt.clamp(n,m.left+w,m.right-w),a=r.NumberExt.clamp(a,m.top+w,m.bottom-w)}else this.options.autoScrollOnResizing&&l&&l.autoScroll(n,a);const h=this.graph.snapToGrid(n,a),p=this.graph.getGridSize(),b=this.node,u=this.options;if(i.action==="resizing"){i=i,i.resized||(e&&(e.addClass("node-resizing"),this.notify("node:resize",t,e)),i.resized=!0);const f=b.getBBox(),w=r.Point.create(h).rotate(i.angle,f.getCenter()).diff(f[i.selector]);let m=i.resizeX?w.x*i.resizeX:f.width,x=i.resizeY?w.y*i.resizeY:f.height;const I=m,E=x;if(m=r.GeometryUtil.snapToGrid(m,p),x=r.GeometryUtil.snapToGrid(x,p),m=Math.max(m,u.minWidth||p),x=Math.max(x,u.minHeight||p),m=Math.min(m,u.maxWidth||1/0),x=Math.min(x,u.maxHeight||1/0),u.preserveAspectRatio){const S=f.width*x/f.height,k=f.height*m/f.width;m<S?x=k:m=S}const O=i.relativeDirection;if(u.allowReverse&&(I<=-m||E<=-x)){let S;O==="left"?I<=-m&&(S="right"):O==="right"?I<=-m&&(S="left"):O==="top"?E<=-x&&(S="bottom"):O==="bottom"?E<=-x&&(S="top"):O==="top-left"?I<=-m&&E<=-x?S="bottom-right":I<=-m?S="top-right":E<=-x&&(S="bottom-left"):O==="top-right"?I<=-m&&E<=-x?S="bottom-left":I<=-m?S="top-left":E<=-x&&(S="bottom-right"):O==="bottom-left"?I<=-m&&E<=-x?S="top-right":I<=-m?S="bottom-right":E<=-x&&(S="top-left"):O==="bottom-right"&&(I<=-m&&E<=-x?S="top-left":I<=-m?S="bottom-left":E<=-x&&(S="top-right"));const k=S;this.stopHandle();const D=this.container.querySelector(`.${this.resizeClassName}[data-position="${k}"]`);this.startHandle(D),this.prepareResizing(t,k),this.onMouseMove(t)}if(f.width!==m||f.height!==x){const S={ui:!0,direction:i.direction,relativeDirection:i.relativeDirection,trueDirection:i.trueDirection,minWidth:u.minWidth,minHeight:u.minHeight,maxWidth:u.maxWidth,maxHeight:u.maxHeight,preserveAspectRatio:u.preserveAspectRatio===!0};b.resize(m,x,S),this.notify("node:resizing",t,e)}}else if(i.action==="rotating"){i=i,i.rotated||(e&&(e.addClass("node-rotating"),this.notify("node:rotate",t,e)),i.rotated=!0);const f=b.getAngle(),w=i.start-r.Point.create(h).theta(i.center);let m=i.angle+w;u.rotateGrid&&(m=r.GeometryUtil.snapToGrid(m,u.rotateGrid)),m=r.Angle.normalize(m),f!==m&&(b.rotate(m,{absolute:!0}),this.notify("node:rotating",t,e))}}}onMouseUp(t){const e=this.getEventData(t);e.action&&(this.stopAction(t),this.model.stopBatch(e.action==="resizing"?"resize":"rotate",{cid:this.cid}))}startHandle(t){if(this.handle=t||null,r.Dom.addClass(this.container,`${this.containerClassName}-active`),t){r.Dom.addClass(t,`${this.containerClassName}-active-handle`);const e=t.getAttribute("data-position");if(e){const i=B.DIRECTIONS[B.POSITIONS.indexOf(e)];r.Dom.addClass(this.container,`${this.containerClassName}-cursor-${i}`)}}}stopHandle(){if(r.Dom.removeClass(this.container,`${this.containerClassName}-active`),this.handle){r.Dom.removeClass(this.handle,`${this.containerClassName}-active-handle`);const t=this.handle.getAttribute("data-position");if(t){const e=B.DIRECTIONS[B.POSITIONS.indexOf(t)];r.Dom.removeClass(this.container,`${this.containerClassName}-cursor-${e}`)}this.handle=null}}startAction(t){this.startHandle(t.target),this.graph.view.undelegateEvents(),this.delegateDocumentEvents(B.documentEvents,t.data)}stopAction(t){this.stopHandle(),this.undelegateDocumentEvents(),this.graph.view.delegateEvents();const e=this.graph.findViewByCell(this.node),i=this.getEventData(t);e&&(e.removeClass(`node-${i.action}`),i.action==="resizing"&&i.resized?this.notify("node:resized",t,e):i.action==="rotating"&&i.rotated&&this.notify("node:rotated",t,e))}notify(t,e,i,o={}){if(i){const n=i.graph,a=n.view.normalizeEvent(e),l=n.snapToGrid(a.clientX,a.clientY);this.trigger(t,Object.assign({e:a,view:i,node:i.cell,cell:i.cell,x:l.x,y:l.y},o))}}dispose(){this.stopListening(),this.remove(),this.off()}}Tt([r.View.dispose()],bt.prototype,"dispose",null);var B;(function(s){s.NODE_CLS="has-widget-transform",s.DIRECTIONS=["nw","n","ne","e","se","s","sw","w"],s.POSITIONS=["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"],s.documentEvents={mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp"},s.defaultOptions={minWidth:0,minHeight:0,maxWidth:1/0,maxHeight:1/0,rotateGrid:15,rotatable:!0,preserveAspectRatio:!1,orthogonalResizing:!0,restrictedResizing:!1,autoScrollOnResizing:!0,allowReverse:!0}})(B||(B={}));const jt=`.x6-widget-transform {
  position: absolute;
  box-sizing: content-box !important;
  margin: -5px 0 0 -5px;
  padding: 4px;
  border: 1px dashed #000;
  border-radius: 5px;
  user-select: none;
  pointer-events: none;
}
.x6-widget-transform > div {
  position: absolute;
  box-sizing: border-box;
  background-color: #fff;
  border: 1px solid #000;
  transition: background-color 0.2s;
  pointer-events: auto;
  -webkit-user-drag: none;
  user-drag: none;
  /* stylelint-disable-line */
}
.x6-widget-transform > div:hover {
  background-color: #d3d3d3;
}
.x6-widget-transform-cursor-n {
  cursor: n-resize;
}
.x6-widget-transform-cursor-s {
  cursor: s-resize;
}
.x6-widget-transform-cursor-e {
  cursor: e-resize;
}
.x6-widget-transform-cursor-w {
  cursor: w-resize;
}
.x6-widget-transform-cursor-ne {
  cursor: ne-resize;
}
.x6-widget-transform-cursor-nw {
  cursor: nw-resize;
}
.x6-widget-transform-cursor-se {
  cursor: se-resize;
}
.x6-widget-transform-cursor-sw {
  cursor: sw-resize;
}
.x6-widget-transform-resize {
  width: 10px;
  height: 10px;
  border-radius: 6px;
}
.x6-widget-transform-resize[data-position='top-left'] {
  top: -5px;
  left: -5px;
}
.x6-widget-transform-resize[data-position='top-right'] {
  top: -5px;
  right: -5px;
}
.x6-widget-transform-resize[data-position='bottom-left'] {
  bottom: -5px;
  left: -5px;
}
.x6-widget-transform-resize[data-position='bottom-right'] {
  right: -5px;
  bottom: -5px;
}
.x6-widget-transform-resize[data-position='top'] {
  top: -5px;
  left: 50%;
  margin-left: -5px;
}
.x6-widget-transform-resize[data-position='bottom'] {
  bottom: -5px;
  left: 50%;
  margin-left: -5px;
}
.x6-widget-transform-resize[data-position='left'] {
  top: 50%;
  left: -5px;
  margin-top: -5px;
}
.x6-widget-transform-resize[data-position='right'] {
  top: 50%;
  right: -5px;
  margin-top: -5px;
}
.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='top'],
.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='bottom'],
.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='left'],
.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='right'] {
  display: none;
}
.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='bottom'],
.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='left'],
.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='right'],
.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='top'] {
  display: none;
}
.x6-widget-transform.no-resize .x6-widget-transform-resize {
  display: none;
}
.x6-widget-transform-rotate {
  top: -20px;
  left: -20px;
  width: 12px;
  height: 12px;
  border-radius: 6px;
  cursor: crosshair;
}
.x6-widget-transform.no-rotate .x6-widget-transform-rotate {
  display: none;
}
.x6-widget-transform-active {
  border-color: transparent;
  pointer-events: all;
}
.x6-widget-transform-active > div {
  display: none;
}
.x6-widget-transform-active > .x6-widget-transform-active-handle {
  display: block;
  background-color: #808080;
}
`;r.Graph.prototype.createTransformWidget=function(s){const t=this.getPlugin("transform");return t&&t.createWidget(s),this};r.Graph.prototype.clearTransformWidgets=function(){const s=this.getPlugin("transform");return s&&s.clearWidgets(),this};var $t=globalThis&&globalThis.__decorate||function(s,t,e,i){var o=arguments.length,n=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(s,t,e,i);else for(var l=s.length-1;l>=0;l--)(a=s[l])&&(n=(o<3?a(n):o>3?a(t,e,n):a(t,e))||n);return o>3&&n&&Object.defineProperty(t,e,n),n};class Y extends r.Basecoat{constructor(t={}){super(),this.name="transform",this.widgets=new Map,this.disabled=!1,this.options=t,r.CssLoader.ensure(this.name,jt)}init(t){this.graph=t,!this.disabled&&this.startListening()}startListening(){this.graph.on("node:click",this.onNodeClick,this),this.graph.on("blank:mousedown",this.onBlankMouseDown,this)}stopListening(){this.graph.off("node:click",this.onNodeClick,this),this.graph.off("blank:mousedown",this.onBlankMouseDown,this)}enable(){this.disabled&&(this.disabled=!1,this.startListening())}disable(){this.disabled||(this.disabled=!0,this.stopListening())}isEnabled(){return!this.disabled}createWidget(t){this.clearWidgets();const e=this.createTransform(t);e&&(this.widgets.set(t,e),e.on("*",(i,o)=>{this.trigger(i,o),this.graph.trigger(i,o)}))}onNodeClick({node:t}){this.createWidget(t)}onBlankMouseDown(){this.clearWidgets()}createTransform(t){const e=this.getTransformOptions(t);return e.resizable||e.rotatable?new bt(e,t,this.graph):null}getTransformOptions(t){this.options.resizing||(this.options.resizing={enabled:!1}),this.options.rotating||(this.options.rotating={enabled:!1}),typeof this.options.resizing=="boolean"&&(this.options.resizing={enabled:this.options.resizing}),typeof this.options.rotating=="boolean"&&(this.options.rotating={enabled:this.options.rotating});const e=Y.parseOptionGroup(this.graph,t,this.options.resizing),i=Y.parseOptionGroup(this.graph,t,this.options.rotating);return{resizable:!!e.enabled,minWidth:e.minWidth||0,maxWidth:e.maxWidth||Number.MAX_SAFE_INTEGER,minHeight:e.minHeight||0,maxHeight:e.maxHeight||Number.MAX_SAFE_INTEGER,orthogonalResizing:typeof e.orthogonal=="boolean"?e.orthogonal:!0,restrictedResizing:!!e.restrict,autoScrollOnResizing:typeof e.autoScroll=="boolean"?e.autoScroll:!0,preserveAspectRatio:!!e.preserveAspectRatio,allowReverse:typeof e.allowReverse=="boolean"?e.allowReverse:!0,rotatable:!!i.enabled,rotateGrid:i.grid||15}}clearWidgets(){this.widgets.forEach((t,e)=>{this.graph.getCellById(e.id)&&t.dispose()}),this.widgets.clear()}dispose(){this.clearWidgets(),this.stopListening(),this.off(),r.CssLoader.clean(this.name)}}$t([r.Basecoat.dispose()],Y.prototype,"dispose",null);(function(s){function t(e,i,o){const n={};return Object.keys(o||{}).forEach(a=>{const l=o[a];n[a]=typeof l=="function"?l.call(e,i):l}),n}s.parseOptionGroup=t})(Y||(Y={}));const Ft={name:"cellPropSet",inject:["_PD"],data(){return{businessDic:{checkLevel:[{label:"\u4E00\u7EA7\u5BA1\u6838",value:1},{label:"\u4E8C\u7EA7\u5BA1\u6838",value:2},{label:"\u4E09\u7EA7\u5BA1\u6838",value:3}]}}},methods:{handleCellLevelChanged(s){let t=this._PD.currentCell,e=this._PD.graph,i=this.businessDic.checkLevel.find(a=>a.value===s);this._PD.currentCellJson.attrs.text.text=i.label;let o=e.getIncomingEdges(t);o&&e.removeCell(o[0].id);let n=e.getOutgoingEdges(t);for(;n;){let a=e.getCellById(n[0].target.cell);e.removeCell(n[0].id),n=e.getOutgoingEdges(a)}}}};var Vt=function(){var t=this,e=t._self._c;return t._PD.currentCellJson?e("div",{attrs:{id:"character-edit"}},[t._PD.currentCellJson.shape==="edge"?[e("div",{staticClass:"prop-title"},[t._v("\u8FB9\u5185\u5BB9")]),e("div",{staticClass:"prop-item"},[e("span",{staticClass:"prop-item-label"},[t._v("\u5185\u5BB9")]),e("el-input",{staticClass:"prop-item-con",attrs:{type:"text",placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t._PD.currentCellJson.labels[0].attrs.label.text,callback:function(i){t.$set(t._PD.currentCellJson.labels[0].attrs.label,"text",i)},expression:"_PD.currentCellJson.labels[0].attrs.label.text"}})],1),e("div",{staticClass:"prop-item"},[e("span",{staticClass:"prop-item-label"},[t._v("\u5B57\u53F7")]),e("el-input-number",{staticClass:"prop-item-con",attrs:{"controls-position":"right",size:"medium",min:14},model:{value:t._PD.currentCellJson.labels[0].attrs.label.fontSize,callback:function(i){t.$set(t._PD.currentCellJson.labels[0].attrs.label,"fontSize",i)},expression:"_PD.currentCellJson.labels[0].attrs.label.fontSize"}})],1)]:[e("div",{staticClass:"prop-title"},[t._v("\u8282\u70B9\u5C5E\u6027")]),e("div",{staticClass:"prop-item"},[e("span",[t._v("\u5185\u5BB9")]),e("el-input",{staticClass:"prop-item-con",attrs:{type:"text",placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},model:{value:t._PD.currentCellJson.attrs.text.text,callback:function(i){t.$set(t._PD.currentCellJson.attrs.text,"text",i)},expression:"_PD.currentCellJson.attrs.text.text"}})],1),e("div",{staticClass:"prop-item"},[e("span",[t._v("\u5B57\u53F7")]),e("el-input-number",{staticClass:"prop-item-con",attrs:{"controls-position":"right",size:"medium",min:14},model:{value:t._PD.currentCellJson.attrs.text.fontSize,callback:function(i){t.$set(t._PD.currentCellJson.attrs.text,"fontSize",i)},expression:"_PD.currentCellJson.attrs.text.fontSize"}})],1),t._PD.currentCellJson.data?[e("div",{staticClass:"prop-title"},[t._v("\u4E1A\u52A1\u5C5E\u6027")]),t._PD.currentCellJson.data.levelName?e("div",{staticClass:"prop-item"},[e("span",[t._v("\u8282\u70B9\u540D\u79F0")]),e("div",{staticClass:"prop-item-con"},[t._v(t._s(t._PD.currentCellJson.data.levelName))])]):t._e(),t._PD.currentCellJson.data.relation?e("div",{staticClass:"prop-item"},[e("span",[t._v("\u5173\u7CFB")]),e("div",{staticClass:"prop-item-con"},[t._v(t._s(t._PD.currentCellJson.data.relation))])]):t._e(),t._PD.currentCellJson.data.checkLevel?e("div",{staticClass:"prop-item"},[e("span",[t._v("\u7B49\u7EA7")]),e("el-select",{staticClass:"prop-item-con",attrs:{placeholder:"\u8BF7\u9009\u62E9"},on:{change:t.handleCellLevelChanged},model:{value:t._PD.currentCellJson.data.checkLevel,callback:function(i){t.$set(t._PD.currentCellJson.data,"checkLevel",i)},expression:"_PD.currentCellJson.data.checkLevel"}},t._l(t.businessDic.checkLevel,function(i){return e("el-option",{key:i.value,attrs:{label:i.label,value:i.value}})}),1)],1):t._e()]:t._e()]],2):t._e()},Wt=[],Ht=lt(Ft,Vt,Wt,!1,null,"c6a323f5",null,null);const Ut=Ht.exports;const at={groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"show"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"show"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"show"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"show"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]},Jt={name:"processDesigner",provide(){return{_PD:this}},components:{codeMirror:vt,cellPropSet:Ut},data(){return{graph:null,stencil:null,currentCellJson:null,currentCell:null,uploadArr:null,jsonVisible:!1,uploadVisible:!1,hadWarning:!1}},methods:{initDrawContainer(){const s=new r.Graph({container:this.$refs.drawContainer,autoResize:!0,background:{color:"#eff1f6"},grid:{size:10,visible:!0,type:"dot",args:{color:"#595959",thickness:2}},panning:{enabled:!0,eventTypes:"rightMouseDown"},mousewheel:{enabled:!0,zoomAtMousePosition:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{anchor:"center",connectionPoint:"anchor",allowBlank:!1,snap:{radius:20},createEdge(){return new r.Shape.Edge({attrs:{line:{stroke:"#007aff",strokeWidth:2,targetMarker:{name:"block",width:12,height:8}}},router:{name:"manhattan",args:{padding:10}},zIndex:0,labels:[{attrs:{label:{text:"",fontSize:14,stroke:"#333"},body:{fill:"#fff"}},position:.5}],tools:[{name:"button-remove",args:{distance:.5,offset:{x:0,y:20},rotate:!0}}]})},validateConnection({sourceCell:t,targetCell:e,sourceMagnet:i,targetMagnet:o}){if(!i||!o||t===e)return!1;{if(!n.call(this,t,e)||i.getAttribute("port-group")==="top"||o.getAttribute("port-group")!=="top")return!1;let a=this.getOutgoingEdges(t),l=this.getIncomingEdges(e);if(t.data.name==="check"){if(e.data.name==="flow"&&!l)return!0;if(e.data.name==="check"&&l)return!1}else if(t.data.name!=="flow"){if(a.length>1||l)return!1}return!0}function n(a,l){const{data:{name:c,checkLevel:h}}=a,{data:{name:p,checkLevel:b}}=l;if(c===p)return c==="check"?h<b&&b-h===1:c==="flow";if(c==="report"&&(p!=="check"||b!==1)||c==="check"&&(h===3&&p!=="filing"||!["flow","filing"].includes(p)))return!1;if(c==="flow"){if(p!=="check")return!1;let u=this.getIncomingEdges(a),f=u&&u[0].source?this.getCellById(u[0].source.cell):null;for(;f&&f.data.name!=="check";)u=this.getIncomingEdges(f),f=u&&u[0].source?this.getCellById(u[0].source.cell):null;if(!f)return!1;let w=f.data.checkLevel;if(l.data.checkLevel-w!==1)return!1}return!0}}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}}});this.graph=s,this.usePlugins(s),this.registerNode(),this.initStencil(s),this.bindShortcutKeys(s),this.initGraphEvent(s),s.addNodes([{shape:"custom-rect",label:"\u4E0A\u62A5",width:60,height:40,position:{x:100,y:50},attrs:{body:{rx:20,ry:20,stroke:"#c2c8d5",fill:"#95f204"}},ports:{groups:{bottom:at.groups.bottom},items:[{group:"bottom"}]},data:{name:"report",relation:""}},{shape:"custom-rect",label:"\u5F52\u6863",width:60,height:40,position:{x:100,y:300},attrs:{body:{rx:20,ry:20,stroke:"#c2c8d5",fill:"#f59a23"}},ports:{groups:{top:at.groups.top},items:[{group:"top"}]},data:{name:"filing",relation:""}}])},initGraphEvent(s){function t(e){let i=e.toJSON();console.log(i,"cellJSON"),console.log(s);let o=s.getCells();if(o=o.filter(n=>n.id!==e.id&&n.data),i.ports)for(let n in i.ports.groups)i.ports.groups[n]=at.groups[n];if(i.data.name==="check"){let n=o.filter(a=>a.data.name==="check");if(n.length>0){let a=n.map(h=>h.data.checkLevel),l=Math.max(...a),c={1:"\u4E00\u7EA7\u5BA1\u6838",2:"\u4E8C\u7EA7\u5BA1\u6838",3:"\u4E09\u7EA7\u5BA1\u6838"};i.data.checkLevel=l===3?3:l+1,i.attrs.text.text=c[i.data.checkLevel]}else i.attrs.text.text="\u4E00\u7EA7\u5BA1\u6838"}e.setProp(i)}s.on("node:added",({cell:e,index:i,options:o})=>{if(!e.data)return;console.log(e,"cell"),["check","flow"].includes(e.data.name)&&t.call(this,e)}),s.on("node:click",this.editCell),s.on("edge:click",this.editCell)},initStencil(s){const t={groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]},e=new et({title:"\u6D41\u7A0B\u56FE",target:s,stencilGraphWidth:192,stencilGraphHeight:0,stencilGraphPadding:0,collapsable:!0,groups:[{title:"\u57FA\u7840\u6D41\u7A0B\u56FE",name:"group1"}],layoutOptions:{columns:2,columnWidth:88,rowHeight:80,dx:8,dy:8}});document.getElementById("stencil").appendChild(e.container),this.stencil=e;let i=this;const o=s.createNode({shape:"custom-rect",label:"\u5BA1\u6838",width:65,height:65,attrs:{body:{stroke:"#c2c8d5",fill:"#81d3f8"}},ports:{groups:{top:t.groups.top,bottom:t.groups.bottom},items:[{group:"top"},{group:"bottom"}]},data:{name:"check",checkLevel:1},tools:[{name:"button-remove",args:{offset:{x:-10,y:0},rotate:!0,onClick:({cell:a})=>{i.currentCell&&i.currentCell.id===a.id&&(i.currentCell=null,i.currentCellJson=null),i.graph.removeNode(a.id)}}}]}),n=s.createNode({shape:"custom-rect",label:"\u6D41\u8F6C",width:65,height:65,attrs:{body:{stroke:"#c2c8d5",fill:"#aaaaaa"}},ports:{groups:{top:t.groups.top,bottom:t.groups.bottom},items:[{group:"top"},{group:"bottom"}]},data:{name:"flow"},tools:[{name:"button-remove",args:{offset:{x:-10,y:0},rotate:!0}}]});e.load([o,n],"group1")},usePlugins(s){s.use(new Y({resizing:!0,rotating:!0})).use(new tt({enabled:!0,rubberband:!0,showNodeSelectionBox:!0})).use(new ft({enabled:!0,tolerance:10})).use(new pt({enabled:!0})).use(new ct({enabled:!0})).use(new q({enabled:!0}))},bindShortcutKeys(s){s.bindKey(["meta+c","ctrl+c"],()=>{const t=s.getSelectedCells();return t.length&&s.copy(t),!1}),s.bindKey(["meta+x","ctrl+x"],()=>{const t=s.getSelectedCells();return t.length&&s.cut(t),!1}),s.bindKey(["meta+v","ctrl+v"],()=>{if(!s.isClipboardEmpty()){const t=s.paste({offset:32});s.cleanSelection(),s.select(t)}return!1}),s.bindKey(["meta+z","ctrl+z"],()=>(s.canUndo()&&s.undo(),!1)),s.bindKey(["meta+y","ctrl+y"],()=>(s.canRedo()&&s.redo(),!1)),s.bindKey(["meta+a","ctrl+a"],()=>{const t=s.getNodes();t&&s.select(t)}),s.bindKey("backspace",()=>{const t=s.getSelectedCells();t.length&&s.removeCells(t)}),s.bindKey(["ctrl+q","meta+q"],()=>{s.zoom()<1.5&&s.zoom(.1)}),s.bindKey(["ctrl+e","meta+e"],()=>{s.zoom()>.5&&s.zoom(-.1)})},registerNode(s){r.Graph.registerNode("custom-rect",{inherit:"rect",width:50,height:50,attrs:{body:{strokeWidth:1,stroke:"#007aff",fill:"#f2f8ff"},text:{fontSize:14,fill:"#595959"}}},!0),r.Graph.registerNode("custom-polygon",{inherit:"polygon",width:80,height:40,attrs:{body:{strokeWidth:1,stroke:"#007aff",fill:"#f2f8ff"},text:{fontSize:14,fill:"#606266"}}},!0),r.Graph.registerNode("custom-circle",{inherit:"circle",width:40,height:40,attrs:{body:{strokeWidth:1,stroke:"#007aff",fill:"#f2f8ff"},text:{fontSize:14,fill:"#606266"}}},!0)},editCell({cell:s}){if(this.currentCell&&this.currentCell.id===s.id){this.currentCell=null,this.currentCellJson=null;return}this.currentCell=s,this.currentCellJson=this.initCellProp(s.toJSON()),s.on("changed",({cell:t,options:e})=>{this.currentCell=t,this.currentCellJson=this.initCellProp(t.toJSON())})},initCellProp(s){let{attrs:t,shape:e}=s;return e==="edge"||t.text.fontSize||(s.attrs.text.fontSize=14),s},exportJSON(){this.jsonVisible=!1;const s=JSON.stringify(this.graph.toJSON()),t=new Blob([s],{type:""});yt.saveAs(t,"data.json")},updateReason(s){let t=this;var e=new FileReader;e.readAsText(s.raw,"UTF-8"),e.onload=async function(i){let o=[];try{o=JSON.parse(i.target.result)}catch{o=[]}t.uploadArr=o}},handleJSON(){!this.uploadArr||(this.uploadArr&&this.graph&&this.graph.fromJSON(this.uploadArr),this.uploadArr=null,this.uploadVisible=!1)},checkProcess(){let s=this.graph.getNodes();for(let e of s){const{data:{name:i}}=e;let o={report:1,check:2,flow:2,filing:3};if(!t.call(this.graph,e,o[i])){this.$message.warning("\u6D41\u7A0B\u5B58\u5728\u95EE\u9898");return}}function t(e,i){let o=this.getIncomingEdges(e),n=this.getOutgoingEdges(e);if(i===1){if(!n)return!1}else if(i===2){if(!o||!n)return!1}else if(i===3&&!o)return!1;return!0}},setCellRelation(){let s=this.graph,t=s.getCells();t.forEach(n=>{n.data&&(n.data.relation&&n.setData({relation:""}),n.data.levelName&&n.setData({levelName:""}),n.data.relationShip&&n.setData({relationShip:""}))});let e=t.find(n=>n.data&&n.data.name==="filing");i(e),o(e),this.setCellRelationLine();function i(n){let l=(s.getIncomingEdges(n)||[]).map(h=>s.getCellById(h.source.cell)),c;if(n.data.name==="flow"){let h=l[0];if(h.data.name!=="check"){let p=s.getIncomingEdges(h),u=s.getOutgoingEdges(h).map(w=>s.getCellById(w.target.cell)),f=0;for(;h&&h.data.name!=="check";)f++,h=s.getCellById(p[0].source.cell);if(u.length>1){for(let w in u)if(u[w].id===n.id){c=`C${h.data.checkLevel}F${f+1}-${Number(w)+1}`;break}}else c=`C${h.data.checkLevel}F${f+1}`}else{let b=s.getOutgoingEdges(h).map(u=>s.getCellById(u.target.cell));if(b.length>1){for(let u in b)if(b[u].id===n.id){c=`C${h.data.checkLevel}F1-${Number(u)+1}`;break}}else c=`C${h.data.checkLevel}F1`}}else n.data.name==="check"?c=`C${n.data.checkLevel}`:n.data.name==="report"?c="B":n.data.name==="filing"&&(c="E");n.setData({levelName:c}),l.forEach(h=>{i(h)})}function o(n){let a,l,c=s.getIncomingEdges(n),h=s.getOutgoingEdges(n);if(h?l=h.map(b=>s.getCellById(b.target.cell).data.levelName).join("|"):l=null,c){let p=c.map(u=>s.getCellById(u.source.cell));p.forEach(u=>{o(u)}),a=p.map(u=>u.data.levelName).join("|")}else a=null;n.setData({relationShip:`${a||""}:${l||""}`})}},setCellRelationLine(){let s=this.graph,e=s.getCells().find(o=>o.data&&o.data.name==="report");i(e);function i(o){let n=s.getOutgoingEdges(o);if(!n)return;let a=n.map(h=>s.getCellById(h.target.cell)),l=a.length,c=o.data?o.data.relation:"";a.forEach((h,p)=>{const{data:{levelName:b,relation:u,name:f}}=h;let w;if(f==="check")w=`${c?`${c}-`:""}${b}`,u&&(w=`${u}|${w}`);else if(f==="flow")if(c){let x=c.split("-").filter(I=>I.includes("f"));w=`${c}-f${x.length>0?Number(x[x.length-1].replace("f",""))+1:1}${l>1?`-${p+1}`:""}`}else w="";w&&h.setData({relation:w}),i(h)})}}},watch:{currentCellJson:{deep:!0,handler(s){this.currentCell&&this.currentCell.setProp(s)}}},mounted(){this.initDrawContainer()}};var Kt=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"drawing-container"}},[e("div",{staticClass:"tools-bar"},[e("div",{staticClass:"main-tool"}),e("div",{staticClass:"other-tool"},[e("div",{staticClass:"tools-btn",on:{click:t.checkProcess}},[e("d-icon",{attrs:{name:"createJson"}}),e("span",[t._v("\u6821\u9A8C")])],1),e("div",{staticClass:"tools-btn",on:{click:t.setCellRelation}},[e("d-icon",{attrs:{name:"createJson"}}),e("span",[t._v("\u8BBE\u7F6E\u5173\u7CFB")])],1),e("div",{staticClass:"tools-btn",on:{click:function(i){t.jsonVisible=!0}}},[e("d-icon",{attrs:{name:"createJson"}}),e("span",[t._v("\u751F\u6210JSON")])],1),e("div",{staticClass:"tools-btn",on:{click:function(i){t.uploadVisible=!0}}},[e("d-icon",{attrs:{name:"importJson"}}),e("span",[t._v("\u5BFC\u5165JSON")])],1)])]),e("div",{staticClass:"drawing"},[e("div",{attrs:{id:"stencil"}}),e("div",{ref:"drawContainer",attrs:{id:"drawing-board"}},[t._m(0)]),e("cellPropSet")],1),e("el-dialog",{staticClass:"json-edit",attrs:{title:"\u5BFC\u51FAJSON\u6570\u636E",visible:t.jsonVisible,"close-on-click-modal":!1,width:"800px","destroy-on-close":""},on:{"update:visible":function(i){t.jsonVisible=i}}},[t.graph?e("div",{staticStyle:{height:"500px"}},[e("codeMirror",{ref:"jsonEditor",staticStyle:{width:"100%",height:"100%"},attrs:{mode:"application/json","json-code":JSON.stringify(t.graph.toJSON()),readonly:!1}})],1):t._e(),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.exportJSON}},[t._v("\u5BFC\u51FAJSON\u6570\u636E")]),e("el-button",{attrs:{size:"small"},on:{click:function(i){t.jsonVisible=!1}}},[t._v("\u53D6\u6D88")])],1)]),e("el-dialog",{staticClass:"json-import-edit",attrs:{title:"\u5BFC\u5165JSON\u6570\u636E",width:"408px",visible:t.uploadVisible,"close-on-click-modal":!1,"destroy-on-close":!0},on:{"update:visible":function(i){t.uploadVisible=i}}},[e("elUpload",{staticStyle:{height:"fit-content"},attrs:{drag:"",action:"",multiple:"","on-change":t.updateReason,"auto-upload":!1,accept:".json",limit:1,"list-type":"multipart/form-data"}},[e("i",{staticClass:"el-icon-upload"}),e("div",{staticClass:"el-upload__text"},[t._v("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),e("em",[t._v("\u70B9\u51FB\u4E0A\u4F20")])]),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("\u53EA\u80FD\u4E0A\u4F20JSON\u6587\u4EF6")])]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.handleJSON}},[t._v("\u4FDD\u5B58")]),e("el-button",{attrs:{size:"small"},on:{click:()=>{t.uploadVisible=!1,t.uploadArr=null}}},[t._v("\u53D6\u6D88")])],1)],1)],1)},Yt=[function(){var s=this,t=s._self._c;return t("div",{staticClass:"draw-node-item"},[t("div",{staticClass:"draw-node-content"})])}],Xt=lt(Jt,Kt,Yt,!1,null,"642c394c",null,null);const te=Xt.exports;export{te as default};
