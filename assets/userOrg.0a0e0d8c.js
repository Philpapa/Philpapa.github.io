import{g as r,M as o,ai as d}from"./index.0af4b258.js";import{u as c}from"./useUserQuery.3719189f.js";const u=o({name:"userOrg",setup(){const[t,e,s,a,i,n,l]=c({api:d,params:{}});return a(),{reqLoading:t,page:e,list:s,queryCB:a,changeSize:i,changeCurrent:n,deletePageChange:l}},data(){return{options:[]}},methods:{edit(t){t.cache=JSON.stringify(t);const e=t.hasright_orgid?t.hasright_orgid.split(","):[];this.$set(t,"oriIds",e),this.$set(t,"edit",!0)},orgChange(t){t.hasright_orgid="",t.hasright_orgname="",t.oriIds=[]},OrgInfo(){this.$api.userorg.getOrgInfo({}).then(t=>{t.status===104&&(this.options=t.data)})},save(t){const{oriIds:e,defalut_orgid:s}=t;if(e.length){const a=[];e.forEach(i=>{const n=this.options.find(l=>l.id===i);a.push(n.name)}),t.hasright_orgid=e.join(","),t.hasright_orgname=a.join(",")}else t.hasright_orgid="",t.hasright_orgname="";s&&(t.defalut_orgname=this.options.find(a=>a.id===s).name),t.loading=!0,this.$api.userorg.submit({...t}).then(a=>{a.status===100&&(this.$message({type:"success",message:a.msg}),this.queryCB())}).finally(()=>{t.loading=!1})},cancel(t){const e=JSON.parse(t.cache);Object.keys(e).forEach(s=>{t[s]=e[s]}),t.edit=!1},orgFilterHandler(t,e){!t||(e.oriIds=e.oriIds.filter(s=>s!==t))}},created(){this.OrgInfo()}});var g=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.reqLoading,expression:"reqLoading"}],staticClass:"organization-con"},[s("el-table",{staticClass:"plain_table",staticStyle:{width:"100%"},attrs:{"highlight-current-row":"",data:e.list,height:"calc(100% - 60px)"}},[s("el-table-column",{attrs:{type:"index",label:"\u5E8F\u53F7",width:"75"}}),s("el-table-column",{attrs:{prop:"id",label:"\u7528\u6237id",width:"130"}}),s("el-table-column",{attrs:{prop:"name",label:"\u7528\u6237\u540D",width:"180"}}),s("el-table-column",{attrs:{prop:"defalut_orgname","show-overflow-ellipsis":"",label:"\u9ED8\u8BA4\u7EC4\u7EC7\u673A\u6784",width:"210"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[a.edit?s("el-select",{attrs:{placeholder:"\u8BF7\u9009\u62E9",size:"mini"},on:{change:i=>{e.orgFilterHandler(i,a)}},model:{value:a.defalut_orgid,callback:function(i){e.$set(a,"defalut_orgid",i)},expression:"row.defalut_orgid"}},e._l(e.options,function(i){return s("el-option",{key:i.id,attrs:{label:i.name,value:i.id}})}),1):[e._v(e._s(a.defalut_orgname))]]}}])}),s("el-table-column",{attrs:{prop:"hasright_orgname","show-overflow-ellipsis":"",label:"\u6709\u6743\u9650\u7684\u673A\u6784"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[a.edit?s("el-select",{attrs:{multiple:"","collapse-tags":"",placeholder:"\u8BF7\u9009\u62E9",size:"mini"},model:{value:a.oriIds,callback:function(i){e.$set(a,"oriIds",i)},expression:"row.oriIds"}},e._l(e.options.filter(i=>i.id!==a.defalut_orgid),function(i){return s("el-option",{key:i.id,attrs:{label:i.name,value:i.id}})}),1):[e._v(e._s(a.hasright_orgname))]]}}])}),s("el-table-column",{attrs:{label:"\u64CD\u4F5C",width:"130"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[a.edit?e._e():s("el-button",{attrs:{type:"text"},on:{click:function(i){return e.edit(a)}}},[e._v("\u7F16\u8F91")]),a.edit?s("el-button",{attrs:{type:"text",loading:a.loading},on:{click:function(i){return e.save(a)}}},[e._v("\u4FDD\u5B58")]):e._e(),a.edit?s("el-button",{staticClass:"cancel-btn",attrs:{type:"text"},on:{click:function(i){return e.cancel(a)}}},[e._v("\u53D6\u6D88")]):e._e()]}}])})],1),s("d-page",{staticClass:"c-paginate",attrs:{"pager-count":5,"current-page":e.page.pageNum,"page-sizes":[10,20,30,50,100],"page-size":e.page.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.page.total},on:{"current-change":e.changeCurrent,"size-change":e.changeSize}})],1)},p=[],h=r(u,g,p,!1,null,"002ae106",null,null);const m=h.exports;export{m as default};
