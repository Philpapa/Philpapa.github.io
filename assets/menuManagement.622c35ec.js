import{M as L,r,Y as B,g as J,ae as U,z as V,l as b,af as M,ag as I,ab as K,ah as j,_ as z}from"./index.0af4b258.js";const q=L({name:"menuManagement",setup(){const d=r([]),e=r(),t=r([]);function a(){U().then(s=>{const{data:l,status:n}=s;if(n===104){if(t.value=l?l.list:[],h.value){let i=[];t.value.forEach(f=>{i=[...i,...y(f)]});let u=i.find(f=>h.value.id===f.id);u&&k(u)}else k(t.value[0]);V(()=>{h.value?e.value.setCurrentKey(h.value.id):e.value.setCurrentKey(t.value[0].id)})}})}a();const g=r([]),P=r([]),h=r("");function k(s){h.value=JSON.parse(JSON.stringify(s));const l=y(s).filter(n=>!n.childs);g.value=l}function y(s){let l=[];const{childs:n}=s;if(l.push(s),n)for(let i of n)l=[...l,...y(i)];return l}function N(s){let l=s.status?"\u505C\u7528":"\u542F\u7528";b.exports.MessageBox.confirm(`\u662F\u5426\u8981${l}\uFF1F`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"}).then(()=>{const n={ids:[s.id],status:!s.status};M(n).then(i=>{const{status:u}=i;let f=Array.from(e.value.store._getAllNodes());d.value=f.filter(c=>c.expanded).map(c=>c.data.id),u===100&&a(),b.exports.Message.success("\u64CD\u4F5C\u6210\u529F")})}).catch(n=>{console.log(n)})}function C(s){const l=P.value.map(n=>n.id);l.length?b.exports.MessageBox.confirm(`\u662F\u5426\u8981\u6279\u91CF${s?"\u542F\u7528":"\u505C\u7528"}\uFF1F`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"}).then(()=>{M({ids:l,status:s}).then(i=>{const{status:u}=i;let f=Array.from(e.value.store._getAllNodes());d.value=f.filter(c=>c.expanded).map(c=>c.data.id),u===100&&a(),b.exports.Message.success("\u64CD\u4F5C\u6210\u529F")})}).catch(()=>{}):this.$message.error("\u8BF7\u52FE\u9009\u9700\u8981\u4FEE\u6539\u7684\u6570\u636E")}const x=r(!1),_=r({}),w=r(!1),p=r([]),D=r([]),v=r([]),o=r(!1),m=r(!1);async function E(s){_.value=JSON.parse(JSON.stringify(s)),x.value=!0,await I().then(l=>{const{data:n,status:i}=l;i===100&&(D.value=n,v.value=D.value.map(u=>u.name))}),await K({menuIDList:[s.id]}).then(l=>{const{data:n,status:i}=l;if(i===104&&n.length){const{parentName:u,router:f,operationName:c}=n[0];if(Object.assign(_.value,{parentName:u,router:f}),c){let S={};c.split(",").forEach($=>{let A=$.split("||");S[A[0]]=A[1]}),p.value=Object.keys(S)}O()}})}function O(){let s=v.value.length,l=p.value.length;if(!s||!l){o.value=!1,m.value=!1;return}s===l?(o.value=!0,m.value=!1):s>l&&(o.value=!1,m.value=!0)}function H(s){Array.isArray(s)?v.value.length<=s.length?(o.value=!v.value.some(l=>!s.includes(l)),m.value=!o.value):(o.value=!1,m.value=!0):s===!1?(o.value=!1,m.value=!1,p.value=[]):s===!0&&(o.value=!0,m.value=!1,p.value=JSON.parse(JSON.stringify(v.value)))}function T(){let s=[];v.value.forEach(n=>{p.value.includes(n)?s.push({name:n,status:!0}):s.push({name:n,status:!1})}),console.log(_.value,"formData.value");let l={id:_.value.id,router:_.value.router,menuOperation:s};j(l).then(n=>{const{status:i}=n;i===103&&b.exports.Message.success("\u4FDD\u5B58\u6210\u529F")}).finally(()=>{x.value=!1,o.value=!1,m.value=!1,p.value=[]})}return{defaultExpandedKeys:d,menuTree:e,treeData:t,menuList:g,multipleSelection:P,currentMenu:h,getMenuDetail:k,menuStatusHandler:N,menuStatusMultipleHandler:C,dialogVisible:x,formData:_,hasEditUrl:w,checkedPermission:p,permissionDic:D,permissionNameDic:v,checkAll:o,checked:m,initDialogData:E,menuPermissionCheckHandler:H,updateMenu:T}},data(){return{pagePermission:[]}},computed:{...B({menuPermission:d=>d.user.menuPermission})},methods:{hasPermissions(d){return this.pagePermission.some(e=>e.value1===d)}},mounted(){this.pagePermission=this.menuPermission[this.$route.name]}});var F=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"menu-management"},[t("el-tree",{ref:"menuTree",attrs:{data:e.treeData,"highlight-current":"",props:{children:"childs",label:"name"},"default-expanded-keys":e.defaultExpandedKeys,"node-key":"id"},on:{"node-click":e.getMenuDetail},scopedSlots:e._u([{key:"default",fn:function({data:a}){return[t("div",{staticClass:"tree-content"},[t("span",{staticClass:"tree-name"},[e._v(e._s(a.name))]),!a.childs||!a.childs.length?t("span",{class:{"menu-status":!0,enable:a.status,disable:!a.status}}):e._e()])]}}])}),t("div",{staticClass:"menu-set"},[t("div",{staticClass:"menu-btns"},[e.hasPermissions("edit")?t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(a){return e.menuStatusMultipleHandler(!1)}}},[e._v("\u6279\u91CF\u505C\u7528")]):e._e(),e.hasPermissions("edit")?t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(a){return e.menuStatusMultipleHandler(!0)}}},[e._v("\u6279\u91CF\u542F\u7528")]):e._e()],1),t("el-table",{staticClass:"plain_table",attrs:{data:e.menuList},on:{"selection-change":a=>{e.multipleSelection=a}}},[t("template",{slot:"empty"},[t("img",{staticStyle:{width:"200px"},attrs:{src:z,alt:""}}),t("span",[e._v("\u6682\u65E0\u6570\u636E\u54E6\uFF5E")])]),t("el-table-column",{attrs:{type:"selection",width:"38"}}),t("el-table-column",{attrs:{prop:"id",label:"ID"}}),t("el-table-column",{attrs:{prop:"name",label:"\u83DC\u5355\u540D\u79F0","show-overflow-tooltip":"","min-width":"90"}}),t("el-table-column",{attrs:{prop:"icon",label:"\u56FE\u6807"}}),t("el-table-column",{attrs:{prop:"parentName",label:"\u4E0A\u7EA7\u83DC\u5355","show-overflow-tooltip":"","min-width":"90"}}),t("el-table-column",{attrs:{prop:"intro",label:"\u83DC\u5355\u8BF4\u660E","show-overflow-tooltip":"","min-width":"90"}}),t("el-table-column",{attrs:{prop:"type",label:"\u83DC\u5355\u7C7B\u578B"}}),t("el-table-column",{attrs:{prop:"status",label:"\u72B6\u6001"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("div",[t("span",{class:{"status-point":!0,success:a.status,gray:!a.status}},[e._v(e._s(a.status?"\u542F\u7528":"\u505C\u7528"))])])]}}])}),t("el-table-column",{attrs:{label:"\u64CD\u4F5C",width:"107"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[e.hasPermissions("edit")?t("el-button",{attrs:{type:"text"},on:{click:function(g){return e.initDialogData(a)}}},[e._v("\u7F16\u8F91")]):e._e(),e.hasPermissions("edit")?t("el-button",{attrs:{type:"text"},on:{click:function(g){return e.menuStatusHandler(a)}}},[e._v(e._s(a.status?"\u505C\u7528":"\u542F\u7528"))]):e._e()]}}])})],2)],1),t("el-dialog",{staticClass:"menu-dialog",attrs:{title:"\u7F16\u8F91",width:"515px",visible:e.dialogVisible,"close-on-click-modal":!1,"before-close":()=>{e.dialogVisible=!1,e.checkAll=!1,e.checked=!1,e.checkedPermission=[]}}},[t("el-form",{attrs:{model:e.formData,"label-width":"85px"}},[t("el-row",{attrs:{gutter:32}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"\u83DC\u5355\u540D\u79F0\uFF1A"}},[t("div",[e._v(e._s(e.formData.name))])])],1),t("el-col",{attrs:{span:16}},[t("el-form-item",{attrs:{label:"\u4E0A\u7EA7\u83DC\u5355\uFF1A"}},[t("div",[e._v(e._s(e.formData.parentName))])])],1)],1),e.formData.type==="system"?t("el-form-item",{attrs:{label:"\u94FE\u63A5\u5730\u5740\uFF1A"}},[t("div",[e._v(e._s(e.formData.router))])]):e._e(),e.formData.type==="other"?t("el-row",[t("el-col",{attrs:{span:20}},[t("el-form-item",{attrs:{label:"\u94FE\u63A5\u5730\u5740\uFF1A"}},[e.hasEditUrl?[t("el-input",{attrs:{placeholder:"\u94FE\u63A5\u5730\u5740",type:"text"},model:{value:e.input,callback:function(a){e.input=typeof a=="string"?a.trim():a},expression:"input"}})]:[t("div",[e._v(e._s(e.formData.router))])]],2)],1),t("el-col",{attrs:{span:4}},[t("el-form-item",[t("el-button",{attrs:{type:"text"},on:{click:function(a){e.hasEditUrl=!e.hasEditUrl}}},[e._v(" "+e._s(e.hasEditUrl?"\u4FDD\u5B58":"\u7F16\u8F91")+" ")])],1)],1)],1):e._e(),t("el-form-item",{attrs:{label:"\u56FE\u6807\uFF1A"}}),t("el-form-item",{attrs:{label:"\u83DC\u5355\u8BF4\u660E\uFF1A"}},[t("div",[e._v(e._s(e.formData.intro))])]),t("el-form-item",{attrs:{label:"\u83DC\u5355\u529F\u80FD\uFF1A"}},[t("el-checkbox",{attrs:{indeterminate:e.checked},on:{change:e.menuPermissionCheckHandler},model:{value:e.checkAll,callback:function(a){e.checkAll=a},expression:"checkAll"}},[e._v("\u5168\u9009 ")]),t("el-checkbox-group",{on:{change:e.menuPermissionCheckHandler},model:{value:e.checkedPermission,callback:function(a){e.checkedPermission=a},expression:"checkedPermission"}},e._l(e.permissionDic,function(a){return t("el-checkbox",{key:a.id,attrs:{label:a.name}},[e._v(" "+e._s(a.intro)+" ")])}),1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(a){return e.updateMenu()}}},[e._v("\u786E\u5B9A")]),t("el-button",{on:{click:()=>{e.dialogVisible=!1,e.checkAll=!1,e.checked=!1,e.checkedPermission=[]}}},[e._v("\u53D6\u6D88")])],1)],1)],1)},R=[],Y=J(q,F,R,!1,null,"afc25216",null,null);const W=Y.exports;export{W as default};
